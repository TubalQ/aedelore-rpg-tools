<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aedelore Character Sheet - Interactive RPG Character Creator</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Create and manage your Aedelore RPG character with our interactive character sheet. Track attributes, combat stats, spells, inventory, and roll dice online.">
    <meta name="keywords" content="Aedelore character sheet, RPG character creator, fantasy character builder, tabletop RPG tools, character manager, dice roller">
    <meta name="author" content="World of Aedelore">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://aedelore.nu/character-sheet">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aedelore.nu/character-sheet">
    <meta property="og:title" content="Aedelore Character Sheet - Interactive RPG Character Creator">
    <meta property="og:description" content="Create and manage your Aedelore RPG character. Track attributes, combat, spells, and inventory with our interactive character sheet.">
    <meta property="og:image" content="https://aedelore.nu/uploads/images/system/2025-09/world-of-aedelore.jpg">
    <meta property="og:site_name" content="World of Aedelore">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://aedelore.nu/character-sheet">
    <meta name="twitter:title" content="Aedelore Character Sheet - Interactive RPG Character Creator">
    <meta name="twitter:description" content="Create and manage your Aedelore RPG character. Track attributes, combat, spells, and inventory with our interactive character sheet.">
    <meta name="twitter:image" content="https://aedelore.nu/uploads/images/system/2025-09/world-of-aedelore.jpg">

    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Aedelore">
    <meta name="theme-color" content="#8b5cf6">
    <script>
        (function() {
            var colors = {'aedelore':'#8b5cf6','dark-glass':'#1a1a1f','midnight':'#0a1628','ember':'#1a0c08'};
            var theme = localStorage.getItem('aedelore_theme') || 'aedelore';
            var color = colors[theme] || '#8b5cf6';
            document.querySelector('meta[name="theme-color"]').setAttribute('content', color);
            if (theme !== 'aedelore') document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <link rel="manifest" href="/manifest.json">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">
    <link rel="apple-touch-icon" href="/icons/icon.svg">

    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Aedelore Character Sheet",
        "description": "Interactive character sheet for the Aedelore fantasy RPG world",
        "url": "https://aedelore.nu/character-sheet",
        "applicationCategory": "GameApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>

    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Cloud Autosave Indicator -->
    <div id="cloud-save-indicator" class="cloud-save-indicator">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>
        </svg>
        <span>Saving...</span>
    </div>

    <!-- Onboarding Guide Sidebar -->
    <div id="onboarding-sidebar" class="onboarding-sidebar">
        <div class="onboarding-header">
            <h3>Getting Started</h3>
            <button class="onboarding-close" onclick="hideOnboarding()" title="Close guide">&times;</button>
        </div>
        <p class="onboarding-subtitle">Follow these steps to get started and to enable campaign mode:</p>

        <div class="onboarding-steps">
            <div class="onboarding-step" id="onboard-step-1" data-step="register">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">Register an account</div>
                    <div class="step-desc">Click <strong>Cloud</strong> <span class="step-arrow">‚Üí</span> <strong>Register</strong></div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-2" data-step="name">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">Name your character</div>
                    <div class="step-desc">Go to <strong>Character</strong> tab <span class="step-arrow">‚Üí</span> Fill in <strong>Character Name</strong></div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-3" data-step="save">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">Save to cloud</div>
                    <div class="step-desc">Click <strong>Cloud</strong> <span class="step-arrow">‚Üí</span> <strong>Save to Cloud</strong></div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-4" data-step="race-class">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">Choose race, class & religion</div>
                    <div class="step-desc">Select from dropdowns in <strong>Character</strong> tab</div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-5" data-step="lock-rc">
                <div class="step-number">5</div>
                <div class="step-content">
                    <div class="step-title">Lock race & class</div>
                    <div class="step-desc">Click the <strong>Lock</strong> button next to your selections</div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-6" data-step="attributes">
                <div class="step-number">6</div>
                <div class="step-content">
                    <div class="step-title">Distribute attribute points</div>
                    <div class="step-desc">Go to <strong>Stats</strong> tab <span class="step-arrow">‚Üí</span> Spend your <strong>10 points</strong></div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-7" data-step="lock-attr">
                <div class="step-number">7</div>
                <div class="step-content">
                    <div class="step-title">Lock attributes</div>
                    <div class="step-desc">Click <strong>Lock Attributes</strong> button</div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-8" data-step="campaign">
                <div class="step-number">8</div>
                <div class="step-content">
                    <div class="step-title">Join a campaign</div>
                    <div class="step-desc"><strong>Character</strong> tab <span class="step-arrow">‚Üí</span> Campaign section <span class="step-arrow">‚Üí</span> <strong>Link to Campaign</strong></div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-9" data-step="dm-session">
                <div class="step-number">9</div>
                <div class="step-content">
                    <div class="step-title">View campaign details</div>
                    <div class="step-desc"><strong>Cloud</strong> menu <span class="step-arrow">‚Üí</span> <strong>DM Session</strong> to see campaign info</div>
                </div>
                <div class="step-check"></div>
            </div>

            <div class="onboarding-step" id="onboard-step-10" data-step="overview">
                <div class="step-number">10</div>
                <div class="step-content">
                    <div class="step-title">Go to Overview and enjoy your game!</div>
                    <div class="step-desc">Click the <strong>Overview</strong> tab to see your character summary</div>
                </div>
                <div class="step-check"></div>
            </div>
        </div>

        <div class="onboarding-tip">
            <strong>Tip:</strong> Explore the other tabs to discover where everything is!
        </div>

        <div class="onboarding-note">
            üìù <strong>No DM?</strong> You can still distribute points and pick abilities ‚Äì just skip the lock steps (5 & 7).
        </div>

        <div class="onboarding-footer">
            <button class="onboarding-hide-btn" onclick="hideOnboardingPermanent()">Don't show again</button>
        </div>
    </div>

    <!-- Onboarding Mobile Panel -->
    <div id="onboarding-mobile" class="onboarding-mobile">
        <button class="onboarding-mobile-toggle" onclick="toggleOnboardingMobile()">
            <span class="toggle-icon">?</span>
            <span class="toggle-text">Getting Started Guide</span>
            <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="onboarding-mobile-content" id="onboarding-mobile-content">
            <!-- Content cloned from sidebar via JS -->
        </div>
    </div>

    <div class="app-wrapper">
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>

        <!-- Sidebar Backdrop (for tablet overlay mode) -->
        <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

        <!-- Desktop Sidebar (visible on large screens and tablet as overlay) -->
        <aside class="desktop-sidebar" id="desktop-sidebar">
            <!-- Character Info -->
            <div class="sidebar-section">
                <div class="sidebar-character-info">
                    <div class="sidebar-character-name" id="sidebar-char-name">New Character</div>
                    <div class="sidebar-character-details" id="sidebar-char-details">Race ‚Ä¢ Class</div>
                </div>
            </div>

            <!-- Status Effects -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Status</div>
                <div class="sidebar-status" id="sidebar-status">
                    <span class="sidebar-status-item negative" id="sidebar-bleed" style="display: none;">ü©∏ Bleed: <span id="sidebar-bleed-val">0</span></span>
                    <span class="sidebar-status-item negative" id="sidebar-weak" style="display: none;">üò´ Weak: <span id="sidebar-weak-val">0</span></span>
                    <span class="sidebar-status-item positive" id="sidebar-status-ok">‚úì No conditions</span>
                </div>
            </div>

            <!-- Attributes with Skills -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Attributes & Skills</div>

                <!-- Strength -->
                <div class="sidebar-attr-group">
                    <div class="sidebar-attribute main">
                        <span class="sidebar-attribute-name">Strength</span>
                        <div class="sidebar-attribute-bar">
                            <div class="sidebar-attribute-fill" id="sidebar-str-bar" style="width: 0%"></div>
                        </div>
                        <span class="sidebar-attribute-value" id="sidebar-str-val">0</span>
                    </div>
                    <div class="sidebar-skills">
                        <div class="sidebar-skill"><span>Athletics</span><span id="sidebar-str-athletics">0</span></div>
                        <div class="sidebar-skill"><span>Raw Power</span><span id="sidebar-str-raw_power">0</span></div>
                        <div class="sidebar-skill"><span>Unarmed</span><span id="sidebar-str-unarmed">0</span></div>
                    </div>
                </div>

                <!-- Dexterity -->
                <div class="sidebar-attr-group">
                    <div class="sidebar-attribute main">
                        <span class="sidebar-attribute-name">Dexterity</span>
                        <div class="sidebar-attribute-bar">
                            <div class="sidebar-attribute-fill" id="sidebar-dex-bar" style="width: 0%"></div>
                        </div>
                        <span class="sidebar-attribute-value" id="sidebar-dex-val">0</span>
                    </div>
                    <div class="sidebar-skills">
                        <div class="sidebar-skill"><span>Endurance</span><span id="sidebar-dex-endurance">0</span></div>
                        <div class="sidebar-skill"><span>Acrobatics</span><span id="sidebar-dex-acrobatics">0</span></div>
                        <div class="sidebar-skill"><span>Sleight of Hand</span><span id="sidebar-dex-sleight_of_hand">0</span></div>
                        <div class="sidebar-skill"><span>Stealth</span><span id="sidebar-dex-stealth">0</span></div>
                    </div>
                </div>

                <!-- Intelligence -->
                <div class="sidebar-attr-group">
                    <div class="sidebar-attribute main">
                        <span class="sidebar-attribute-name">Intelligence</span>
                        <div class="sidebar-attribute-bar">
                            <div class="sidebar-attribute-fill" id="sidebar-int-bar" style="width: 0%"></div>
                        </div>
                        <span class="sidebar-attribute-value" id="sidebar-int-val">0</span>
                    </div>
                    <div class="sidebar-skills">
                        <div class="sidebar-skill"><span>Arcana</span><span id="sidebar-int-arcana">0</span></div>
                        <div class="sidebar-skill"><span>History</span><span id="sidebar-int-history">0</span></div>
                        <div class="sidebar-skill"><span>Investigation</span><span id="sidebar-int-investigation">0</span></div>
                        <div class="sidebar-skill"><span>Nature</span><span id="sidebar-int-nature">0</span></div>
                        <div class="sidebar-skill"><span>Religion</span><span id="sidebar-int-religion">0</span></div>
                    </div>
                </div>

                <!-- Wisdom -->
                <div class="sidebar-attr-group">
                    <div class="sidebar-attribute main">
                        <span class="sidebar-attribute-name">Wisdom</span>
                        <div class="sidebar-attribute-bar">
                            <div class="sidebar-attribute-fill" id="sidebar-wis-bar" style="width: 0%"></div>
                        </div>
                        <span class="sidebar-attribute-value" id="sidebar-wis-val">0</span>
                    </div>
                    <div class="sidebar-skills">
                        <div class="sidebar-skill"><span>Luck</span><span id="sidebar-wis-luck">0</span></div>
                        <div class="sidebar-skill"><span>Animal Handling</span><span id="sidebar-wis-animal_handling">0</span></div>
                        <div class="sidebar-skill"><span>Insight</span><span id="sidebar-wis-insight">0</span></div>
                        <div class="sidebar-skill"><span>Medicine</span><span id="sidebar-wis-medicine">0</span></div>
                        <div class="sidebar-skill"><span>Perception</span><span id="sidebar-wis-perception">0</span></div>
                        <div class="sidebar-skill"><span>Survival</span><span id="sidebar-wis-survival">0</span></div>
                    </div>
                </div>

                <!-- Force of Will -->
                <div class="sidebar-attr-group">
                    <div class="sidebar-attribute main">
                        <span class="sidebar-attribute-name">Force of Will</span>
                        <div class="sidebar-attribute-bar">
                            <div class="sidebar-attribute-fill" id="sidebar-fow-bar" style="width: 0%"></div>
                        </div>
                        <span class="sidebar-attribute-value" id="sidebar-fow-val">0</span>
                    </div>
                    <div class="sidebar-skills">
                        <div class="sidebar-skill"><span>Deception</span><span id="sidebar-fow-deception">0</span></div>
                        <div class="sidebar-skill"><span>Intimidation</span><span id="sidebar-fow-intimidation">0</span></div>
                        <div class="sidebar-skill"><span>Performance</span><span id="sidebar-fow-performance">0</span></div>
                        <div class="sidebar-skill"><span>Persuasion</span><span id="sidebar-fow-persuasion">0</span></div>
                    </div>
                </div>

                <!-- Toughness -->
                <div class="sidebar-attr-group">
                    <div class="sidebar-attribute main">
                        <span class="sidebar-attribute-name">Toughness</span>
                        <div class="sidebar-attribute-bar">
                            <div class="sidebar-attribute-fill" id="sidebar-tgh-bar" style="width: 0%"></div>
                        </div>
                        <span class="sidebar-attribute-value" id="sidebar-tgh-val">0</span>
                    </div>
                    <div class="sidebar-skills">
                        <div class="sidebar-skill"><span>Bonus Injured</span><span id="sidebar-tgh-bonus_injured">0</span></div>
                        <div class="sidebar-skill"><span>Resistance</span><span id="sidebar-tgh-resistance">0</span></div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="app-main">
            <div class="container">
        <!-- Mobile menu overlay (outside header to avoid stacking context issues) -->
        <button class="mobile-menu-close" id="mobile-menu-close" onclick="toggleMobileMenu()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
        <div class="header-right" id="header-menu">
            <!-- Menu Dropdown -->
            <div class="dropdown" id="menu-dropdown">
                <button class="dropdown-trigger" onclick="toggleDropdown('menu-dropdown')">
                    <svg class="icon-main" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
                    Menu
                    <svg class="icon-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-label">Local Storage</div>
                    <button class="dropdown-item" onclick="saveCharacter(); closeDropdowns();">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Save to Browser
                    </button>
                    <button class="dropdown-item" onclick="loadCharacter(); closeDropdowns();">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                        Load from Browser
                    </button>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-label">File</div>
                    <button class="dropdown-item" onclick="exportCharacter(); closeDropdowns();">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Export JSON
                    </button>
                    <button class="dropdown-item" onclick="importCharacter(); closeDropdowns();">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Import JSON
                    </button>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-label">Other</div>
                    <button class="dropdown-item" onclick="window.print(); closeDropdowns();">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                        Print
                    </button>
                    <button class="dropdown-item danger" onclick="clearCharacter(); closeDropdowns();">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Clear Sheet
                    </button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item success" onclick="installPWA(); closeDropdowns();">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12" y2="18.01"/></svg>
                        Install App
                    </button>
                </div>
            </div>

            <!-- Server/Cloud Dropdown -->
            <div class="dropdown dropdown-server" id="server-dropdown">
                <button class="dropdown-trigger" onclick="toggleDropdown('server-dropdown')">
                    <svg class="icon-main" id="server-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>
                    <span id="server-btn-text">Cloud</span>
                    <svg class="icon-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div class="dropdown-menu">
                    <!-- Logged out state -->
                    <div id="server-logged-out">
                        <button class="dropdown-item" onclick="showAuthModal('login'); closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                            Login
                        </button>
                        <button class="dropdown-item" onclick="showAuthModal('register'); closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                            Register
                        </button>
                    </div>
                    <!-- Logged in state -->
                    <div id="server-logged-in" style="display: none;">
                        <div class="dropdown-label">Logged in as <span id="server-username"></span></div>
                        <button class="dropdown-item" onclick="saveToServer(); closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Save to Cloud
                        </button>
                        <button class="dropdown-item" onclick="loadFromServer(); closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                            Load from Cloud
                        </button>
                        <button class="dropdown-item" onclick="showTrashModal(); closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            Trash
                        </button>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/dm-session" onclick="closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                            DM Session
                        </a>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" onclick="doLogout(); closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                            Logout
                        </button>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item danger" onclick="deleteAccount(); closeDropdowns();">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                            Delete Account
                        </button>
                    </div>
                </div>
            </div>

            <!-- Theme Dropdown -->
            <div class="dropdown" id="theme-dropdown">
                <button class="dropdown-trigger" onclick="toggleDropdown('theme-dropdown')">
                    <svg class="icon-main" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                    Theme
                    <svg class="icon-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div class="dropdown-menu">
                    <button class="dropdown-item" onclick="setTheme('aedelore'); closeDropdowns();" data-theme-option="aedelore">
                        <span class="theme-color" style="background: linear-gradient(135deg, #a855f7, #3b9eff);"></span>
                        Aedelore
                        <span class="theme-check" id="theme-check-aedelore"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('midnight'); closeDropdowns();" data-theme-option="midnight">
                        <span class="theme-color" style="background: linear-gradient(135deg, #1e3a5f, #0f172a);"></span>
                        Midnight Blue
                        <span class="theme-check" id="theme-check-midnight"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('dark-glass'); closeDropdowns();" data-theme-option="dark-glass">
                        <span class="theme-color" style="background: linear-gradient(135deg, #d4a537, #c0c0c0);"></span>
                        Dark Glass
                        <span class="theme-check" id="theme-check-dark-glass"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('ember'); closeDropdowns();" data-theme-option="ember">
                        <span class="theme-color" style="background: linear-gradient(135deg, #ff6a00, #ff2a2a);"></span>
                        Ember
                        <span class="theme-check" id="theme-check-ember"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('forest'); closeDropdowns();" data-theme-option="forest">
                        <span class="theme-color" style="background: linear-gradient(135deg, #10b981, #22c55e);"></span>
                        Forest
                        <span class="theme-check" id="theme-check-forest"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('frost'); closeDropdowns();" data-theme-option="frost">
                        <span class="theme-color" style="background: linear-gradient(135deg, #7dd3fc, #38bdf8);"></span>
                        Frost
                        <span class="theme-check" id="theme-check-frost"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('void'); closeDropdowns();" data-theme-option="void">
                        <span class="theme-color" style="background: linear-gradient(135deg, #e879f9, #818cf8);"></span>
                        Void
                        <span class="theme-check" id="theme-check-void"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('pure-darkness'); closeDropdowns();" data-theme-option="pure-darkness">
                        <span class="theme-color" style="background: linear-gradient(135deg, #d4af37, #000000);"></span>
                        Pure Darkness
                        <span class="theme-check" id="theme-check-pure-darkness"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('blood'); closeDropdowns();" data-theme-option="blood">
                        <span class="theme-color" style="background: linear-gradient(135deg, #dc2626, #7c3aed);"></span>
                        Blood
                        <span class="theme-check" id="theme-check-blood"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('necro'); closeDropdowns();" data-theme-option="necro">
                        <span class="theme-color" style="background: linear-gradient(135deg, #84cc16, #65a30d);"></span>
                        Necro
                        <span class="theme-check" id="theme-check-necro"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('royal'); closeDropdowns();" data-theme-option="royal">
                        <span class="theme-color" style="background: linear-gradient(135deg, #fbbf24, #9333ea);"></span>
                        Royal
                        <span class="theme-check" id="theme-check-royal"></span>
                    </button>
                    <button class="dropdown-item" onclick="setTheme('crimson'); closeDropdowns();" data-theme-option="crimson">
                        <span class="theme-color" style="background: linear-gradient(135deg, #be123c, #dc2626);"></span>
                        Crimson
                        <span class="theme-check" id="theme-check-crimson"></span>
                    </button>
                </div>
            </div>

            <!-- Help/Guide Button -->
            <button class="onboarding-help-btn" id="onboarding-help-btn" onclick="showOnboarding()" title="Getting Started Guide">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            </button>
        </div>

        <header class="header-compact">
            <div class="header-left">
                <a href="/" class="header-logo">
                    <span class="logo-text">Aedelore</span>
                </a>
            </div>
            <button class="mobile-menu-btn" id="mobile-menu-btn" onclick="toggleMobileMenu()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
        </header>

        <!-- Persistent Status Bar (hidden on dashboard) -->
        <div class="status-bar status-bar-hidden" id="status-bar">
            <div class="status-item status-hp" onclick="focusSlider('hp_slider')">
                <span class="status-icon">‚ù§Ô∏è</span>
                <span class="status-label">HP</span>
                <span class="status-value" id="status-hp-value">0/24</span>
                <div class="status-bar-fill">
                    <div class="status-bar-inner status-bar-hp" id="status-hp-bar" style="width: 0%"></div>
                </div>
            </div>
            <div class="status-item status-arcana" onclick="focusSlider('arcana_slider')" id="status-arcana-container">
                <span class="status-icon">‚ö°</span>
                <span class="status-label">Arcana</span>
                <span class="status-value" id="status-arcana-value">0/16</span>
                <div class="status-bar-fill">
                    <div class="status-bar-inner status-bar-arcana" id="status-arcana-bar" style="width: 0%"></div>
                </div>
            </div>
            <div class="status-item status-willpower" onclick="focusSlider('willpower_slider')">
                <span class="status-icon">üî∑</span>
                <span class="status-label">Will</span>
                <div class="status-dots" id="status-willpower-dots">
                    <span class="dot empty"></span>
                    <span class="dot empty"></span>
                    <span class="dot empty"></span>
                </div>
            </div>
            <div class="status-item status-bleed" onclick="focusSlider('bleed_slider')">
                <span class="status-icon">ü©∏</span>
                <span class="status-label">Bleed</span>
                <span class="status-value status-value-danger" id="status-bleed-value">0/6</span>
            </div>
            <div class="status-item status-weak" onclick="focusSlider('weakened_slider')">
                <span class="status-icon">üò´</span>
                <span class="status-label">Weak</span>
                <span class="status-value status-value-danger" id="status-weak-value">0/6</span>
            </div>
            <div class="status-item status-worthiness" onclick="focusSlider('worthiness_slider')">
                <span class="status-icon">‚≠ê</span>
                <span class="status-label">Worth</span>
                <span class="status-value status-value-gold" id="status-worthiness-value">0</span>
                <span class="status-desc" id="status-worthiness-desc">Nobody</span>
            </div>
        </div>

        <div class="tab-container">
            <div class="tab active" onclick="switchTab('page-dashboard')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg> Overview</div>
            <div class="tab" onclick="switchTab('page-info')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Character</div>
            <div class="tab" onclick="switchTab('page-attributes')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg> Stats</div>
            <div class="tab" onclick="switchTab('page-combat')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="M13 19l6-6"/><path d="M16 16l4 4"/><path d="M19 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg> Combat</div>
            <div class="tab" onclick="switchTab('page-spells')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/></svg> Abilities</div>
            <div class="tab" onclick="switchTab('page-gear')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg> Gear</div>
            <div class="tab" onclick="switchTab('page-tools')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"/><path d="M6 18h.01"/><path d="M10 14h.01"/><path d="M15 6h.01"/><path d="M18 9h.01"/></svg> Tools</div>
        </div>

        <!-- Page: Dashboard/Overview -->
        <div id="page-dashboard" class="tab-content active">
            <!-- Character Summary Card -->
            <div class="dashboard-hero">
                <div class="hero-avatar clickable" id="hero-avatar" onclick="showAvatarModal()" title="Click to change avatar">
                    <span class="avatar-placeholder" id="avatar-display">?</span>
                </div>
                <div class="hero-info">
                    <h2 class="hero-name" id="hero-name">New Character</h2>
                    <div class="hero-details">
                        <span class="hero-race" id="hero-race">Race</span>
                        <span class="hero-separator">‚Ä¢</span>
                        <span class="hero-class" id="hero-class">Class</span>
                        <span class="hero-separator">‚Ä¢</span>
                        <span class="hero-religion" id="hero-religion">Religion</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section dashboard-actions">
                <h3 class="section-title">Quick Actions</h3>

                <!-- Utility Row -->
                <div class="action-grid action-utility" style="margin-bottom: 16px;">
                    <button class="action-btn action-rest" onclick="quickRest()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                        <span>Rest</span>
                    </button>
                    <button class="action-btn action-half-rest" onclick="quickHalfRest()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/><line x1="9" y1="12" x2="15" y2="12"/></svg>
                        <span>Half Rest</span>
                    </button>
                    <button class="action-btn action-potion" onclick="usePotion()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 2v7.31"/><path d="M14 9.3V1.99"/><path d="M8.5 2h7"/><path d="M14 9.3a6.5 6.5 0 1 1-4 0"/></svg>
                        <span>Potion</span>
                    </button>
                    <button class="action-btn action-dice" onclick="switchTab('page-tools'); setTimeout(() => document.getElementById('tools-roll-btn').scrollIntoView(), 100);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="12" height="12" x="2" y="10" rx="2"/><path d="M6 18h.01"/><path d="M10 14h.01"/></svg>
                        <span>Dice</span>
                    </button>
                    <!-- Status (mobile/tablet only) -->
                    <div class="action-btn action-status mobile-only" id="quick-status">
                        <span>Status: ‚úì OK</span>
                    </div>
                    <!-- Worthiness (mobile/tablet only) -->
                    <div class="action-btn action-worth mobile-only" id="quick-worthiness">
                        <span>Worth: Nobody</span>
                    </div>
                </div>

                <!-- Resource Adjustments -->
                <div class="stat-adjust-grid">
                    <!-- HP Row -->
                    <div class="stat-adjust-row stat-hp">
                        <span class="stat-adjust-label">‚ù§Ô∏è HP <span class="stat-adjust-value" id="quick-hp-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="spendHP()">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="gainHP()">+1</button>
                        </div>
                    </div>
                    <!-- Arcana Row -->
                    <div class="stat-adjust-row stat-arcana">
                        <span class="stat-adjust-label">‚ú® Arcana <span class="stat-adjust-value" id="quick-arcana-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="spendArcana()">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="gainArcana()">+1</button>
                        </div>
                    </div>
                    <!-- Willpower Row -->
                    <div class="stat-adjust-row stat-will">
                        <span class="stat-adjust-label">üí™ Will <span class="stat-adjust-value" id="quick-will-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="spendWillpower()">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="gainWillpower()">+1</button>
                        </div>
                    </div>
                    <!-- Bleed Row -->
                    <div class="stat-adjust-row stat-bleed">
                        <span class="stat-adjust-label">ü©∏ Bleed <span class="stat-adjust-value" id="quick-bleed-value">0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="removeBleed()">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="addBleed()">+1</button>
                        </div>
                    </div>
                    <!-- Weakened Row -->
                    <div class="stat-adjust-row stat-weak">
                        <span class="stat-adjust-label">üò´ Weak <span class="stat-adjust-value" id="quick-weak-value">0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="removeWeakened()">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="addWeakened()">+1</button>
                        </div>
                    </div>
                    <!-- Worthiness Row -->
                    <div class="stat-adjust-row stat-worth">
                        <span class="stat-adjust-label">‚≠ê Worth <span class="stat-adjust-value" id="quick-worth-value">0</span> <span class="stat-adjust-desc" id="quick-worth-desc">(Nobody)</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="adjustWorthiness(-1)">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="adjustWorthiness(1)">+1</button>
                        </div>
                    </div>
                </div>

                <!-- Equipment HP Section -->
                <h4 class="quick-actions-subtitle">Equipment Damage</h4>
                <div class="stat-adjust-grid stat-adjust-grid-equipment" id="quick-equipment-grid">
                    <!-- Shield Row -->
                    <div class="stat-adjust-row stat-equip" id="quick-shield-row" style="display: none;">
                        <span class="stat-adjust-label">üõ°Ô∏è Shield <span class="stat-adjust-value" id="quick-shield-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="quickArmorDmg('shield', -1)">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="quickArmorDmg('shield', 1)">+1</button>
                        </div>
                    </div>
                    <!-- Head Row -->
                    <div class="stat-adjust-row stat-equip" id="quick-armor-1-row" style="display: none;">
                        <span class="stat-adjust-label">ü™ñ Head <span class="stat-adjust-value" id="quick-armor-1-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="quickArmorDmg('armor_1', -1)">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="quickArmorDmg('armor_1', 1)">+1</button>
                        </div>
                    </div>
                    <!-- Shoulders Row -->
                    <div class="stat-adjust-row stat-equip" id="quick-armor-2-row" style="display: none;">
                        <span class="stat-adjust-label">ü¶∫ Shoulders <span class="stat-adjust-value" id="quick-armor-2-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="quickArmorDmg('armor_2', -1)">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="quickArmorDmg('armor_2', 1)">+1</button>
                        </div>
                    </div>
                    <!-- Chest Row -->
                    <div class="stat-adjust-row stat-equip" id="quick-armor-3-row" style="display: none;">
                        <span class="stat-adjust-label">üëï Chest <span class="stat-adjust-value" id="quick-armor-3-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="quickArmorDmg('armor_3', -1)">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="quickArmorDmg('armor_3', 1)">+1</button>
                        </div>
                    </div>
                    <!-- Hands Row -->
                    <div class="stat-adjust-row stat-equip" id="quick-armor-4-row" style="display: none;">
                        <span class="stat-adjust-label">üß§ Hands <span class="stat-adjust-value" id="quick-armor-4-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="quickArmorDmg('armor_4', -1)">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="quickArmorDmg('armor_4', 1)">+1</button>
                        </div>
                    </div>
                    <!-- Legs Row -->
                    <div class="stat-adjust-row stat-equip" id="quick-armor-5-row" style="display: none;">
                        <span class="stat-adjust-label">üëñ Legs <span class="stat-adjust-value" id="quick-armor-5-value">0/0</span></span>
                        <div class="stat-adjust-buttons">
                            <button class="stat-btn stat-btn-minus" onclick="quickArmorDmg('armor_5', -1)">‚àí1</button>
                            <button class="stat-btn stat-btn-plus" onclick="quickArmorDmg('armor_5', 1)">+1</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weapons and Abilities Section -->
            <div class="section dashboard-weapons-abilities">
                <h3 class="section-title">Weapons & Abilities</h3>

                <!-- Equipped Weapons -->
                <div class="quick-weapons" id="quick-weapons-list">
                    <p class="empty-state">No weapons equipped</p>
                </div>

                <!-- Selected Abilities -->
                <h4 class="quick-actions-subtitle" style="margin-top: 16px;">Abilities</h4>
                <div class="quick-abilities" id="quick-abilities-list">
                    <p class="empty-state">No abilities selected</p>
                </div>
            </div>

            <!-- Quick Stats Preview -->
            <div class="section dashboard-stats collapsible" data-section-id="dashboard-quick-stats">
                <h2 class="section-title">Quick Stats <small style="color: var(--text-muted); font-weight: normal;">(tap for skills)</small></h2>
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card" onclick="toggleStatCard(this, 'strength')" data-attr="strength">
                        <span class="stat-card-expand-hint">‚ñº</span>
                        <span class="stat-label">Strength</span>
                        <span class="stat-value" id="dash-str">0</span>
                        <div class="stat-skills">
                            <div class="skill-item"><span class="skill-name">Athletics</span><span class="skill-value" id="dash-str-athletics">0</span></div>
                            <div class="skill-item"><span class="skill-name">Raw Power</span><span class="skill-value" id="dash-str-raw_power">0</span></div>
                            <div class="skill-item"><span class="skill-name">Unarmed</span><span class="skill-value" id="dash-str-unarmed">0</span></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="toggleStatCard(this, 'dexterity')" data-attr="dexterity">
                        <span class="stat-card-expand-hint">‚ñº</span>
                        <span class="stat-label">Dexterity</span>
                        <span class="stat-value" id="dash-dex">0</span>
                        <div class="stat-skills">
                            <div class="skill-item"><span class="skill-name">Endurance</span><span class="skill-value" id="dash-dex-endurance">0</span></div>
                            <div class="skill-item"><span class="skill-name">Acrobatics</span><span class="skill-value" id="dash-dex-acrobatics">0</span></div>
                            <div class="skill-item"><span class="skill-name">Sleight of Hand</span><span class="skill-value" id="dash-dex-sleight_of_hand">0</span></div>
                            <div class="skill-item"><span class="skill-name">Stealth</span><span class="skill-value" id="dash-dex-stealth">0</span></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="toggleStatCard(this, 'toughness')" data-attr="toughness">
                        <span class="stat-card-expand-hint">‚ñº</span>
                        <span class="stat-label">Toughness</span>
                        <span class="stat-value" id="dash-tough">0</span>
                        <div class="stat-skills">
                            <div class="skill-item"><span class="skill-name">Bonus While Injured</span><span class="skill-value" id="dash-tough-bonus_injured">0</span></div>
                            <div class="skill-item"><span class="skill-name">Resistance</span><span class="skill-value" id="dash-tough-resistance">0</span></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="toggleStatCard(this, 'intelligence')" data-attr="intelligence">
                        <span class="stat-card-expand-hint">‚ñº</span>
                        <span class="stat-label">Intelligence</span>
                        <span class="stat-value" id="dash-int">0</span>
                        <div class="stat-skills">
                            <div class="skill-item"><span class="skill-name">Arcana</span><span class="skill-value" id="dash-int-arcana">0</span></div>
                            <div class="skill-item"><span class="skill-name">History</span><span class="skill-value" id="dash-int-history">0</span></div>
                            <div class="skill-item"><span class="skill-name">Investigation</span><span class="skill-value" id="dash-int-investigation">0</span></div>
                            <div class="skill-item"><span class="skill-name">Nature</span><span class="skill-value" id="dash-int-nature">0</span></div>
                            <div class="skill-item"><span class="skill-name">Religion</span><span class="skill-value" id="dash-int-religion">0</span></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="toggleStatCard(this, 'wisdom')" data-attr="wisdom">
                        <span class="stat-card-expand-hint">‚ñº</span>
                        <span class="stat-label">Wisdom</span>
                        <span class="stat-value" id="dash-wis">0</span>
                        <div class="stat-skills">
                            <div class="skill-item"><span class="skill-name">Luck</span><span class="skill-value" id="dash-wis-luck">0</span></div>
                            <div class="skill-item"><span class="skill-name">Animal Handling</span><span class="skill-value" id="dash-wis-animal_handling">0</span></div>
                            <div class="skill-item"><span class="skill-name">Insight</span><span class="skill-value" id="dash-wis-insight">0</span></div>
                            <div class="skill-item"><span class="skill-name">Medicine</span><span class="skill-value" id="dash-wis-medicine">0</span></div>
                            <div class="skill-item"><span class="skill-name">Perception</span><span class="skill-value" id="dash-wis-perception">0</span></div>
                            <div class="skill-item"><span class="skill-name">Survival</span><span class="skill-value" id="dash-wis-survival">0</span></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="toggleStatCard(this, 'force_of_will')" data-attr="force_of_will">
                        <span class="stat-card-expand-hint">‚ñº</span>
                        <span class="stat-label">Force of Will</span>
                        <span class="stat-value" id="dash-fow">0</span>
                        <div class="stat-skills">
                            <div class="skill-item"><span class="skill-name">Deception</span><span class="skill-value" id="dash-fow-deception">0</span></div>
                            <div class="skill-item"><span class="skill-name">Intimidation</span><span class="skill-value" id="dash-fow-intimidation">0</span></div>
                            <div class="skill-item"><span class="skill-name">Performance</span><span class="skill-value" id="dash-fow-performance">0</span></div>
                            <div class="skill-item"><span class="skill-name">Persuasion</span><span class="skill-value" id="dash-fow-persuasion">0</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Character Info -->
        <div id="page-info" class="tab-content">
            <!-- Basic Info -->
            <div class="section">
                <div class="grid grid-2">
                    <div class="field-group">
                        <label>Character Name</label>
                        <input type="text" id="character_name" placeholder="Enter character name">
                    </div>
                    <div class="field-group">
                        <label>Player Name</label>
                        <input type="text" id="player_name" placeholder="Enter player name">
                    </div>
                    <div class="field-group">
                        <label>Race</label>
                        <select id="race">
                            <option value="">Select Race...</option>
                            <option value="Human">Human</option>
                            <option value="Dwarf">Dwarf</option>
                            <option value="Halfling">Halfling</option>
                            <option value="High Elf">High Elf</option>
                            <option value="Moon Elf">Moon Elf</option>
                            <option value="Orc">Orc</option>
                            <option value="Troll">Troll</option>
                        </select>
                    </div>
                    <div class="field-group">
                        <label>Class</label>
                        <select id="class">
                            <option value="">Select Class...</option>
                            <option value="Warrior">Warrior</option>
                            <option value="Thief/Rogue">Thief/Rogue</option>
                            <option value="Outcast">Outcast</option>
                            <option value="Mage">Mage</option>
                            <option value="Hunter">Hunter</option>
                            <option value="Druid">Druid</option>
                        </select>
                    </div>
                    <div class="field-group">
                        <label>Religion</label>
                        <select id="religion">
                            <option value="">Select Religion...</option>
                            <option value="Creed of Shadows (Noctara)">Creed of Shadows (Noctara)</option>
                            <option value="The Shattered Path (Tatsu)">The Shattered Path (Tatsu)</option>
                            <option value="The Silent Hunt (Groove Guardian)">The Silent Hunt (Groove Guardian)</option>
                            <option value="The Stone's Heart (Great Mountain)">The Stone's Heart (Great Mountain)</option>
                            <option value="The Veil of Tohu">The Veil of Tohu</option>
                            <option value="Earthsong Covenant">Earthsong Covenant</option>
                            <option value="The Flame of Taninsam">The Flame of Taninsam</option>
                            <option value="Nature's Embrace (Tiamat)">Nature's Embrace (Tiamat)</option>
                            <option value="The Soul of the Clan">The Soul of the Clan</option>
                            <option value="The Abyssal Veil">The Abyssal Veil</option>
                            <option value="The Radiant Path">The Radiant Path</option>
                            <option value="The Black Rebellion">The Black Rebellion</option>
                            <option value="The Arcane Creed">The Arcane Creed</option>
                            <option value="The Voices of the Forgotten Loa">The Voices of the Forgotten Loa</option>
                            <option value="None">None</option>
                        </select>
                    </div>
                </div>

                <!-- Character Progression (compact, inside basic info) -->
                <div class="progression-compact" id="progression-section" style="display: none;">
                    <span class="progression-xp" id="xp-value">0 XP</span>
                    <span class="progression-locks"><span id="lock-rc-icon">üîì</span>R/C <span id="lock-attr-icon">üîì</span>Attr <span id="lock-abil-icon">üîì</span>Abil</span>
                    <span class="progression-points" id="xp-available" style="display: none;"><strong id="available-points">0</strong>pt</span>
                    <button class="btn-tiny btn-gold" id="lock-race-class-btn" onclick="lockRaceClass()">üîí Lock</button>
                </div>
            </div>

            <!-- Miscs -->
            <div class="section collapsible" data-section-id="info-miscs">
                <h2 class="section-title">Miscs</h2>
                <textarea id="miscs" placeholder="Additional notes, items, or information..." rows="4"></textarea>

                <h3 style="color: var(--accent-gold); margin-top: 20px; margin-bottom: 10px;">Background</h3>
                <textarea id="background" placeholder="Enter your character's background story, history, and personality..." rows="6"></textarea>
            </div>

            <!-- Campaign Section -->
            <div class="section collapsible campaign-section" id="campaign-section" data-section-id="info-campaign" style="display: none;">
                <h2 class="section-title">Campaign</h2>
                <div class="campaign-content">
                    <div id="campaign-info">
                        <span class="no-campaign">Not linked to any campaign</span>
                    </div>
                    <div class="campaign-actions">
                        <button class="action-btn action-link" id="campaign-link-btn" onclick="showLinkCampaignModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                            Link to Campaign
                        </button>
                        <button class="action-btn action-unlink" id="campaign-unlink-btn" onclick="unlinkCharacterFromCampaign()" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m18.84 12.25 1.72-1.71a5 5 0 0 0-7.07-7.07l-3 3"/><path d="M5.16 11.75l-1.72 1.71a5 5 0 0 0 7.07 7.07l3-3"/><line x1="2" y1="2" x2="22" y2="22"/></svg>
                            Unlink
                        </button>
                    </div>
                </div>
                <!-- Party Members -->
                <div id="party-section" style="margin-top: 16px;">
                    <h3 style="color: var(--accent-blue); margin-bottom: 10px;">Party Members</h3>
                    <div id="party-list">
                        <p class="no-party">No other characters in this campaign yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Attributes -->
        <div id="page-attributes" class="tab-content">
            <!-- Willpower & Health -->
            <div class="section collapsible" data-section-id="stats-health">
                <h2 class="section-title">Willpower & Health</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Willpower Slider -->
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Willpower</span>
                            <span id="willpower-value-display">3 / 3</span>
                        </div>
                        <input type="range" id="willpower_slider" min="0" max="3" value="3">
                    </div>

                    <!-- HP Slider -->
                    <div class="slider-container">
                        <div class="slider-label">
                            <span style="color: #ef4444;">Health Points (HP)</span>
                            <span id="hp-value-display" style="color: #ef4444;">0 / 24</span>
                        </div>
                        <input type="range" id="hp_slider" min="0" max="24" value="0">
                    </div>
                </div>
            </div>

            <!-- Attribute Lock Status Bar (only visible when cloud-saved) -->
            <div class="attr-lock-bar" id="attr-lock-bar" style="display: none;">
                <!-- When race/class NOT locked -->
                <div id="attr-lock-msg-need-rc" class="lock-message lock-warning">
                    üîì Lock Race & Class first (in Character tab) before distributing points
                </div>
                <!-- When race/class locked but attributes NOT locked -->
                <div id="attr-lock-msg-ready" class="lock-message lock-ready" style="display: none;">
                    ‚úì Distribute your 10 points, then click:
                    <button class="btn-small btn-gold" id="lock-attributes-btn" onclick="lockAttributes()">üîí Lock Attributes</button>
                </div>
                <!-- When attributes ARE locked -->
                <div id="attr-lock-msg-locked" class="lock-message lock-done" style="display: none;">
                    üîí Attributes locked
                    <span id="attr-lock-xp-info"></span>
                </div>
            </div>

            <!-- Race/Class/Religion Bonuses -->
            <div class="section collapsible" data-section-id="stats-bonuses">
                <h2 class="section-title">Race, Class & Religion Bonuses</h2>
                <p id="free-points-note" style="color: var(--accent-gold); margin-bottom: 15px; padding: 12px 15px; background: linear-gradient(135deg, rgba(240, 192, 64, 0.15) 0%, rgba(240, 192, 64, 0.05) 100%); border-radius: 8px; border-left: 3px solid var(--accent-gold);">
                    <strong>Note:</strong> You have <strong>+10 free points</strong> to distribute among your attributes as you wish! No single talent may exceed 5 points at the start.
                </p>
                <div class="grid grid-3">
                    <div style="background: linear-gradient(180deg, rgba(59, 158, 255, 0.1) 0%, rgba(59, 158, 255, 0.02) 100%); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 158, 255, 0.3);">
                        <h3 id="race-bonuses-header" style="color: var(--primary-blue); margin-bottom: 10px;">Race Bonuses</h3>
                        <div id="race-bonuses" style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                            <em>Select a race to see bonuses</em>
                        </div>
                    </div>
                    <div style="background: linear-gradient(180deg, rgba(34, 217, 127, 0.1) 0%, rgba(34, 217, 127, 0.02) 100%); padding: 15px; border-radius: 8px; border: 1px solid rgba(34, 217, 127, 0.3);">
                        <h3 id="class-bonuses-header" style="color: var(--primary-green); margin-bottom: 10px;">Class Bonuses</h3>
                        <div id="class-bonuses" style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                            <em>Select a class to see bonuses</em>
                        </div>
                    </div>
                    <div style="background: linear-gradient(180deg, rgba(240, 192, 64, 0.1) 0%, rgba(240, 192, 64, 0.02) 100%); padding: 15px; border-radius: 8px; border: 1px solid rgba(240, 192, 64, 0.3);">
                        <h3 id="religion-bonuses-header" style="color: var(--accent-gold); margin-bottom: 10px;">Religion Bonuses</h3>
                        <div id="religion-bonuses" style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                            <em>Select a religion to see bonuses</em>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section collapsible" data-section-id="stats-attributes">
                <h2 class="section-title">Attributes <span id="attr-locked-badge">üîí Locked</span></h2>
                <div id="attributes-progression-msg" class="progression-message" style="display: none;"></div>
                <div class="grid grid-2">
                    <!-- Strength -->
                    <div class="attribute-section collapsible" data-attr-id="attr-strength">
                        <div class="attribute-header">
                            <span class="attribute-name">STRENGTH</span>
                            <div class="value-controls">
                                <button type="button" class="value-btn minus" onclick="adjustValue('strength_value', -1)">‚àí</button>
                                <input type="number" class="attribute-value" id="strength_value" placeholder="0">
                                <button type="button" class="value-btn plus" onclick="adjustValue('strength_value', 1)">+</button>
                            </div>
                        </div>
                        <div class="skill-list">
                            <div class="skill-item">
                                <span class="skill-name">Athletics</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('strength_athletics', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="strength_athletics" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('strength_athletics', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Raw Power</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('strength_raw_power', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="strength_raw_power" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('strength_raw_power', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Unarmed</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('strength_unarmed', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="strength_unarmed" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('strength_unarmed', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dexterity -->
                    <div class="attribute-section collapsible" data-attr-id="attr-dexterity">
                        <div class="attribute-header">
                            <span class="attribute-name">DEXTERITY</span>
                            <div class="value-controls">
                                <button type="button" class="value-btn minus" onclick="adjustValue('dexterity_value', -1)">‚àí</button>
                                <input type="number" class="attribute-value" id="dexterity_value" placeholder="0">
                                <button type="button" class="value-btn plus" onclick="adjustValue('dexterity_value', 1)">+</button>
                            </div>
                        </div>
                        <div class="skill-list">
                            <div class="skill-item">
                                <span class="skill-name">Endurance</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('dexterity_endurance', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="dexterity_endurance" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('dexterity_endurance', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Acrobatics</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('dexterity_acrobatics', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="dexterity_acrobatics" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('dexterity_acrobatics', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Sleight of Hand</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('dexterity_sleight_of_hand', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="dexterity_sleight_of_hand" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('dexterity_sleight_of_hand', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Stealth</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('dexterity_stealth', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="dexterity_stealth" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('dexterity_stealth', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Toughness -->
                    <div class="attribute-section collapsible" data-attr-id="attr-toughness">
                        <div class="attribute-header">
                            <span class="attribute-name">TOUGHNESS</span>
                            <div class="value-controls">
                                <button type="button" class="value-btn minus" onclick="adjustValue('toughness_value', -1)">‚àí</button>
                                <input type="number" class="attribute-value" id="toughness_value" placeholder="0">
                                <button type="button" class="value-btn plus" onclick="adjustValue('toughness_value', 1)">+</button>
                            </div>
                        </div>
                        <div class="skill-list">
                            <div class="skill-item">
                                <span class="skill-name">Bonus While Injured</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('toughness_bonus_while_injured', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="toughness_bonus_while_injured" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('toughness_bonus_while_injured', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Resistance</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('toughness_resistance', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="toughness_resistance" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('toughness_resistance', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Intelligence -->
                    <div class="attribute-section collapsible" data-attr-id="attr-intelligence">
                        <div class="attribute-header">
                            <span class="attribute-name">INTELLIGENCE</span>
                            <div class="value-controls">
                                <button type="button" class="value-btn minus" onclick="adjustValue('intelligence_value', -1)">‚àí</button>
                                <input type="number" class="attribute-value" id="intelligence_value" placeholder="0">
                                <button type="button" class="value-btn plus" onclick="adjustValue('intelligence_value', 1)">+</button>
                            </div>
                        </div>
                        <div class="skill-list">
                            <div class="skill-item">
                                <span class="skill-name">Arcana (1p = 1 regen/rest)</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('intelligence_arcana', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="intelligence_arcana" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('intelligence_arcana', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">History</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('intelligence_history', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="intelligence_history" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('intelligence_history', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Investigation</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('intelligence_investigation', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="intelligence_investigation" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('intelligence_investigation', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Nature</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('intelligence_nature', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="intelligence_nature" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('intelligence_nature', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Religion</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('intelligence_religion', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="intelligence_religion" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('intelligence_religion', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wisdom -->
                    <div class="attribute-section collapsible" data-attr-id="attr-wisdom">
                        <div class="attribute-header">
                            <span class="attribute-name">WISDOM</span>
                            <div class="value-controls">
                                <button type="button" class="value-btn minus" onclick="adjustValue('wisdom_value', -1)">‚àí</button>
                                <input type="number" class="attribute-value" id="wisdom_value" placeholder="0">
                                <button type="button" class="value-btn plus" onclick="adjustValue('wisdom_value', 1)">+</button>
                            </div>
                        </div>
                        <div class="skill-list">
                            <div class="skill-item">
                                <span class="skill-name">Luck</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('wisdom_luck', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="wisdom_luck" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('wisdom_luck', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Animal Handling</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('wisdom_animal_handling', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="wisdom_animal_handling" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('wisdom_animal_handling', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Insight</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('wisdom_insight', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="wisdom_insight" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('wisdom_insight', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Medicine</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('wisdom_medicine', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="wisdom_medicine" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('wisdom_medicine', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Perception</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('wisdom_perception', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="wisdom_perception" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('wisdom_perception', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Survival</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('wisdom_survival', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="wisdom_survival" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('wisdom_survival', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Force of Will -->
                    <div class="attribute-section collapsible" data-attr-id="attr-force-of-will">
                        <div class="attribute-header">
                            <span class="attribute-name">FORCE OF WILL</span>
                            <div class="value-controls">
                                <button type="button" class="value-btn minus" onclick="adjustValue('force_of_will_value', -1)">‚àí</button>
                                <input type="number" class="attribute-value" id="force_of_will_value" placeholder="0">
                                <button type="button" class="value-btn plus" onclick="adjustValue('force_of_will_value', 1)">+</button>
                            </div>
                        </div>
                        <div class="skill-list">
                            <div class="skill-item">
                                <span class="skill-name">Deception</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('force_of_will_deception', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="force_of_will_deception" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('force_of_will_deception', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Intimidation</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('force_of_will_intimidation', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="force_of_will_intimidation" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('force_of_will_intimidation', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Performance</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('force_of_will_performance', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="force_of_will_performance" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('force_of_will_performance', 1)">+</button>
                                </div>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Persuasion</span>
                                <div class="value-controls">
                                    <button type="button" class="value-btn minus" onclick="adjustValue('force_of_will_persuasion', -1)">‚àí</button>
                                    <input type="number" class="skill-value" id="force_of_will_persuasion" placeholder="0">
                                    <button type="button" class="value-btn plus" onclick="adjustValue('force_of_will_persuasion', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Third Eye -->
                    <div class="attribute-section collapsible" data-attr-id="attr-third-eye">
                        <div class="attribute-header">
                            <span class="attribute-name">THIRD EYE</span>
                            <div class="value-controls">
                                <button type="button" class="value-btn minus" onclick="adjustValue('third_eye_value', -1)">‚àí</button>
                                <input type="number" class="attribute-value" id="third_eye_value" placeholder="0">
                                <button type="button" class="value-btn plus" onclick="adjustValue('third_eye_value', 1)">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Worthiness / Reputation -->
                    <div class="attribute-section collapsible" data-attr-id="attr-worthiness">
                        <div class="attribute-header">
                            <span class="attribute-name">WORTHINESS / REPUTATION</span>
                        </div>
                        <div class="skill-list">
                            <p style="color: var(--text-secondary); font-size: 0.85rem; font-style: italic; padding: 5px 10px; margin-bottom: 10px;">
                                Influences how NPCs treat you. Higher = more respect and trust.
                            </p>
                            <div class="slider-container" style="max-width: 400px; margin: 0 10px;">
                                <div class="slider-label">
                                    <span>Worthiness</span>
                                    <span id="worthiness-value-display">0 / 10</span>
                                </div>
                                <input type="range" id="worthiness_slider" min="-10" max="10" value="0">
                                <p id="worthiness-description" style="margin-top: 10px; padding: 8px; background: rgba(139, 92, 246, 0.1); border-radius: 5px; font-size: 0.85rem; font-style: italic; text-align: center; min-height: 45px;">
                                    People don't care about you, you are a nobody
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Combat & Equipment -->
        <div id="page-combat" class="tab-content">
            <!-- Shield -->
            <div class="section collapsible" data-section-id="combat-shield">
                <h2 class="section-title">Shield</h2>
                <div class="table-section">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Hitpoints</th>
                                <th>Block Value</th>
                                <th>Defence</th>
                                <th>Damage</th>
                                <th>Dmg on Shield</th>
                                <th>Broken</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="shield_row">
                                <td>
                                    <select id="shield_type">
                                        <option value="">Shield type</option>
                                        <option value="Shield (Wooden)">Shield (Wooden)</option>
                                        <option value="Shield (Metal)">Shield (Metal)</option>
                                        <option value="Shield (Tower)">Shield (Tower)</option>
                                        <option value="Small Shield">Small Shield</option>
                                        <option value="Spiked Shield">Spiked Shield</option>
                                    </select>
                                </td>
                                <td><input type="number" id="shield_hp" placeholder="HP"></td>
                                <td><input type="number" id="shield_block" placeholder="Block"></td>
                                <td><input type="number" id="shield_defence" placeholder="Defence"></td>
                                <td><input type="text" id="shield_dmg" placeholder="Damage"></td>
                                <td>
                                    <div class="value-controls">
                                        <button type="button" class="value-btn minus" onclick="adjustValue('shield_dmg_taken', -1)">‚àí</button>
                                        <input type="number" id="shield_dmg_taken" placeholder="0">
                                        <button type="button" class="value-btn plus" onclick="adjustValue('shield_dmg_taken', 1)">+</button>
                                    </div>
                                </td>
                                <td style="text-align: center;"><input type="checkbox" id="shield_broken" onchange="toggleShieldBroken()"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Shield datalist -->
                <datalist id="shield-list">
                    <option value="Shield (Wooden)">
                    <option value="Shield (Metal)">
                    <option value="Shield (Tower)">
                    <option value="Spiked Shield">
                </datalist>
            </div>

            <!-- Armor -->
            <div class="section collapsible" data-section-id="combat-armour">
                <h2 class="section-title">Armour</h2>
                <div class="table-section">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Hitpoints</th>
                                <th>Block</th>
                                <th>Dmg on Armour</th>
                                <th>Disadvantage</th>
                                <th>Broken</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="armor_1_row">
                                <td>
                                    <span class="armor-slot-label">Head</span>
                                    <select id="armor_1_type">
                                        <option value="">Select...</option>
                                        <option value="Cloth Hood">Cloth Hood</option>
                                        <option value="Leather Cap">Leather Cap</option>
                                        <option value="Chain Coif">Chain Coif</option>
                                        <option value="Light Helmet">Light Helmet</option>
                                        <option value="Heavy Helmet">Heavy Helmet</option>
                                        <option value="Great Helm">Great Helm</option>
                                    </select>
                                </td>
                                <td><input type="number" id="armor_1_hp" placeholder="HP"></td>
                                <td><input type="text" id="armor_1_bonus" placeholder="4+block"></td>
                                <td>
                                    <div class="value-controls">
                                        <button type="button" class="value-btn minus" onclick="adjustValue('armor_1_dmg', -1)">‚àí</button>
                                        <input type="number" id="armor_1_dmg" placeholder="0">
                                        <button type="button" class="value-btn plus" onclick="adjustValue('armor_1_dmg', 1)">+</button>
                                    </div>
                                </td>
                                <td><input type="text" id="armor_1_disadvantage" placeholder="Disadvantage"></td>
                                <td style="text-align: center;"><input type="checkbox" id="armor_1_broken" onchange="toggleArmorBroken(1)"></td>
                            </tr>
                            <tr id="armor_2_row">
                                <td>
                                    <span class="armor-slot-label">Shoulders</span>
                                    <select id="armor_2_type">
                                        <option value="">Select...</option>
                                        <option value="Cloth Mantle">Cloth Mantle</option>
                                        <option value="Leather Pauldrons">Leather Pauldrons</option>
                                        <option value="Studded Pauldrons">Studded Pauldrons</option>
                                        <option value="Chain Pauldrons">Chain Pauldrons</option>
                                        <option value="Plate Pauldrons">Plate Pauldrons</option>
                                    </select>
                                </td>
                                <td><input type="number" id="armor_2_hp" placeholder="HP"></td>
                                <td><input type="text" id="armor_2_bonus" placeholder="4+block"></td>
                                <td>
                                    <div class="value-controls">
                                        <button type="button" class="value-btn minus" onclick="adjustValue('armor_2_dmg', -1)">‚àí</button>
                                        <input type="number" id="armor_2_dmg" placeholder="0">
                                        <button type="button" class="value-btn plus" onclick="adjustValue('armor_2_dmg', 1)">+</button>
                                    </div>
                                </td>
                                <td><input type="text" id="armor_2_disadvantage" placeholder="Disadvantage"></td>
                                <td style="text-align: center;"><input type="checkbox" id="armor_2_broken" onchange="toggleArmorBroken(2)"></td>
                            </tr>
                            <tr id="armor_3_row">
                                <td>
                                    <span class="armor-slot-label">Chest</span>
                                    <select id="armor_3_type">
                                        <option value="">Select...</option>
                                        <option value="Cloth">Cloth</option>
                                        <option value="Padded">Padded</option>
                                        <option value="Leather">Leather</option>
                                        <option value="Studded Leather">Studded Leather</option>
                                        <option value="Hide">Hide</option>
                                        <option value="Chain Shirt">Chain Shirt</option>
                                        <option value="Scale Mail">Scale Mail</option>
                                        <option value="Breastplate">Breastplate</option>
                                        <option value="Half Plate">Half Plate</option>
                                        <option value="Ring Mail">Ring Mail</option>
                                        <option value="Chainmail">Chainmail</option>
                                        <option value="Splint">Splint</option>
                                        <option value="Plate">Plate</option>
                                    </select>
                                </td>
                                <td><input type="number" id="armor_3_hp" placeholder="HP"></td>
                                <td><input type="text" id="armor_3_bonus" placeholder="4+block"></td>
                                <td>
                                    <div class="value-controls">
                                        <button type="button" class="value-btn minus" onclick="adjustValue('armor_3_dmg', -1)">‚àí</button>
                                        <input type="number" id="armor_3_dmg" placeholder="0">
                                        <button type="button" class="value-btn plus" onclick="adjustValue('armor_3_dmg', 1)">+</button>
                                    </div>
                                </td>
                                <td><input type="text" id="armor_3_disadvantage" placeholder="Disadvantage"></td>
                                <td style="text-align: center;"><input type="checkbox" id="armor_3_broken" onchange="toggleArmorBroken(3)"></td>
                            </tr>
                            <tr id="armor_4_row">
                                <td>
                                    <span class="armor-slot-label">Hands</span>
                                    <select id="armor_4_type">
                                        <option value="">Select...</option>
                                        <option value="Cloth Gloves">Cloth Gloves</option>
                                        <option value="Leather Gloves">Leather Gloves</option>
                                        <option value="Studded Gloves">Studded Gloves</option>
                                        <option value="Chain Gloves">Chain Gloves</option>
                                        <option value="Plate Gauntlets">Plate Gauntlets</option>
                                    </select>
                                </td>
                                <td><input type="number" id="armor_4_hp" placeholder="HP"></td>
                                <td><input type="text" id="armor_4_bonus" placeholder="4+block"></td>
                                <td>
                                    <div class="value-controls">
                                        <button type="button" class="value-btn minus" onclick="adjustValue('armor_4_dmg', -1)">‚àí</button>
                                        <input type="number" id="armor_4_dmg" placeholder="0">
                                        <button type="button" class="value-btn plus" onclick="adjustValue('armor_4_dmg', 1)">+</button>
                                    </div>
                                </td>
                                <td><input type="text" id="armor_4_disadvantage" placeholder="Disadvantage"></td>
                                <td style="text-align: center;"><input type="checkbox" id="armor_4_broken" onchange="toggleArmorBroken(4)"></td>
                            </tr>
                            <tr id="armor_5_row">
                                <td>
                                    <span class="armor-slot-label">Legs</span>
                                    <select id="armor_5_type">
                                        <option value="">Select...</option>
                                        <option value="Cloth Pants">Cloth Pants</option>
                                        <option value="Leather Greaves">Leather Greaves</option>
                                        <option value="Studded Greaves">Studded Greaves</option>
                                        <option value="Chain Greaves">Chain Greaves</option>
                                        <option value="Plate Greaves">Plate Greaves</option>
                                    </select>
                                </td>
                                <td><input type="number" id="armor_5_hp" placeholder="HP"></td>
                                <td><input type="text" id="armor_5_bonus" placeholder="4+block"></td>
                                <td>
                                    <div class="value-controls">
                                        <button type="button" class="value-btn minus" onclick="adjustValue('armor_5_dmg', -1)">‚àí</button>
                                        <input type="number" id="armor_5_dmg" placeholder="0">
                                        <button type="button" class="value-btn plus" onclick="adjustValue('armor_5_dmg', 1)">+</button>
                                    </div>
                                </td>
                                <td><input type="text" id="armor_5_disadvantage" placeholder="Disadvantage"></td>
                                <td style="text-align: center;"><input type="checkbox" id="armor_5_broken" onchange="toggleArmorBroken(5)"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Armor datalist -->
                <datalist id="armor-list">
                    <option value="Padded">
                    <option value="Leather">
                    <option value="Studded Leather">
                    <option value="Hide">
                    <option value="Chain Shirt">
                    <option value="Scale Mail">
                    <option value="Breastplate">
                    <option value="Half Plate">
                    <option value="Ring Mail">
                    <option value="Chain Mail">
                    <option value="Splint">
                    <option value="Plate">
                </datalist>
            </div>

            <!-- Weapons -->
            <div class="section collapsible" data-section-id="combat-weapons">
                <h2 class="section-title">Weapons</h2>
                <div class="table-section">
                    <table>
                        <thead>
                            <tr>
                                <th>Weapon</th>
                                <th>Atk Bonus</th>
                                <th>Damage</th>
                                <th>Range</th>
                                <th>Break</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <select id="weapon_1_type">
                                        <option value="">Weapon 1</option>
                                        <option value="Club">Club</option>
                                        <option value="Dagger">Dagger</option>
                                        <option value="Greatclub">Greatclub</option>
                                        <option value="Handaxe">Handaxe</option>
                                        <option value="Javelin">Javelin</option>
                                        <option value="Light Hammer">Light Hammer</option>
                                        <option value="Mace">Mace</option>
                                        <option value="Quarterstaff">Quarterstaff</option>
                                        <option value="Sickle">Sickle</option>
                                        <option value="Spear">Spear</option>
                                        <option value="Battleaxe">Battleaxe</option>
                                        <option value="Flail">Flail</option>
                                        <option value="Glaive">Glaive</option>
                                        <option value="Greataxe">Greataxe</option>
                                        <option value="Greatsword">Greatsword</option>
                                        <option value="Halberd">Halberd</option>
                                        <option value="Lance">Lance</option>
                                        <option value="Longsword">Longsword</option>
                                        <option value="Maul">Maul</option>
                                        <option value="Morningstar">Morningstar</option>
                                        <option value="Pike">Pike</option>
                                        <option value="Rapier">Rapier</option>
                                        <option value="Scimitar">Scimitar</option>
                                        <option value="Shortsword">Shortsword</option>
                                        <option value="Trident">Trident</option>
                                        <option value="War Pick">War Pick</option>
                                        <option value="Warhammer">Warhammer</option>
                                        <option value="Whip">Whip</option>
                                        <option value="Crossbow (Light)">Crossbow (Light)</option>
                                        <option value="Dart">Dart</option>
                                        <option value="Shortbow">Shortbow</option>
                                        <option value="Sling">Sling</option>
                                        <option value="Blowgun">Blowgun</option>
                                        <option value="Crossbow (Hand)">Crossbow (Hand)</option>
                                        <option value="Crossbow (Heavy)">Crossbow (Heavy)</option>
                                        <option value="Longbow">Longbow</option>
                                        <option value="Net">Net</option>
                                        <option value="Falchion">Falchion</option>
                                        <option value="Claymore">Claymore</option>
                                        <option value="Katana">Katana</option>
                                        <option value="Guisarme">Guisarme</option>
                                        <option value="Scythe">Scythe</option>
                                        <option value="Throwing Axe">Throwing Axe</option>
                                        <option value="Chakram">Chakram</option>
                                        <option value="Flamberge">Flamberge</option>
                                        <option value="Bone Club">Bone Club</option>
                                    </select>
                                </td>
                                <td><input type="text" id="weapon_1_atk" placeholder="+X"></td>
                                <td><input type="text" id="weapon_1_dmg" placeholder="1d8"></td>
                                <td><input type="text" id="weapon_1_range" placeholder="Range"></td>
                                <td><input type="text" id="weapon_1_break" placeholder="Break"></td>
                            </tr>
                            <tr>
                                <td>
                                    <select id="weapon_2_type">
                                        <option value="">Weapon 2</option>
                                        <option value="Club">Club</option>
                                        <option value="Dagger">Dagger</option>
                                        <option value="Greatclub">Greatclub</option>
                                        <option value="Handaxe">Handaxe</option>
                                        <option value="Javelin">Javelin</option>
                                        <option value="Light Hammer">Light Hammer</option>
                                        <option value="Mace">Mace</option>
                                        <option value="Quarterstaff">Quarterstaff</option>
                                        <option value="Sickle">Sickle</option>
                                        <option value="Spear">Spear</option>
                                        <option value="Battleaxe">Battleaxe</option>
                                        <option value="Flail">Flail</option>
                                        <option value="Glaive">Glaive</option>
                                        <option value="Greataxe">Greataxe</option>
                                        <option value="Greatsword">Greatsword</option>
                                        <option value="Halberd">Halberd</option>
                                        <option value="Lance">Lance</option>
                                        <option value="Longsword">Longsword</option>
                                        <option value="Maul">Maul</option>
                                        <option value="Morningstar">Morningstar</option>
                                        <option value="Pike">Pike</option>
                                        <option value="Rapier">Rapier</option>
                                        <option value="Scimitar">Scimitar</option>
                                        <option value="Shortsword">Shortsword</option>
                                        <option value="Trident">Trident</option>
                                        <option value="War Pick">War Pick</option>
                                        <option value="Warhammer">Warhammer</option>
                                        <option value="Whip">Whip</option>
                                        <option value="Crossbow (Light)">Crossbow (Light)</option>
                                        <option value="Dart">Dart</option>
                                        <option value="Shortbow">Shortbow</option>
                                        <option value="Sling">Sling</option>
                                        <option value="Blowgun">Blowgun</option>
                                        <option value="Crossbow (Hand)">Crossbow (Hand)</option>
                                        <option value="Crossbow (Heavy)">Crossbow (Heavy)</option>
                                        <option value="Longbow">Longbow</option>
                                        <option value="Net">Net</option>
                                        <option value="Falchion">Falchion</option>
                                        <option value="Claymore">Claymore</option>
                                        <option value="Katana">Katana</option>
                                        <option value="Guisarme">Guisarme</option>
                                        <option value="Scythe">Scythe</option>
                                        <option value="Throwing Axe">Throwing Axe</option>
                                        <option value="Chakram">Chakram</option>
                                        <option value="Flamberge">Flamberge</option>
                                        <option value="Bone Club">Bone Club</option>
                                    </select>
                                </td>
                                <td><input type="text" id="weapon_2_atk" placeholder="+X"></td>
                                <td><input type="text" id="weapon_2_dmg" placeholder="1d6"></td>
                                <td><input type="text" id="weapon_2_range" placeholder="Range"></td>
                                <td><input type="text" id="weapon_2_break" placeholder="Break"></td>
                            </tr>
                            <tr>
                                <td>
                                    <select id="weapon_3_type">
                                        <option value="">Weapon 3</option>
                                        <option value="Club">Club</option>
                                        <option value="Dagger">Dagger</option>
                                        <option value="Greatclub">Greatclub</option>
                                        <option value="Handaxe">Handaxe</option>
                                        <option value="Javelin">Javelin</option>
                                        <option value="Light Hammer">Light Hammer</option>
                                        <option value="Mace">Mace</option>
                                        <option value="Quarterstaff">Quarterstaff</option>
                                        <option value="Sickle">Sickle</option>
                                        <option value="Spear">Spear</option>
                                        <option value="Battleaxe">Battleaxe</option>
                                        <option value="Flail">Flail</option>
                                        <option value="Glaive">Glaive</option>
                                        <option value="Greataxe">Greataxe</option>
                                        <option value="Greatsword">Greatsword</option>
                                        <option value="Halberd">Halberd</option>
                                        <option value="Lance">Lance</option>
                                        <option value="Longsword">Longsword</option>
                                        <option value="Maul">Maul</option>
                                        <option value="Morningstar">Morningstar</option>
                                        <option value="Pike">Pike</option>
                                        <option value="Rapier">Rapier</option>
                                        <option value="Scimitar">Scimitar</option>
                                        <option value="Shortsword">Shortsword</option>
                                        <option value="Trident">Trident</option>
                                        <option value="War Pick">War Pick</option>
                                        <option value="Warhammer">Warhammer</option>
                                        <option value="Whip">Whip</option>
                                        <option value="Crossbow (Light)">Crossbow (Light)</option>
                                        <option value="Dart">Dart</option>
                                        <option value="Shortbow">Shortbow</option>
                                        <option value="Sling">Sling</option>
                                        <option value="Blowgun">Blowgun</option>
                                        <option value="Crossbow (Hand)">Crossbow (Hand)</option>
                                        <option value="Crossbow (Heavy)">Crossbow (Heavy)</option>
                                        <option value="Longbow">Longbow</option>
                                        <option value="Net">Net</option>
                                        <option value="Falchion">Falchion</option>
                                        <option value="Claymore">Claymore</option>
                                        <option value="Katana">Katana</option>
                                        <option value="Guisarme">Guisarme</option>
                                        <option value="Scythe">Scythe</option>
                                        <option value="Throwing Axe">Throwing Axe</option>
                                        <option value="Chakram">Chakram</option>
                                        <option value="Flamberge">Flamberge</option>
                                        <option value="Bone Club">Bone Club</option>
                                    </select>
                                </td>
                                <td><input type="text" id="weapon_3_atk" placeholder="+X"></td>
                                <td><input type="text" id="weapon_3_dmg" placeholder="1d4"></td>
                                <td><input type="text" id="weapon_3_range" placeholder="Range"></td>
                                <td><input type="text" id="weapon_3_break" placeholder="Break"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Weapon datalist for autocomplete -->
                <datalist id="weapons-list">
                    <option value="Club">
                    <option value="Dagger">
                    <option value="Greatclub">
                    <option value="Handaxe">
                    <option value="Javelin">
                    <option value="Light Hammer">
                    <option value="Mace">
                    <option value="Quarterstaff">
                    <option value="Sickle">
                    <option value="Spear">
                    <option value="Battleaxe">
                    <option value="Flail">
                    <option value="Glaive">
                    <option value="Greataxe">
                    <option value="Greatsword">
                    <option value="Halberd">
                    <option value="Lance">
                    <option value="Longsword">
                    <option value="Maul">
                    <option value="Morningstar">
                    <option value="Pike">
                    <option value="Rapier">
                    <option value="Scimitar">
                    <option value="Shortsword">
                    <option value="Trident">
                    <option value="War Pick">
                    <option value="Warhammer">
                    <option value="Whip">
                    <option value="Crossbow (Light)">
                    <option value="Dart">
                    <option value="Shortbow">
                    <option value="Sling">
                    <option value="Blowgun">
                    <option value="Crossbow (Hand)">
                    <option value="Crossbow (Heavy)">
                    <option value="Longbow">
                    <option value="Net">
                    <option value="Falchion">
                    <option value="Claymore">
                    <option value="Katana">
                    <option value="Guisarme">
                    <option value="Scythe">
                    <option value="Throwing Axe">
                    <option value="Chakram">
                    <option value="Flamberge">
                    <option value="Bone Club">
                </datalist>
            </div>

            <!-- Equipment -->
            <div class="section collapsible" data-section-id="combat-equipment">
                <h2 class="section-title">Equipment</h2>
                <div class="grid grid-3">
                    <div class="field-group">
                        <label>Equipment 1</label>
                        <input type="text" id="equipment_1" placeholder="Equipment 1">
                    </div>
                    <div class="field-group">
                        <label>Equipment 2</label>
                        <input type="text" id="equipment_2" placeholder="Equipment 2">
                    </div>
                </div>
            </div>

            <!-- Injuries Section -->
            <div class="section collapsible" data-section-id="combat-injuries">
                <h2 class="section-title" style="color: #ef4444;">Injuries</h2>
                <div style="padding: 15px; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 8px;">
                    <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9rem;">
                        If injured you get to use Bonus while Injured (+1D10)
                    </p>
                    <div class="field-group" style="margin-bottom: 15px;">
                        <label>Injury Details</label>
                        <textarea id="injuries_text" placeholder="Describe injuries..." style="width: 100%; min-height: 60px;"></textarea>
                    </div>

                    <!-- Bleed and Weakened Sliders (side by side) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <!-- Bleed Slider -->
                        <div class="slider-container">
                            <div class="slider-label">
                                <span style="color: #ef4444;">Bleed per Round</span>
                                <span id="bleed-value" style="color: #ef4444;">0</span>
                            </div>
                            <input type="range" id="bleed_slider" min="0" max="6" value="0">
                            <!-- Bleed warning at 6 -->
                            <div id="bleed-warning" style="display: none; margin-top: 10px; padding: 10px; background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; border-radius: 5px; color: #fca5a5; font-size: 0.9rem;">
                                <strong><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: text-bottom;"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg> Maximum Bleeding!</strong><br>
                                Roll 1D6 per turn:<br>
                                ‚Ä¢ 1-2: Death<br>
                                ‚Ä¢ 3-4: Lose 2 HP<br>
                                ‚Ä¢ 5-6: Lose 1 HP
                            </div>
                        </div>

                        <!-- Weakened Slider -->
                        <div class="slider-container">
                            <div class="slider-label">
                                <span style="color: #ef4444;">Weakened per Round</span>
                                <span id="weakened-value" style="color: #ef4444;">0</span>
                            </div>
                            <input type="range" id="weakened_slider" min="0" max="6" value="0">
                            <!-- Weakened warning at 6 -->
                            <div id="weakened-warning" style="display: none; margin-top: 10px; padding: 10px; background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; border-radius: 5px; color: #fca5a5; font-size: 0.9rem;">
                                <strong><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: text-bottom;"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg> Exhausted!</strong><br>
                                Roll 1D10 + Toughness:<br>
                                ‚Ä¢ 1-2: Death<br>
                                ‚Ä¢ 3-5: Fainting<br>
                                ‚Ä¢ 6-10: Can move but cannot fight
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Spells & Abilities -->
        <div id="page-spells" class="tab-content">
            <!-- Spells -->
            <div class="section collapsible" data-section-id="abilities-spells">
                <h2 class="section-title">Spells & Abilities <span id="abil-locked-badge" class="locked-badge" style="display: none;"></span></h2>
                <div id="abilities-progression-msg" class="progression-message" style="display: none;"></div>
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9rem;">
                    Check: Arkana + 1D10 minimum 1 success
                </p>
                <div class="table-section">
                    <table>
                        <thead id="spells-table-header">
                            <tr>
                                <th>Type</th>
                                <th id="spell-column-2" style="color: var(--primary-purple);">Arcana Cost</th>
                                <th id="spell-column-3" style="color: var(--accent-gold); display: none;">Gain</th>
                                <th id="spell-column-4" style="color: #ef4444;">Weakened Cost</th>
                            </tr>
                        </thead>
                        <tbody id="spells-table">
                            <!-- JavaScript will populate -->
                        </tbody>
                    </table>
                </div>

                <!-- Arcana Slider -->
                <div class="slider-container" style="margin-top: 25px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(168, 85, 247, 0.05) 100%); border: 1px solid rgba(168, 85, 247, 0.4); box-shadow: 0 0 20px rgba(168, 85, 247, 0.1);">
                    <div class="slider-label">
                        <span style="color: var(--primary-purple); font-weight: bold; font-size: 1.1rem; text-shadow: 0 0 10px rgba(168, 85, 247, 0.5);">Arcana</span>
                        <span id="arcana-value-display" style="color: var(--primary-purple);">0 / 16</span>
                    </div>
                    <input type="range" id="arcana_slider" min="0" max="16" value="0" disabled>
                    <p style="color: var(--text-secondary); margin-top: 10px; font-size: 0.9rem; font-style: italic;">
                        Regen 1/round or 2/rest
                    </p>
                </div>
            </div>
        </div>

        <!-- Page: Gear (Combined Consumables + Inventory) -->
        <div id="page-gear" class="tab-content">
            <!-- Money Section (Promoted to top) -->
            <div class="section collapsible" data-section-id="gear-money">
                <h2 class="section-title">üí∞ Money</h2>
                <div class="grid grid-3">
                    <div class="field-group">
                        <label>Gold</label>
                        <input type="number" id="gold" placeholder="0">
                    </div>
                    <div class="field-group">
                        <label>Silver</label>
                        <input type="number" id="silver" placeholder="0">
                    </div>
                    <div class="field-group">
                        <label>Copper</label>
                        <input type="number" id="copper" placeholder="0">
                    </div>
                </div>
            </div>

            <!-- Consumables Section -->
            <div class="section collapsible" data-section-id="gear-consumables">
                <h2 class="section-title">üß™ Consumables</h2>
                <div class="grid grid-2">
                    <div>
                        <h3 style="color: var(--primary-green); margin-bottom: 10px;">Food & Water</h3>
                        <div class="field-group">
                            <input type="text" id="food_water_1" placeholder="e.g., 1D10 rations">
                        </div>
                        <div class="field-group">
                            <input type="text" id="food_water_2" placeholder="e.g., Water flask">
                        </div>
                    </div>

                    <div>
                        <h3 style="color: var(--primary-green); margin-bottom: 10px;">Potions</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Adrenaline (ignore 1 HP dmg/shot)</span>
                                <span id="pot-adrenaline-value">3</span>
                            </div>
                            <input type="range" id="pot_adrenaline_slider" min="0" max="3" value="3">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Antidote (halts poison 1 rnd/shot)</span>
                                <span id="pot-antidote-value">3</span>
                            </div>
                            <input type="range" id="pot_antidote_slider" min="0" max="3" value="3">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Poison (1 HP dmg/shot/round)</span>
                                <span id="pot-poison-value">3</span>
                            </div>
                            <input type="range" id="pot_poison_slider" min="0" max="3" value="3">
                        </div>
                        <div class="slider-container" id="arcane-elixir-container" style="display: none;">
                            <div class="slider-label">
                                <span>Arcane Elixir (10 arcana/shot)</span>
                                <span id="pot-arcane-value">0</span>
                            </div>
                            <input type="range" id="pot_arcane_slider" min="0" max="2" value="0">
                        </div>
                    </div>

                    <div>
                        <h3 style="color: var(--primary-blue); margin-bottom: 10px;">Arrows</h3>
                        <div class="field-group">
                            <input type="text" id="arrows" placeholder="e.g., 1D10 arrows">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Poison Arrows</span>
                                <span id="poison-arrow-value">0</span>
                            </div>
                            <input type="range" id="poison_arrow_slider" min="0" max="6" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Section -->
            <div class="section collapsible" data-section-id="gear-inventory">
                <h2 class="section-title">üéí Inventory</h2>
                <div class="inventory-grid">
                    <div class="inventory-column">
                        <h3 style="color: var(--accent-gold); margin-bottom: 10px;">Items (10 slots)</h3>
                        <div id="gear-inventory-container"></div>
                    </div>
                    <div class="inventory-column">
                        <h3 style="color: var(--primary-purple); margin-bottom: 10px;">Reminders</h3>
                        <div id="gear-reminders-container"></div>
                    </div>
                </div>
            </div>

            <!-- Quest Items Section (from DM) -->
            <div class="section collapsible" data-section-id="gear-quest-items">
                <h2 class="section-title">üóùÔ∏è Quest Items</h2>
                <div id="quest-items-container">
                    <p style="color: var(--text-muted); font-style: italic; text-align: center; padding: var(--space-4);">No quest items yet. Your DM can give you items during sessions.</p>
                </div>
            </div>

            <!-- Notes Section -->
            <div class="section collapsible" data-section-id="gear-notes">
                <h2 class="section-title">üìù Notes</h2>
                <div class="inventory-grid">
                    <div class="inventory-column">
                        <h3 style="color: var(--text-subdued); margin-bottom: 10px;">Additional Inventory</h3>
                        <textarea id="inventory_freetext" placeholder="Additional items, equipment, or gear..." rows="6"></textarea>
                    </div>
                    <div class="inventory-column">
                        <h3 style="color: var(--text-subdued); margin-bottom: 10px;">Quest Notes</h3>
                        <textarea id="notes_freetext" placeholder="Quest notes, NPC information, story details..." rows="6"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Tools (Combined Dice + Rules + Help) -->
        <div id="page-tools" class="tab-content">
            <!-- Sub-navigation for Tools -->
            <div class="tools-subnav">
                <button class="tools-tab active" onclick="switchToolsTab('tools-dice')">üé≤ Dice Roller</button>
                <button class="tools-tab" onclick="switchToolsTab('tools-rules')">üìñ Rules</button>
                <button class="tools-tab" onclick="switchToolsTab('tools-help')">‚ùì Help</button>
            </div>

            <!-- Dice Roller Sub-section -->
            <div id="tools-dice" class="tools-content active">
                <div class="section" style="padding: 15px;">
                    <h2 class="section-title" style="font-size: 1.2rem; margin-bottom: 10px;">üé≤ Dice Roller</h2>

                    <div style="margin-bottom: 12px; padding: 12px 15px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(59, 158, 255, 0.1) 100%); border: 1px solid rgba(168, 85, 247, 0.4); border-radius: 8px; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <label for="roll-mode" style="color: var(--accent-gold); font-size: 0.9rem; font-weight: 600;">Roll Mode:</label>
                        <select id="roll-mode" style="font-size: 0.9rem; padding: 8px 12px; flex: 1; min-width: 200px; border: 1px solid rgba(168, 85, 247, 0.4); background: rgba(10, 10, 15, 0.8);">
                            <option value="successes">Successes (Ability/Spell Checks)</option>
                            <option value="initiative">Initiative (Turn Order)</option>
                            <option value="food-water">Food & Water (Daily Survival)</option>
                            <option value="arrows">Arrows (Post-Battle)</option>
                        </select>
                        <p id="mode-description" style="color: var(--text-secondary); font-style: italic; font-size: 0.8rem; margin: 0; width: 100%;">
                            Roll D10 per ability point. 5-6 = barely, 7-9 = success, 10 = critical (reroll)
                        </p>
                    </div>

                    <!-- Successes mode: dice sliders -->
                    <div id="dice-sliders-successes" class="dice-stepper-container">
                        <div class="dice-stepper-item">
                            <span class="dice-stepper-label">D10</span>
                            <div class="dice-stepper-controls">
                                <button type="button" class="dice-stepper-btn" onclick="adjustDice('d10', -1)">‚àí</button>
                                <span id="d10-count" class="dice-stepper-value">0</span>
                                <button type="button" class="dice-stepper-btn" onclick="adjustDice('d10', 1)">+</button>
                            </div>
                            <input type="hidden" id="d10-slider" value="0">
                        </div>
                        <div class="dice-stepper-item">
                            <span class="dice-stepper-label">D12</span>
                            <div class="dice-stepper-controls">
                                <button type="button" class="dice-stepper-btn" onclick="adjustDice('d12', -1)">‚àí</button>
                                <span id="d12-count" class="dice-stepper-value">0</span>
                                <button type="button" class="dice-stepper-btn" onclick="adjustDice('d12', 1)">+</button>
                            </div>
                            <input type="hidden" id="d12-slider" value="0">
                        </div>
                        <div class="dice-stepper-item">
                            <span class="dice-stepper-label">D20</span>
                            <div class="dice-stepper-controls">
                                <button type="button" class="dice-stepper-btn" onclick="adjustDice('d20', -1)">‚àí</button>
                                <span id="d20-count" class="dice-stepper-value">0</span>
                                <button type="button" class="dice-stepper-btn" onclick="adjustDice('d20', 1)">+</button>
                            </div>
                            <input type="hidden" id="d20-slider" value="0">
                        </div>
                    </div>

                    <!-- Initiative/Arrows mode: single die selector -->
                    <div id="dice-selector-single" style="display: none; text-align: center; margin: 15px 0;">
                        <p style="color: var(--text-secondary); margin-bottom: 10px;">Select die type:</p>
                        <div style="display: flex; justify-content: center; gap: 15px;">
                            <button id="select-d6-single" class="dice-select-btn" onclick="selectSingleDie('d6')">D6</button>
                            <button id="select-d10-single" class="dice-select-btn" onclick="selectSingleDie('d10')">D10</button>
                        </div>
                        <p id="selected-die-display" style="color: var(--accent-gold); margin-top: 10px; font-size: 0.9rem;">Selected: None</p>
                    </div>

                    <!-- Food & Water mode: two die selectors -->
                    <div id="dice-selector-food-water" style="display: none; text-align: center; margin: 15px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <p style="color: var(--accent-gold); margin-bottom: 10px; font-weight: 600;">üçñ Food Die</p>
                                <div style="display: flex; justify-content: center; gap: 10px;">
                                    <button id="select-d6-food" class="dice-select-btn" onclick="selectFoodWaterDie('food', 'd6')">D6</button>
                                    <button id="select-d10-food" class="dice-select-btn" onclick="selectFoodWaterDie('food', 'd10')">D10</button>
                                </div>
                                <p id="food-die-display" style="color: var(--text-secondary); margin-top: 8px; font-size: 0.85rem;">Selected: None</p>
                            </div>
                            <div>
                                <p style="color: var(--accent-blue); margin-bottom: 10px; font-weight: 600;">üíß Water Die</p>
                                <div style="display: flex; justify-content: center; gap: 10px;">
                                    <button id="select-d6-water" class="dice-select-btn" onclick="selectFoodWaterDie('water', 'd6')">D6</button>
                                    <button id="select-d10-water" class="dice-select-btn" onclick="selectFoodWaterDie('water', 'd10')">D10</button>
                                </div>
                                <p id="water-die-display" style="color: var(--text-secondary); margin-top: 8px; font-size: 0.85rem;">Selected: None</p>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 15px 0;">
                        <button id="tools-roll-btn" onclick="rollAllDice()" style="font-size: 1.1rem; padding: 14px 40px; background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); border: none; box-shadow: 0 0 20px rgba(168, 85, 247, 0.3); color: white; border-radius: 8px; cursor: pointer;">
                            üé≤ Roll Dice
                        </button>
                    </div>

                    <!-- Results section -->
                    <div id="dice-results-section" style="display: none; padding: 15px; margin-top: 15px; background: var(--bg-surface); border-radius: 8px;">
                        <div id="success-summary" style="text-align: center; margin-bottom: 15px;">
                            <p style="font-size: 1.3rem; color: var(--accent-gold); margin: 0;">
                                <strong>Successes: <span id="total-successes">0</span></strong>
                            </p>
                            <p style="font-size: 1rem; color: var(--accent-blue); margin: 5px 0;">
                                Barely: <span id="total-barely">0</span>
                            </p>
                            <div id="success-breakdown" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 10px;"></div>
                        </div>
                        <div id="dice-results-container"></div>
                        <div id="reroll-buttons-container" style="display: none; text-align: center; margin-top: 15px;"></div>
                    </div>
                </div>
            </div>

            <!-- Rules Sub-section -->
            <div id="tools-rules" class="tools-content">
                <div class="section">
                    <h2 class="section-title">Aedelore Rules Reference</h2>
                    <div class="rules-accordion">

                        <!-- Core Dice System -->
                        <details class="rules-section" open>
                            <summary>Core Dice System (D10)</summary>
                            <div class="rules-content">
                                <p><strong>Dice Pool:</strong> Points in abilities convert to D10 dice:</p>
                                <ul>
                                    <li>1-2 points: 1D10</li>
                                    <li>3-4 points: 2D10</li>
                                    <li>5-6 points: 3D10</li>
                                    <li>7-8 points: 4D10</li>
                                    <li>9-10 points: 5D10</li>
                                    <li>11+ points: 6D10</li>
                                </ul>
                                <p><strong style="color: #ef4444;">Maximum 8 dice per action</strong> (unless class ability allows more)</p>
                                <p style="margin-top: 10px;"><strong>Combined Check:</strong> Core Ability + Skill (convert each to dice, max 8 total)</p>
                                <p><em>Example: Strength 4 (2D10) + Athletics 3 (2D10) = 4D10</em></p>
                            </div>
                        </details>

                        <!-- Success Levels -->
                        <details class="rules-section">
                            <summary>Success Levels</summary>
                            <div class="rules-content">
                                <p>Each die is evaluated individually:</p>
                                <ul>
                                    <li><strong>1-4:</strong> Failure</li>
                                    <li><strong>5-6:</strong> Barely a success (minimal effect, may have consequences)</li>
                                    <li><strong>7-9:</strong> Success (full effect)</li>
                                    <li><strong>10:</strong> Critical success (reroll and add result)</li>
                                </ul>
                                <p style="margin-top: 10px;"><strong>Critical (10):</strong> Count as success, reroll the die, add result. If reroll is also 10, chain continues!</p>
                                <p><em>Example: Roll 10 ‚Üí reroll 8 = 2 successes + possible critical effect (DM decides)</em></p>
                            </div>
                        </details>

                        <!-- Difficulty -->
                        <details class="rules-section">
                            <summary>Difficulty Levels</summary>
                            <div class="rules-content">
                                <p>DM sets the number of successes required:</p>
                                <ul>
                                    <li><strong>Trivial:</strong> 1 success</li>
                                    <li><strong>Easy:</strong> 2 successes</li>
                                    <li><strong>Normal:</strong> 3 successes</li>
                                    <li><strong>Hard:</strong> 4 successes</li>
                                    <li><strong>Very Hard:</strong> 5 successes</li>
                                    <li><strong>Nearly Impossible:</strong> 6+ successes</li>
                                </ul>
                                <p style="margin-top: 10px;"><strong>Contested Check:</strong> Both parties roll, most successes wins. Tie = DM decides (usually defender wins).</p>
                            </div>
                        </details>

                        <!-- Combat -->
                        <details class="rules-section">
                            <summary>Combat</summary>
                            <div class="rules-content">
                                <p><strong>Initiative:</strong> Roll D6 (D10 if 6+ participants). Highest goes first.</p>

                                <p style="margin-top: 12px;"><strong>Attack Pool:</strong></p>
                                <p style="margin-left: 10px;">Core Ability + Weapon Attack Bonus (max 8 dice)</p>
                                <ul style="margin-left: 10px; font-size: 0.9em;">
                                    <li><strong>Strength weapons:</strong> Longsword, axes, clubs, hammers, spears</li>
                                    <li><strong>Dexterity weapons:</strong> Dagger, rapier, bows, light crossbow</li>
                                    <li><strong>Str/Dex choice:</strong> Katana</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Attack Results:</strong></p>
                                <ul>
                                    <li><strong>0 successes:</strong> Miss - no damage</li>
                                    <li><strong>1 success:</strong> Glancing blow - 50% damage</li>
                                    <li><strong>2+ successes:</strong> Full hit - full damage</li>
                                    <li><strong>Critical (10):</strong> Extra effect (DM decides)</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Damage:</strong> Roll weapon's damage dice (e.g., Longsword = 1D10)</p>

                                <p style="margin-top: 12px;"><strong>Assistance:</strong> Give up your action to grant ally +1D10 on their next roll. Max 1 assist per round.</p>
                            </div>
                        </details>

                        <!-- Defense -->
                        <details class="rules-section">
                            <summary>Defense Options</summary>
                            <div class="rules-content">
                                <p>When attacked, choose <strong>one</strong> reaction:</p>

                                <p style="margin-top: 12px;"><strong>Block</strong> (Pool: Strength + Shield Block) - Requires shield</p>
                                <ul>
                                    <li><strong>2+ successes:</strong> Full block - Shield HP takes damage (DM rec: 50%)</li>
                                    <li><strong>1 success:</strong> Partial block - Shield absorbs (Block value), rest goes to Shield HP</li>
                                    <li><strong>0 successes:</strong> Fail - Armor HP takes damage (DM chooses body part)</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Dodge</strong> (Pool: Agility OR Acrobatics, whichever is higher)</p>
                                <ul>
                                    <li><strong>2+ successes:</strong> Full dodge - no damage</li>
                                    <li><strong>1 success:</strong> Partial dodge - half damage to Armor HP</li>
                                    <li><strong>0 successes:</strong> Fail - full damage to Armor HP (DM chooses body part)</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Parry</strong> (Pool: Weapon Skill + Strength) - Requires weapon</p>
                                <ul>
                                    <li><strong>2+ successes:</strong> Full parry - no damage</li>
                                    <li><strong>1 success:</strong> Partial parry - half damage to Armor HP</li>
                                    <li><strong>0 successes:</strong> Fail - full damage to Armor HP (DM chooses body part)</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Take Hit</strong> (Pool: Toughness + Armor Block)</p>
                                <ul>
                                    <li><strong>2+ successes:</strong> Full control - Armor Block absorbs, minimal damage</li>
                                    <li><strong>1 success:</strong> Partial control - Armor Block absorbs, rest goes to Armor HP</li>
                                    <li><strong>0 successes:</strong> Fail - full damage to Armor HP (no absorption) + Stun/Knockback</li>
                                </ul>

                                <p style="margin-top: 16px; padding: 10px; background: rgba(168, 85, 247, 0.15); border-radius: 6px;">
                                    <strong style="color: #a855f7;">Special Maneuver:</strong><br>
                                    Want to do something beyond the four options? Tell your DM what you want to do.<br>
                                    DM decides: which pool to roll, difficulty, and consequences.<br>
                                    <span style="font-size: 0.9em;"><em>Example: "I want to duck under the sword and roll behind the enemy" ‚Üí DM may say "Roll Agility + Acrobatics, need 3 successes"</em></span>
                                </p>

                                <p style="margin-top: 16px; padding: 10px; background: rgba(239, 68, 68, 0.15); border-radius: 6px;">
                                    <strong style="color: #ef4444;">When Equipment HP = 0:</strong><br>
                                    Equipment is destroyed. All remaining damage goes directly to <strong>Character HP</strong>.<br>
                                    <span style="font-size: 0.9em;"><em>Example: Armor HP 5, incoming 12 dmg ‚Üí Armor destroyed, Character takes 7 HP damage</em></span>
                                </p>

                                <p style="margin-top: 16px; padding: 10px; background: rgba(240, 192, 64, 0.15); border-radius: 6px;">
                                    <strong style="color: #f0c040;">Equipment Damage:</strong><br>
                                    DM decides how much damage equipment takes. <strong>Recommendation: 50%</strong> of attack's intended damage.<br>
                                    <span style="font-size: 0.9em;"><em>Example: Enemy deals 12 dmg ‚Üí Shield/Armor takes 6 HP damage</em></span>
                                </p>

                                <p style="margin-top: 12px;"><strong>Stun/Knockback Effects</strong> (on Take Hit fail, DM chooses):</p>
                                <ul style="font-size: 0.9em;">
                                    <li><strong>Stun:</strong> Lose next action</li>
                                    <li><strong>Knockback:</strong> Pushed back 1-2 meters, may lose balance</li>
                                    <li><strong>Disarm:</strong> Drop weapon (if hit on hand)</li>
                                    <li><strong>Prone:</strong> Fall to ground (if hit on leg)</li>
                                    <li><strong>Dazed:</strong> -1D10 on next roll</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Body Parts</strong> (DM chooses for narrative):</p>
                                <p style="font-size: 0.9em; margin-left: 10px;">Hand, Leg, Chest, Shoulders, Head</p>
                            </div>
                        </details>

                        <!-- Magic -->
                        <details class="rules-section">
                            <summary>Magic & Spellcasting</summary>
                            <div class="rules-content">
                                <p><strong>Arcana Points:</strong></p>
                                <ul>
                                    <li><strong>Mage:</strong> Max 20, starts 10</li>
                                    <li><strong>Druid:</strong> Max 16, starts 8</li>
                                    <li><strong>Others:</strong> Cannot use arcana</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Regeneration:</strong> +1 Arcana/round in combat, +2 on rest</p>

                                <p style="margin-top: 12px;"><strong>Casting a Spell:</strong></p>
                                <ul>
                                    <li>Roll 1D10 per point in Arcana (Mage) or Nature (Druid)</li>
                                    <li>Need at least 1 success</li>
                                    <li>Pay Arcana cost (see spell description)</li>
                                    <li>Critical success amplifies effect (DM decides)</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Failed Cast (0 successes):</strong> Spell fizzles, Arcana consumed. DM may add backlash.</p>

                                <p style="margin-top: 12px;"><strong>Changing Spells:</strong> Only in safe areas (town/village). Old spells become inactive, not forgotten.</p>

                                <p style="margin-top: 12px;"><strong>Arcane Elixir:</strong> Restores 10 Arcana. Mage starts with 2, Druid with 1. Max 4.</p>
                            </div>
                        </details>

                        <!-- Weakened -->
                        <details class="rules-section">
                            <summary>Weakened (Exhaustion)</summary>
                            <div class="rules-content">
                                <p>Each character has <strong>6 Weakened Points</strong>.</p>
                                <p>Using melee class abilities costs Weakened.</p>

                                <p style="margin-top: 12px;"><strong>When Weakened = 0:</strong></p>
                                <p>Roll <strong>1D10 + Toughness</strong>:</p>
                                <ul>
                                    <li><strong>1-2:</strong> Death (total collapse)</li>
                                    <li><strong>3-5:</strong> Faint (unconscious)</li>
                                    <li><strong>6-10:</strong> Exhausted (can move but not fight)</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Recovery:</strong></p>
                                <ul>
                                    <li>Short rest (1 hour): +1 Weakened</li>
                                    <li>Long rest (8 hours): All Weakened restored</li>
                                </ul>
                            </div>
                        </details>

                        <!-- Bleeding -->
                        <details class="rules-section">
                            <summary>Bleeding</summary>
                            <div class="rules-content">
                                <p>Critical wounds cause bleeding (DM decides when).</p>

                                <p style="margin-top: 12px;"><strong>Each Round:</strong> Roll 1D6</p>
                                <ul>
                                    <li><strong>1-2:</strong> Lose 3 HP</li>
                                    <li><strong>3-4:</strong> Lose 2 HP</li>
                                    <li><strong>5-6:</strong> Lose 1 HP</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Bleed Severity:</strong></p>
                                <ul>
                                    <li><strong>Bleed 1:</strong> Roll 1D6</li>
                                    <li><strong>Bleed 2:</strong> Roll 2D6, take highest</li>
                                    <li><strong>Bleed 3+:</strong> Roll 3D6, take highest</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Stopping Bleeding:</strong></p>
                                <ul>
                                    <li>Medicine check (1 success per Bleed level)</li>
                                    <li>Bandage: Stops Bleed 1 automatically</li>
                                    <li>Healing magic: Stops all bleeding</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>HP = 0 from Bleeding:</strong></p>
                                <p>Roll <strong>1D10 + Toughness</strong>:</p>
                                <ul>
                                    <li><strong>1-2:</strong> Death</li>
                                    <li><strong>3-4:</strong> Barely alive (needs immediate care)</li>
                                    <li><strong>5-6:</strong> Fainted but stable</li>
                                    <li><strong>7+:</strong> Conscious but weakened</li>
                                </ul>
                            </div>
                        </details>

                        <!-- Status Effects -->
                        <details class="rules-section">
                            <summary>Status Effects</summary>
                            <div class="rules-content">
                                <ul>
                                    <li><strong>Poisoned:</strong> -1D10 on all rolls, 1 damage/round</li>
                                    <li><strong>Stunned:</strong> Cannot act this round</li>
                                    <li><strong>Blinded:</strong> -2D10 on attacks and perception</li>
                                    <li><strong>Deafened:</strong> Cannot hear, -1D10 perception</li>
                                    <li><strong>Frightened:</strong> Cannot approach fear source, -1D10 attacks</li>
                                    <li><strong>Prone:</strong> -1D10 attacks, enemies get +1D10 in melee</li>
                                </ul>
                            </div>
                        </details>

                        <!-- Healing & Rest -->
                        <details class="rules-section">
                            <summary>Healing & Rest</summary>
                            <div class="rules-content">
                                <p><strong>Natural Healing:</strong></p>
                                <ul>
                                    <li><strong>Short rest (1 hour):</strong> +1D6 HP, +1 Weakened</li>
                                    <li><strong>Long rest (8 hours):</strong> All HP restored, all Weakened restored</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Medicine Check:</strong></p>
                                <ul>
                                    <li>1 success: +1D6 HP to patient</li>
                                    <li>2+ successes: +2D6 HP</li>
                                    <li>Critical: +3D6 HP</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Potions:</strong></p>
                                <ul>
                                    <li><strong>Healing Potion:</strong> +1D10 HP</li>
                                    <li><strong>Adrenaline:</strong> +2D10 on next action</li>
                                    <li><strong>Antidote:</strong> Cures Poisoned</li>
                                </ul>
                            </div>
                        </details>

                        <!-- Resources -->
                        <details class="rules-section">
                            <summary>Resources</summary>
                            <div class="rules-content">
                                <p><strong>Food & Water (tracked with dice):</strong></p>
                                <p>Roll your supply die daily:</p>
                                <ul>
                                    <li><strong>D10: 6-10:</strong> Keep D10 | <strong>1-5:</strong> Reduce to D6</li>
                                    <li><strong>D6: 4-6:</strong> Keep D6 | <strong>1-3:</strong> Out of supplies</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Without Food/Water:</strong></p>
                                <ul>
                                    <li>Day 1: No effect</li>
                                    <li>Day 2: -1D10 on all rolls</li>
                                    <li>Day 3+: 1 damage/day, -2D10 on all rolls</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Arrows (after combat):</strong> Roll 1D6</p>
                                <ul>
                                    <li><strong>1-2:</strong> Keep 25%</li>
                                    <li><strong>3-4:</strong> Keep 50%</li>
                                    <li><strong>5-6:</strong> Keep 75%</li>
                                </ul>
                            </div>
                        </details>

                        <!-- Worthiness -->
                        <details class="rules-section">
                            <summary>Worthiness & Reputation</summary>
                            <div class="rules-content">
                                <p>Worthiness = your reputation in society.</p>
                                <ul>
                                    <li><strong>High:</strong> Respected, welcomed, better prices</li>
                                    <li><strong>Low:</strong> Suspicious, may be denied service</li>
                                    <li><strong>Negative:</strong> Wanted, may be attacked on sight</li>
                                </ul>

                                <p style="margin-top: 12px;"><strong>Changes:</strong></p>
                                <ul>
                                    <li>Heroic deed: +1 to +3</li>
                                    <li>Help those in need: +1</li>
                                    <li>Kill innocents: -2 to -5</li>
                                    <li>Theft (discovered): -1 to -2</li>
                                    <li>Murder (witnessed): -3 to -5</li>
                                </ul>
                            </div>
                        </details>

                    </div>
                    <div class="rules-links" style="margin-top: 20px;">
                        <a href="https://wiki.aedelore.nu/books/miscs-of-aedelore/chapter/rules" target="_blank" class="rules-link">Aedelore Wiki - Full Rules</a>
                    </div>
                </div>
            </div>

            <!-- Help Sub-section -->
            <div id="tools-help" class="tools-content">
                <div class="section">
                    <h2 class="section-title">‚ùì Character Sheet Guide</h2>

                    <!-- Quick Overview -->
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 8px;">
                        <h3 style="color: var(--accent-cyan); margin: 0 0 10px 0; font-size: 1rem;">Quick Overview</h3>
                        <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem; line-height: 1.6;">
                            This character sheet is a Progressive Web App (PWA) that works offline and syncs to the cloud.
                            It uses a <strong>lock system</strong> to ensure characters are created step-by-step.
                        </p>
                    </div>

                    <!-- Getting Started -->
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, rgba(59, 158, 255, 0.15) 0%, rgba(99, 102, 241, 0.1) 100%); border: 1px solid var(--border-default); border-radius: 8px;">
                        <h3 style="color: var(--primary-blue); margin: 0 0 15px 0; font-size: 1.1rem;">üöÄ Getting Started</h3>

                        <div style="margin-bottom: 12px;">
                            <h4 style="color: var(--text-base); margin: 0 0 5px 0; font-size: 0.95rem;">1. Create an Account</h4>
                            <p style="color: var(--text-secondary); margin: 0; font-size: 0.85rem; line-height: 1.5;">
                                Click <strong>"Login"</strong> in the top menu ‚Üí <strong>"Register"</strong>.
                                An account enables cloud saving, the lock system, and campaign features.
                            </p>
                        </div>

                        <div style="margin-bottom: 12px;">
                            <h4 style="color: var(--text-base); margin: 0 0 5px 0; font-size: 0.95rem;">2. Create a Character</h4>
                            <p style="color: var(--text-secondary); margin: 0; font-size: 0.85rem; line-height: 1.5;">
                                Click <strong>"New Character"</strong>. Your character auto-saves to the cloud every 5 seconds.
                            </p>
                        </div>

                        <div>
                            <h4 style="color: var(--text-base); margin: 0 0 5px 0; font-size: 0.95rem;">3. Follow the Lock Flow</h4>
                            <p style="color: var(--text-secondary); margin: 0; font-size: 0.85rem; line-height: 1.5;">
                                The character sheet guides you through creation with locks: Race/Class ‚Üí Attributes ‚Üí Abilities.
                            </p>
                        </div>
                    </div>

                    <!-- The Lock System -->
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, rgba(240, 192, 64, 0.15) 0%, rgba(240, 192, 64, 0.05) 100%); border: 1px solid rgba(240, 192, 64, 0.4); border-radius: 8px;">
                        <h3 style="color: var(--accent-gold); margin: 0 0 15px 0; font-size: 1.1rem;">üîí The Lock System</h3>
                        <p style="color: var(--text-secondary); margin: 0 0 10px 0; font-size: 0.85rem;">
                            The lock system is a <strong>campaign tool</strong> designed to prevent cheating. Once locked, choices are permanent and only your DM can unlock them.
                        </p>
                        <p style="color: var(--accent-red); margin: 0 0 15px 0; font-size: 0.8rem;">
                            <strong>‚ö†Ô∏è Requires cloud save</strong> - Lock functions only work when saved to cloud. You must click "‚òÅÔ∏è Save to Cloud" the first time to enable locks.
                        </p>

                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; align-items: flex-start; gap: 10px;">
                                <span style="background: var(--accent-gold); color: #000; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; flex-shrink: 0;">1</span>
                                <div>
                                    <strong style="color: var(--text-base); font-size: 0.9rem;">Lock Race & Class</strong>
                                    <p style="color: var(--text-secondary); margin: 2px 0 0 0; font-size: 0.8rem;">Choose race, class, and religion. Lock to apply bonuses and starting equipment.</p>
                                </div>
                            </div>
                            <div style="display: flex; align-items: flex-start; gap: 10px;">
                                <span style="background: var(--accent-gold); color: #000; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; flex-shrink: 0;">2</span>
                                <div>
                                    <strong style="color: var(--text-base); font-size: 0.9rem;">Lock Attributes</strong>
                                    <p style="color: var(--text-secondary); margin: 2px 0 0 0; font-size: 0.8rem;">Distribute 10 points across attributes (max 5 each). Lock to enable Abilities tab.</p>
                                </div>
                            </div>
                            <div style="display: flex; align-items: flex-start; gap: 10px;">
                                <span style="background: var(--accent-gold); color: #000; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; flex-shrink: 0;">3</span>
                                <div>
                                    <strong style="color: var(--text-base); font-size: 0.9rem;">Lock Abilities</strong>
                                    <p style="color: var(--text-secondary); margin: 2px 0 0 0; font-size: 0.8rem;">Select your class abilities or spells. Lock to finalize your character.</p>
                                </div>
                            </div>
                        </div>

                        <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; margin-top: 15px;">
                            <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">
                                <strong style="color: var(--accent-cyan);">üí° Tip:</strong> If you made a mistake, ask your DM to unlock via the DM Session tool.
                            </p>
                        </div>
                    </div>

                    <!-- Tabs Overview -->
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 8px;">
                        <h3 style="color: var(--accent-purple); margin: 0 0 15px 0; font-size: 1.1rem;">üìë Tabs Overview</h3>

                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div>
                                <h4 style="color: var(--primary-blue); margin: 0 0 3px 0; font-size: 0.9rem;">Character</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Name, race, class, religion, backstory, portrait. Shows party members if linked to campaign.</p>
                            </div>
                            <div>
                                <h4 style="color: var(--accent-cyan); margin: 0 0 3px 0; font-size: 0.9rem;">Stats (Attributes)</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Core attributes and skills. Use +/- buttons to distribute points. Shows bonuses from race/class.</p>
                            </div>
                            <div>
                                <h4 style="color: var(--accent-red); margin: 0 0 3px 0; font-size: 0.9rem;">Combat</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">HP, armor, weapons. Select weapons from dropdowns - stats auto-fill. Track current HP during play.</p>
                            </div>
                            <div>
                                <h4 style="color: var(--accent-purple); margin: 0 0 3px 0; font-size: 0.9rem;">Abilities</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Class abilities and spells. Arcana pool for mages. Click spell names to see full descriptions.</p>
                            </div>
                            <div>
                                <h4 style="color: var(--accent-gold); margin: 0 0 3px 0; font-size: 0.9rem;">Gear</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Inventory (10 slots), item reminders, notes, quest notes, and Quest Items (from DM).</p>
                            </div>
                            <div>
                                <h4 style="color: var(--primary-green); margin: 0 0 3px 0; font-size: 0.9rem;">Tools</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Dice roller, rules reference, and this help guide.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Saving & Cloud -->
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 8px;">
                        <h3 style="color: var(--primary-green); margin: 0 0 15px 0; font-size: 1.1rem;">‚òÅÔ∏è Saving & Cloud Sync</h3>

                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div>
                                <h4 style="color: var(--text-base); margin: 0 0 3px 0; font-size: 0.9rem;">Auto-Save (Cloud)</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">When logged in, changes save to cloud every 5 seconds. Look for the cloud icon in the corner.</p>
                            </div>
                            <div>
                                <h4 style="color: var(--text-base); margin: 0 0 3px 0; font-size: 0.9rem;">Local Auto-Save</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Also saves to browser storage as backup. Works offline too.</p>
                            </div>
                            <div>
                                <h4 style="color: var(--text-base); margin: 0 0 3px 0; font-size: 0.9rem;">Export/Import</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Download character as JSON file for backup. Import from file to restore.</p>
                            </div>
                            <div>
                                <h4 style="color: var(--text-base); margin: 0 0 3px 0; font-size: 0.9rem;">Multiple Characters</h4>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem;">Create multiple characters. Switch between them from the "My Characters" dropdown.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 8px;">
                        <h3 style="color: var(--accent-red); margin: 0 0 15px 0; font-size: 1.1rem;">‚ö° Quick Actions</h3>
                        <p style="color: var(--text-secondary); margin: 0 0 10px 0; font-size: 0.85rem;">
                            Use the action buttons on the dashboard or sidebar for common tasks:
                        </p>
                        <ul style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 0.85rem; line-height: 1.8;">
                            <li><strong>Attack</strong> - Quick roll for weapon attacks</li>
                            <li><strong>Defend</strong> - Roll defense check</li>
                            <li><strong>Potion</strong> - Use a healing potion (if you have any)</li>
                            <li><strong>Dice</strong> - Open the dice roller</li>
                        </ul>
                    </div>

                    <!-- DM Sessions & Campaigns -->
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 100%); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 8px;">
                        <h3 style="color: #10b981; margin: 0 0 15px 0; font-size: 1.1rem;">üéÆ DM Sessions & Campaigns</h3>

                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--text-base); margin: 0 0 5px 0; font-size: 0.95rem;">Joining a Campaign</h4>
                            <ol style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 0.85rem; line-height: 1.7;">
                                <li>Get the <strong>share code</strong> from your DM (looks like: <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px;">A1B2C3D4</code>)</li>
                                <li>Go to <strong>aedelore.nu/dm-session</strong></li>
                                <li>Login and click <strong>"Join Campaign"</strong></li>
                                <li>Enter the code and join</li>
                            </ol>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--text-base); margin: 0 0 5px 0; font-size: 0.95rem;">Linking Your Character</h4>
                            <ol style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 0.85rem; line-height: 1.7;">
                                <li>Save your character to cloud first</li>
                                <li>Go to <strong>Character tab</strong> ‚Üí <strong>"Link to Campaign"</strong></li>
                                <li>Enter the same share code</li>
                                <li>Your character now shows in the party!</li>
                            </ol>
                        </div>

                        <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px;">
                            <h4 style="color: var(--accent-gold); margin: 0 0 8px 0; font-size: 0.9rem;">What You Can See in Player View</h4>
                            <ul style="color: var(--text-secondary); margin: 0; padding-left: 15px; font-size: 0.8rem; line-height: 1.6;">
                                <li>Session prologue (read-aloud intro)</li>
                                <li>NPCs you've met (marked as "used")</li>
                                <li>Places you've visited</li>
                                <li>Encounters you've completed</li>
                                <li>Items you've found</li>
                                <li>Turning points and event log</li>
                                <li>Other party members (if linked)</li>
                            </ul>
                            <p style="color: var(--text-subdued); margin: 8px 0 0 0; font-size: 0.75rem; font-style: italic;">
                                You cannot see: DM's secret notes, upcoming encounters, or hidden content.
                            </p>
                        </div>
                    </div>

                    <!-- Quest Items -->
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 8px;">
                        <h3 style="color: var(--accent-gold); margin: 0 0 10px 0; font-size: 1.1rem;">üóùÔ∏è Quest Items</h3>
                        <p style="color: var(--text-secondary); margin: 0; font-size: 0.85rem; line-height: 1.6;">
                            When your DM gives you an item during a session (via "Given to" in the DM tool),
                            it appears in your <strong>Gear tab ‚Üí Quest Items</strong> section.
                            Click an item to see its full description.
                        </p>
                    </div>

                    <!-- XP & Leveling -->
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 8px;">
                        <h3 style="color: var(--accent-purple); margin: 0 0 10px 0; font-size: 1.1rem;">‚ú® XP & Leveling</h3>
                        <ul style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 0.85rem; line-height: 1.8;">
                            <li>Your DM awards XP during sessions (via DM Session tool)</li>
                            <li>Every <strong>10 XP</strong> = <strong>1 attribute point</strong></li>
                            <li>Attribute points still have max 5 per attribute</li>
                            <li>XP shows on your dashboard next to your character name</li>
                        </ul>
                    </div>

                    <!-- Dice Roller -->
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 8px;">
                        <h3 style="color: var(--primary-blue); margin: 0 0 10px 0; font-size: 1.1rem;">üé≤ Dice Roller</h3>
                        <p style="color: var(--text-secondary); margin: 0 0 10px 0; font-size: 0.85rem;">
                            The dice roller (Tools tab) has 4 modes:
                        </p>
                        <ul style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 0.85rem; line-height: 1.8;">
                            <li><strong>Successes</strong> - Roll D10s for ability/spell checks (5-6 barely, 7-9 success, 10 critical)</li>
                            <li><strong>Initiative</strong> - Roll single die for turn order</li>
                            <li><strong>Food & Water</strong> - Daily survival rolls</li>
                            <li><strong>Arrows</strong> - Post-battle arrow recovery</li>
                        </ul>
                    </div>

                    <!-- Tips -->
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(59, 158, 255, 0.1) 100%); border: 1px solid var(--border-purple); border-radius: 8px;">
                        <h3 style="color: var(--accent-gold); margin: 0 0 10px 0; font-size: 1.1rem;">üí° Tips</h3>
                        <ul style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 0.85rem; line-height: 1.8;">
                            <li><strong>Install as app</strong> - Add to home screen for offline access</li>
                            <li><strong>Double-check before locking</strong> - Locks are permanent!</li>
                            <li><strong>Link your character</strong> - See party members and get quest items</li>
                            <li><strong>Use notes</strong> - Gear tab has Notes and Quest Notes sections</li>
                            <li><strong>Check rules</strong> - Rules tab has complete Aedelore rules reference</li>
                            <li><strong>Portrait</strong> - Upload an image or paste a URL in Character tab</li>
                        </ul>
                    </div>

                    <!-- Wiki Link -->
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border: 1px solid var(--primary-purple); border-radius: 8px;">
                        <p style="color: var(--text-secondary); margin: 0 0 10px 0; font-size: 0.85rem;">
                            For complete rules, lore, and guides:
                        </p>
                        <a href="https://wiki.aedelore.nu" target="_blank" style="display: inline-block; padding: 10px 25px; background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-purple) 100%); color: white; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">
                            üåê wiki.aedelore.nu
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </div>
        </div><!-- /.app-main -->
    </div><!-- /.app-wrapper -->

    <!-- Load Data Files -->
    <script src="data/races.js"></script>
    <script src="data/classes.js"></script>
    <script src="data/religions.js"></script>
    <script src="data/weapons.js"></script>
    <script src="data/armor.js"></script>
    <script src="data/spells.js"></script>

    <!-- Load JS Modules -->
    <script src="js/tabs.js"></script>
    <script src="js/sliders.js"></script>
    <script src="js/spells.js"></script>
    <script src="js/weapons.js"></script>
    <script src="js/armor.js"></script>
    <script src="js/diceroller.js"></script>
    <script src="js/focus-fix.js"></script>
    <script src="js/init.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/main.js"></script>

    <!-- Multi-System Support -->
    <script src="js/systems/system-config.js"></script>
    <script src="js/systems/dnd5e.js"></script>
    <script src="js/systems/pathfinder2e.js"></script>
    <script src="js/systems/storyteller.js"></script>
    <script src="js/systems/cod.js"></script>
    <script src="js/system-selector.js"></script>

    <script>
        // Initialize inventory fields (10 items)
        const inventoryContainer = document.getElementById('gear-inventory-container');
        if (inventoryContainer) {
            for (let i = 1; i <= 10; i++) {
                const fieldGroup = document.createElement('div');
                fieldGroup.className = 'field-group';
                fieldGroup.innerHTML = `
                    <label>Item ${i}</label>
                    <input type="text" id="inventory_${i}" placeholder="Item description">
                `;
                inventoryContainer.appendChild(fieldGroup);
            }
        }

        // Initialize reminders fields (10 items)
        const remindersContainer = document.getElementById('gear-reminders-container');
        if (remindersContainer) {
            for (let i = 1; i <= 10; i++) {
                const fieldGroup = document.createElement('div');
                fieldGroup.className = 'field-group';
                fieldGroup.innerHTML = `
                    <label>Reminder ${i}</label>
                    <input type="text" id="reminder_${i}" placeholder="Important reminder">
                `;
                remindersContainer.appendChild(fieldGroup);
            }
        }

        // Function to build spells table with dynamic number of rows
        function buildSpellsTable(numSpells) {
            const spellsTable = document.getElementById('spells-table');

            // Clear existing table
            spellsTable.innerHTML = '';

            for (let i = 1; i <= numSpells; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><select id="spell_${i}_type"><option value="">Spell/Ability ${i}</option></select></td>
                    <td><input type="text" id="spell_${i}_arcana" placeholder="Cost"></td>
                    <td id="spell_${i}_gain_cell" style="display: none;"><input type="text" id="spell_${i}_gain" placeholder="Gain"></td>
                    <td><input type="text" id="spell_${i}_weakened" placeholder="Damage"></td>
                `;
                spellsTable.appendChild(row);

                // Create info box row for this spell
                const infoRow = document.createElement('tr');
                infoRow.id = `spell_${i}_info_row`;
                infoRow.style.display = 'none';
                infoRow.innerHTML = `
                    <td colspan="4" style="padding: 0;">
                        <div id="spell_${i}_info_box" style="padding: 15px; background: rgba(15, 23, 42, 0.6); border-radius: 8px; margin: 5px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <h4 id="spell_${i}_info_name" style="color: var(--primary-blue); margin: 0 0 10px 0; font-size: 1.1rem;"></h4>
                                    <p id="spell_${i}_info_desc" style="color: var(--text-secondary); margin: 0 0 10px 0; line-height: 1.5;"></p>
                                    <div id="spell_${i}_info_check" style="color: var(--accent-gold); font-style: italic; font-size: 0.9rem; margin-top: 10px; padding: 8px; background: rgba(251, 191, 36, 0.1); border-radius: 4px;"></div>
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                spellsTable.appendChild(infoRow);
            }

            console.log(`Spells table built with ${numSpells} rows`);

            // Setup event listeners for all spell selects
            if (typeof setupSpellListeners === 'function') {
                setupSpellListeners(numSpells);
            }

            // Update spell dropdowns to populate with class spells
            if (typeof updateSpellsList === 'function') {
                updateSpellsList();
            }
        }

        // Initialize spells table with 5 rows by default
        buildSpellsTable(5);

        // Function to show spell info box for a specific index
        function showSpellInfo(spell, spellIndex) {
            const infoRow = document.getElementById(`spell_${spellIndex}_info_row`);
            const nameEl = document.getElementById(`spell_${spellIndex}_info_name`);
            const descEl = document.getElementById(`spell_${spellIndex}_info_desc`);
            const checkEl = document.getElementById(`spell_${spellIndex}_info_check`);

            if (!infoRow) return;

            const selectedClass = document.getElementById('class').value;
            const isConjurer = selectedClass && CLASSES && CLASSES[selectedClass] && CLASSES[selectedClass].abilityType === "arcana";

            nameEl.textContent = spell.name;
            descEl.textContent = spell.desc || '';

            // Add check information
            if (checkEl) {
                if (isConjurer) {
                    // For spells: Show arcane check
                    checkEl.textContent = 'Check: Arkana + 1D10 minimum 1 success';
                } else {
                    // For melee abilities: Use check field which contains the check info
                    if (spell.check) {
                        checkEl.textContent = spell.check;
                    } else {
                        checkEl.textContent = '';
                    }
                }
            }

            infoRow.style.display = 'table-row';
        }

        // Mapping of attribute/skill names to field IDs
        const attributeMapping = {
            'Strength': 'strength_value',
            'Dexterity': 'dexterity_value',
            'Agility': 'dexterity_value', // Alias for Dexterity
            'Toughness': 'toughness_value',
            'Intelligence': 'intelligence_value',
            'Wisdom': 'wisdom_value',
            'Force of Will': 'force_of_will_value',
            'Athletics': 'strength_athletics',
            'Raw Power': 'strength_raw_power',
            'Unarmed': 'strength_unarmed',
            'Endurance': 'dexterity_endurance',
            'Acrobatics': 'dexterity_acrobatics',
            'Sleight of Hand': 'dexterity_sleight_of_hand',
            'Stealth': 'dexterity_stealth',
            'Bonus While Injured': 'toughness_bonus_while_injured',
            'Resistance': 'toughness_resistance',
            'Arcana': 'intelligence_arcana',
            'History': 'intelligence_history',
            'Investigation': 'intelligence_investigation',
            'Nature': 'intelligence_nature',
            'Religion': 'intelligence_religion',
            'Luck': 'wisdom_luck',
            'Animal Handling': 'wisdom_animal_handling',
            'Insight': 'wisdom_insight',
            'Medicine': 'wisdom_medicine',
            'Perception': 'wisdom_perception',
            'Survival': 'wisdom_survival',
            'Deception': 'force_of_will_deception',
            'Intimidation': 'force_of_will_intimidation',
            'Performance': 'force_of_will_performance',
            'Persuasion': 'force_of_will_persuasion'
        };

        // Function to adjust attribute/skill values with +/- buttons
        function adjustValue(fieldId, delta) {
            const field = document.getElementById(fieldId);
            if (field) {
                // Check if this change is allowed (point limits)
                if (typeof canAddAttributePoint === 'function' && !canAddAttributePoint(fieldId, delta)) {
                    // Show feedback based on situation
                    if (delta > 0) {
                        const pointsUsed = typeof getFreePointsUsed === 'function' ? getFreePointsUsed() : 0;
                        if (typeof xpSpendingMode !== 'undefined' && xpSpendingMode) {
                            alert('All available XP points have been distributed.');
                        } else if (pointsUsed >= 10) {
                            alert('All 10 free points have been distributed.');
                        } else {
                            alert('Maximum 5 total per attribute at character creation.');
                        }
                    }
                    return;
                }

                const currentValue = parseInt(field.value) || 0;
                const baseValue = (typeof baseAttributeValues !== 'undefined' && baseAttributeValues[fieldId]) || 0;
                const newValue = Math.max(baseValue, currentValue + delta); // Don't go below base value
                field.value = newValue;
                // Trigger change event for any listeners
                field.dispatchEvent(new Event('change'));
                field.dispatchEvent(new Event('input'));

                // Update points display
                if (typeof updatePointsDisplay === 'function') {
                    updatePointsDisplay();
                }

                // Check if this is armor or shield damage - auto-break if damage >= HP
                checkEquipmentBroken(fieldId);
            }
        }

        // Check if armor/shield should be marked as broken based on damage vs HP
        function checkEquipmentBroken(fieldId) {
            // Shield damage check
            if (fieldId === 'shield_dmg_taken') {
                const dmg = parseInt(document.getElementById('shield_dmg_taken').value) || 0;
                const hp = parseInt(document.getElementById('shield_hp').value) || 0;
                const checkbox = document.getElementById('shield_broken');
                if (checkbox && hp > 0) {
                    const shouldBeBroken = dmg >= hp;
                    if (checkbox.checked !== shouldBeBroken) {
                        checkbox.checked = shouldBeBroken;
                        toggleShieldBroken();
                    }
                }
                return;
            }

            // Armor damage check (armor_1_dmg through armor_5_dmg)
            const armorMatch = fieldId.match(/^armor_(\d)_dmg$/);
            if (armorMatch) {
                const index = armorMatch[1];
                const dmg = parseInt(document.getElementById(`armor_${index}_dmg`).value) || 0;
                const hp = parseInt(document.getElementById(`armor_${index}_hp`).value) || 0;
                const checkbox = document.getElementById(`armor_${index}_broken`);
                if (checkbox && hp > 0) {
                    const shouldBeBroken = dmg >= hp;
                    if (checkbox.checked !== shouldBeBroken) {
                        checkbox.checked = shouldBeBroken;
                        toggleArmorBroken(index);
                    }
                }
            }
        }

        // Function to auto-fill attributes based on race, class, and religion
        function autoFillAttributes() {
            // Reset all attribute fields to 0
            Object.values(attributeMapping).forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.value = 0;
            });

            const raceValue = document.getElementById('race').value;
            const classValue = document.getElementById('class').value;
            const religionValue = document.getElementById('religion').value;

            // Apply race bonuses
            if (raceValue && RACES[raceValue]) {
                RACES[raceValue].bonuses.forEach(bonus => {
                    applyBonus(bonus);
                });
            }

            // Apply class bonuses
            if (classValue && CLASSES[classValue]) {
                CLASSES[classValue].bonuses.forEach(bonus => {
                    applyBonus(bonus);
                });
            }

            // Apply religion bonuses
            if (religionValue && RELIGIONS[religionValue]) {
                RELIGIONS[religionValue].bonuses.forEach(bonus => {
                    applyBonus(bonus);
                });
            }
        }

        // Function to auto-fill gold based on race and class
        function autoFillGold() {
            const classValue = document.getElementById('class').value;
            const goldField = document.getElementById('gold');

            if (!goldField) return;

            // Only classes have starting gold
            let totalGold = 0;
            if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment) {
                totalGold = CLASSES[classValue].startingEquipment.gold || 0;
            }

            goldField.value = totalGold;
        }

        // Function to auto-fill worthiness based on race, class, and religion
        function autoFillWorthiness() {
            const raceValue = document.getElementById('race').value;
            const classValue = document.getElementById('class').value;
            const religionValue = document.getElementById('religion').value;
            const worthinessSlider = document.getElementById('worthiness_slider');

            if (!worthinessSlider) return;

            let totalWorthiness = 0;

            // Add race worthiness
            if (raceValue && RACES[raceValue] && RACES[raceValue].startingEquipment) {
                const raceWorth = RACES[raceValue].startingEquipment.worthiness || 0;
                console.log(`Race (${raceValue}) worthiness: ${raceWorth}`);
                totalWorthiness += raceWorth;
            }

            // Add class worthiness
            if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment) {
                const classWorth = CLASSES[classValue].startingEquipment.worthiness || 0;
                console.log(`Class (${classValue}) worthiness: ${classWorth}`);
                totalWorthiness += classWorth;
            }

            // Add religion worthiness bonuses (including negative bonuses)
            if (religionValue && RELIGIONS[religionValue] && RELIGIONS[religionValue].bonuses) {
                RELIGIONS[religionValue].bonuses.forEach(bonus => {
                    console.log(`Checking religion bonus: "${bonus}"`);
                    const match = bonus.match(/^([+-]\d+)\s+Worthiness$/i);
                    if (match) {
                        const bonusValue = parseInt(match[1], 10);
                        console.log(`Matched worthiness bonus: ${bonusValue}`);
                        totalWorthiness += bonusValue;
                    }
                });
            }

            console.log(`Total worthiness before clamping: ${totalWorthiness}`);

            // Clamp to slider range (-10 to +10)
            totalWorthiness = Math.max(-10, Math.min(10, totalWorthiness));

            console.log(`Total worthiness after clamping: ${totalWorthiness}`);

            worthinessSlider.value = totalWorthiness;
            // Trigger input event to update display
            worthinessSlider.dispatchEvent(new Event('input'));
        }

        // Function to auto-fill starting weapon and armor
        function autoFillStartingEquipment() {
            const raceValue = document.getElementById('race').value;
            const classValue = document.getElementById('class').value;

            // Reset all equipment fields first
            const fieldsToReset = [
                'weapon_1_type', 'weapon_2_type',
                'armor_1_type', 'armor_2_type', 'armor_3_type', 'armor_5_type',
                'shield_type'
            ];
            fieldsToReset.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.value = '';
                    field.dispatchEvent(new Event('change'));
                }
            });

            // Auto-fill starting weapons: Class weapon in slot 1, Race weapon in slot 2
            let classWeapon = '';
            let raceWeapon = '';

            if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment && CLASSES[classValue].startingEquipment.weapon) {
                classWeapon = CLASSES[classValue].startingEquipment.weapon;
            }

            if (raceValue && RACES[raceValue] && RACES[raceValue].startingEquipment && RACES[raceValue].startingEquipment.weapon) {
                raceWeapon = RACES[raceValue].startingEquipment.weapon;
            }

            // Fill in weapon_1_type with class weapon
            const weapon1Field = document.getElementById('weapon_1_type');
            if (weapon1Field && classWeapon) {
                weapon1Field.value = classWeapon;
                weapon1Field.dispatchEvent(new Event('change'));
            }

            // Fill in weapon_2_type with race weapon (only if different from class weapon)
            const weapon2Field = document.getElementById('weapon_2_type');
            if (weapon2Field && raceWeapon && raceWeapon !== classWeapon) {
                weapon2Field.value = raceWeapon;
                weapon2Field.dispatchEvent(new Event('change'));
            }

            // Auto-fill starting armor (now supports multiple pieces)
            if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment && CLASSES[classValue].startingEquipment.armor) {
                const armorData = CLASSES[classValue].startingEquipment.armor;

                // Handle both old string format and new object format
                if (typeof armorData === 'string') {
                    // Old format: single armor string for chest
                    const armor3Field = document.getElementById('armor_3_type');
                    if (armor3Field) {
                        armor3Field.value = armorData;
                        armor3Field.dispatchEvent(new Event('change'));
                    }
                } else if (typeof armorData === 'object') {
                    // New format: object with head, shoulders, chest, legs
                    // Head (armor_1)
                    if (armorData.head) {
                        const headField = document.getElementById('armor_1_type');
                        if (headField) {
                            headField.value = armorData.head;
                            headField.dispatchEvent(new Event('change'));
                        }
                    }
                    // Shoulders (armor_2)
                    if (armorData.shoulders) {
                        const shouldersField = document.getElementById('armor_2_type');
                        if (shouldersField) {
                            shouldersField.value = armorData.shoulders;
                            shouldersField.dispatchEvent(new Event('change'));
                        }
                    }
                    // Chest (armor_3)
                    if (armorData.chest) {
                        const chestField = document.getElementById('armor_3_type');
                        if (chestField) {
                            chestField.value = armorData.chest;
                            chestField.dispatchEvent(new Event('change'));
                        }
                    }
                    // Legs (armor_5)
                    if (armorData.legs) {
                        const legsField = document.getElementById('armor_5_type');
                        if (legsField) {
                            legsField.value = armorData.legs;
                            legsField.dispatchEvent(new Event('change'));
                        }
                    }
                }
            }

            // Auto-fill starting shield (from race or class)
            let startingShield = '';
            if (raceValue && RACES[raceValue] && RACES[raceValue].startingEquipment && RACES[raceValue].startingEquipment.shield) {
                startingShield = RACES[raceValue].startingEquipment.shield;
            } else if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment && CLASSES[classValue].startingEquipment.shield) {
                startingShield = CLASSES[classValue].startingEquipment.shield;
            }

            // Fill in shield_type if we have a starting shield
            const shieldField = document.getElementById('shield_type');
            if (shieldField && startingShield) {
                shieldField.value = startingShield;
                // Trigger auto-fill for shield stats
                shieldField.dispatchEvent(new Event('change'));
            }
        }

        // Function to auto-fill HP based on race + class bonus
        function autoFillHP() {
            const raceValue = document.getElementById('race').value;
            const classValue = document.getElementById('class').value;
            const hpSlider = document.getElementById('hp_slider');
            const hpDisplay = document.getElementById('hp-value-display');

            // Get race base HP
            let baseHP = 0;
            if (raceValue && RACES[raceValue] && RACES[raceValue].startingEquipment && RACES[raceValue].startingEquipment.hp) {
                baseHP = RACES[raceValue].startingEquipment.hp;
            }

            // Get class HP bonus
            let classBonus = 0;
            if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment && CLASSES[classValue].startingEquipment.hpBonus) {
                classBonus = CLASSES[classValue].startingEquipment.hpBonus;
            }

            // Calculate total HP
            const maxHP = baseHP + classBonus;

            if (maxHP > 0) {
                // Set max value and current value to max HP
                hpSlider.max = maxHP;
                hpSlider.value = maxHP;

                // Update display
                hpDisplay.textContent = `${maxHP} / ${maxHP}`;

                // Trigger input event to update colors
                hpSlider.dispatchEvent(new Event('input'));

                console.log(`HP set to ${maxHP} (race ${raceValue}: ${baseHP} + class ${classValue}: +${classBonus})`);
            }
        }

        // Function to auto-fill starting food/water/ammo
        function autoFillConsumables() {
            const raceValue = document.getElementById('race').value;
            const classValue = document.getElementById('class').value;

            // Reset consumable fields first
            const foodField = document.getElementById('food_water_1');
            const arrowsField = document.getElementById('arrows');
            if (foodField) foodField.value = '';
            if (arrowsField) arrowsField.value = '';

            // Auto-fill food (prioritize class over race)
            let foodText = '';
            if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment && CLASSES[classValue].startingEquipment.food) {
                foodText = CLASSES[classValue].startingEquipment.food + ' rations';
            } else if (raceValue && RACES[raceValue] && RACES[raceValue].startingEquipment && RACES[raceValue].startingEquipment.food) {
                foodText = RACES[raceValue].startingEquipment.food + ' rations';
            }

            if (foodField && foodText) {
                foodField.value = foodText;
            }

            // Auto-fill ammo/arrows (prioritize class over race)
            let ammoText = '';
            if (classValue && CLASSES[classValue] && CLASSES[classValue].startingEquipment && CLASSES[classValue].startingEquipment.ammo) {
                ammoText = CLASSES[classValue].startingEquipment.ammo;
            } else if (raceValue && RACES[raceValue] && RACES[raceValue].startingEquipment && RACES[raceValue].startingEquipment.ammo) {
                ammoText = RACES[raceValue].startingEquipment.ammo;
            }

            if (arrowsField && ammoText) {
                arrowsField.value = ammoText;
            }
        }

        // Function to auto-fill arcana based on class
        function autoFillArcana() {
            const classValue = document.getElementById('class').value;
            const arcanaSlider = document.getElementById('arcana_slider');
            const arcanaDisplay = document.getElementById('arcana-value-display');

            if (!arcanaSlider || !arcanaDisplay) return;

            // Check if class is a conjurer (has abilityType: "arcana")
            const isConjurer = classValue && CLASSES[classValue] && CLASSES[classValue].abilityType === "arcana";

            if (isConjurer) {
                // Enable slider for conjurers
                arcanaSlider.disabled = false;

                // Set max mana and starting arcana based on class
                if (classValue === "Mage") {
                    arcanaSlider.max = 20;
                    arcanaSlider.value = 10;
                } else if (classValue === "Druid") {
                    arcanaSlider.max = 16;
                    arcanaSlider.value = 8;
                } else {
                    // Other conjurers default to 16 max and start with 0
                    arcanaSlider.max = 16;
                    arcanaSlider.value = 0;
                }

            } else {
                // Disable slider and set to 0 for non-conjurers
                arcanaSlider.max = 16;
                arcanaSlider.disabled = true;
                arcanaSlider.value = 0;
            }

            // Update display
            arcanaDisplay.textContent = `${arcanaSlider.value} / ${arcanaSlider.max}`;

            // Update visual gradient
            const percentage = (arcanaSlider.value / arcanaSlider.max) * 100;
            arcanaSlider.style.background = `linear-gradient(to right, var(--primary-purple) ${percentage}%, rgba(139, 92, 246, 0.3) ${percentage}%)`;
        }

        // Function to apply a single bonus (like "+1 Strength")
        function applyBonus(bonus) {
            // Skip if it starts with "Starting" or other non-attribute text
            if (!bonus.startsWith('+') && !bonus.startsWith('-')) return;

            // Parse the bonus: "+1 Strength" -> value: 1, attribute: "Strength"
            const match = bonus.match(/^([+-]\d+)\s+(.+)$/);
            if (!match) return;

            const value = parseInt(match[1]);
            const attributeName = match[2];

            // Find the field ID for this attribute
            const fieldId = attributeMapping[attributeName];
            if (!fieldId) return;

            const field = document.getElementById(fieldId);
            if (field) {
                const currentValue = parseInt(field.value) || 0;
                field.value = currentValue + value;
            }
        }

        // Update bonus displays when race/class/religion changes
        document.getElementById('race').addEventListener('change', function() {
            const raceBonuses = document.getElementById('race-bonuses');
            const raceHeader = document.getElementById('race-bonuses-header');
            if (this.value && RACES[this.value]) {
                raceHeader.textContent = `${this.value} Bonuses`;
                raceBonuses.innerHTML = '<ul style="margin: 0; padding-left: 20px;">' +
                    RACES[this.value].bonuses.map(b => `<li>${b}</li>`).join('') +
                    '</ul>';
            } else {
                raceHeader.textContent = 'Race Bonuses';
                raceBonuses.innerHTML = '<em>Select a race to see bonuses</em>';
            }
            autoFillAttributes();
            autoFillGold();
            autoFillWorthiness();
            autoFillStartingEquipment();
            autoFillConsumables();
            autoFillArcana();
            autoFillHP();
        });

        document.getElementById('class').addEventListener('change', function() {
            const classBonuses = document.getElementById('class-bonuses');
            const classHeader = document.getElementById('class-bonuses-header');
            if (this.value && CLASSES[this.value]) {
                classHeader.textContent = `${this.value} Bonuses`;
                classBonuses.innerHTML = '<ul style="margin: 0; padding-left: 20px;">' +
                    CLASSES[this.value].bonuses.map(b => `<li>${b}</li>`).join('') +
                    '</ul>';
            } else {
                classHeader.textContent = 'Class Bonuses';
                classBonuses.innerHTML = '<em>Select a class to see bonuses</em>';
            }

            // Rebuild spells table based on class
            let numSpells = 5; // Default for classes without specific data
            if (this.value && CLASSES[this.value] && CLASSES[this.value].startingEquipment) {
                // Use spells if defined (for arcana classes), otherwise abilities (for melee classes)
                numSpells = CLASSES[this.value].startingEquipment.spells ||
                           CLASSES[this.value].startingEquipment.abilities ||
                           5;
            }
            buildSpellsTable(numSpells);

            autoFillAttributes();
            autoFillGold();
            autoFillWorthiness();
            autoFillStartingEquipment();
            autoFillConsumables();
            autoFillArcana();
            autoFillHP();

            // Show/hide Arcane Elixir based on class (only for Mage/Druid)
            const arcaneElixirContainer = document.getElementById('arcane-elixir-container');
            if (arcaneElixirContainer) {
                const isCaster = this.value === 'Mage' || this.value === 'Druid';
                arcaneElixirContainer.style.display = isCaster ? 'block' : 'none';
                // Reset to 0 if not a caster
                if (!isCaster) {
                    const arcaneSlider = document.getElementById('pot_arcane_slider');
                    if (arcaneSlider) {
                        arcaneSlider.value = 0;
                        arcaneSlider.dispatchEvent(new Event('input'));
                    }
                }
            }
        });

        document.getElementById('religion').addEventListener('change', function() {
            const religionBonuses = document.getElementById('religion-bonuses');
            const religionHeader = document.getElementById('religion-bonuses-header');
            if (this.value && RELIGIONS[this.value]) {
                const religion = RELIGIONS[this.value];
                religionHeader.textContent = `${this.value} Bonuses`;

                let html = '';
                // Add deity and description
                if (religion.deity && religion.description) {
                    html += `<p style="margin: 10px 0; padding: 10px; background: rgba(139, 92, 246, 0.1); border-radius: 5px; font-style: italic;">
                        <strong>Deity:</strong> ${religion.deity}<br>
                        ${religion.description}
                    </p>`;
                }

                // Add bonuses list
                html += '<ul style="margin: 0; padding-left: 20px;">' +
                    religion.bonuses.map(b => `<li>${b}</li>`).join('') +
                    '</ul>';

                religionBonuses.innerHTML = html;
            } else {
                religionHeader.textContent = 'Religion Bonuses';
                religionBonuses.innerHTML = '<em>Select a religion to see bonuses</em>';
            }
            autoFillAttributes();
            autoFillWorthiness();
        });

        // Toggle armor broken state (red background when checked)
        function toggleArmorBroken(armorIndex) {
            const checkbox = document.getElementById(`armor_${armorIndex}_broken`);
            const row = document.getElementById(`armor_${armorIndex}_row`);

            if (checkbox && row) {
                if (checkbox.checked) {
                    row.style.background = 'rgba(239, 68, 68, 0.3)';
                    row.style.borderLeft = '4px solid #ef4444';
                } else {
                    row.style.background = '';
                    row.style.borderLeft = '';
                }
            }
        }

        // Toggle shield broken state (red background when checked)
        function toggleShieldBroken() {
            const checkbox = document.getElementById('shield_broken');
            const row = document.getElementById('shield_row');

            if (checkbox && row) {
                if (checkbox.checked) {
                    row.style.background = 'rgba(239, 68, 68, 0.3)';
                    row.style.borderLeft = '4px solid #ef4444';
                } else {
                    row.style.background = '';
                    row.style.borderLeft = '';
                }
            }
        }

        // Add listeners for armor/shield damage and HP fields to auto-update broken status
        function initEquipmentBrokenListeners() {
            // Shield listeners
            const shieldDmg = document.getElementById('shield_dmg_taken');
            const shieldHp = document.getElementById('shield_hp');
            if (shieldDmg) {
                shieldDmg.addEventListener('input', () => checkEquipmentBroken('shield_dmg_taken'));
            }
            if (shieldHp) {
                shieldHp.addEventListener('input', () => checkEquipmentBroken('shield_dmg_taken'));
            }

            // Armor listeners (1-5)
            for (let i = 1; i <= 5; i++) {
                const armorDmg = document.getElementById(`armor_${i}_dmg`);
                const armorHp = document.getElementById(`armor_${i}_hp`);
                if (armorDmg) {
                    armorDmg.addEventListener('input', () => checkEquipmentBroken(`armor_${i}_dmg`));
                }
                if (armorHp) {
                    armorHp.addEventListener('input', () => checkEquipmentBroken(`armor_${i}_dmg`));
                }
            }
        }

        // Initialize all auto-fill functionality AFTER all DOM elements are created
        initializeAllAutoFills();
        initEquipmentBrokenListeners();
    </script>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideAuthModal()">&times;</button>
            <h2 id="auth-modal-title">Login</h2>
            <div class="modal-form">
                <div class="field-group">
                    <label>Username</label>
                    <input type="text" id="auth-username" placeholder="Enter username">
                </div>
                <div class="field-group">
                    <label>Password</label>
                    <input type="password" id="auth-password" placeholder="Enter password">
                </div>
                <p id="auth-error" class="error-text"></p>
                <button id="auth-submit-btn" class="modal-submit">Login</button>
                <p id="auth-toggle-text" class="toggle-text"></p>
            </div>
        </div>
    </div>

    <!-- Character List Modal -->
    <div id="character-list-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideCharacterListModal()">&times;</button>
            <h2>Your Characters</h2>
            <div id="character-list" class="character-list"></div>
        </div>
    </div>

    <!-- Trash Modal -->
    <div id="trash-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content modal-content-wide">
            <button class="modal-close" onclick="hideTrashModal()">&times;</button>
            <h2>Trash</h2>
            <p style="color: var(--text-muted); margin-bottom: 16px;">Deleted items can be restored or permanently deleted.</p>

            <div class="trash-section">
                <h3 class="trash-section-title">Deleted Characters</h3>
                <div id="trash-characters-list" class="trash-list">
                    <p class="trash-empty">No deleted characters</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Link Campaign Modal -->
    <div id="link-campaign-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideLinkCampaignModal()">&times;</button>
            <h2>Link to Campaign</h2>
            <p style="color: var(--text-muted); margin-bottom: 16px;">Enter the campaign code from your DM to link this character.</p>
            <div class="modal-form">
                <div class="field-group">
                    <label>Campaign Code</label>
                    <input type="text" id="campaign-share-code" placeholder="Enter code (e.g., A1B2C3D4)" style="text-transform: uppercase;">
                </div>
                <button class="modal-submit" onclick="linkCharacterToCampaign()">Link Character</button>
            </div>
        </div>
    </div>

    <!-- Avatar Selection Modal -->
    <div id="avatar-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content avatar-modal-content">
            <button class="modal-close" onclick="hideAvatarModal()">&times;</button>
            <h2>Choose Avatar</h2>

            <!-- Predefined Avatars -->
            <div class="avatar-section">
                <h3 class="avatar-section-title">Fantasy Portraits</h3>
                <div class="avatar-grid">
                    <button class="avatar-option" onclick="selectAvatar('üßô')" title="Wizard">üßô</button>
                    <button class="avatar-option" onclick="selectAvatar('üßù')" title="Elf">üßù</button>
                    <button class="avatar-option" onclick="selectAvatar('üßõ')" title="Vampire">üßõ</button>
                    <button class="avatar-option" onclick="selectAvatar('üßö')" title="Fairy">üßö</button>
                    <button class="avatar-option" onclick="selectAvatar('üßû')" title="Genie">üßû</button>
                    <button class="avatar-option" onclick="selectAvatar('üßü')" title="Zombie">üßü</button>
                    <button class="avatar-option" onclick="selectAvatar('ü¶π')" title="Hero">ü¶π</button>
                    <button class="avatar-option" onclick="selectAvatar('ü•∑')" title="Ninja">ü•∑</button>
                    <button class="avatar-option" onclick="selectAvatar('üë∏')" title="Princess">üë∏</button>
                    <button class="avatar-option" onclick="selectAvatar('ü§¥')" title="Prince">ü§¥</button>
                    <button class="avatar-option" onclick="selectAvatar('üëº')" title="Angel">üëº</button>
                    <button class="avatar-option" onclick="selectAvatar('üòà')" title="Demon">üòà</button>
                </div>
            </div>

            <!-- Combat/Class Icons -->
            <div class="avatar-section">
                <h3 class="avatar-section-title">Combat & Class</h3>
                <div class="avatar-grid">
                    <button class="avatar-option" onclick="selectAvatar('‚öîÔ∏è')" title="Warrior">‚öîÔ∏è</button>
                    <button class="avatar-option" onclick="selectAvatar('üõ°Ô∏è')" title="Shield">üõ°Ô∏è</button>
                    <button class="avatar-option" onclick="selectAvatar('üèπ')" title="Archer">üèπ</button>
                    <button class="avatar-option" onclick="selectAvatar('üó°Ô∏è')" title="Rogue">üó°Ô∏è</button>
                    <button class="avatar-option" onclick="selectAvatar('üîÆ')" title="Sorcerer">üîÆ</button>
                    <button class="avatar-option" onclick="selectAvatar('‚ú®')" title="Magic">‚ú®</button>
                    <button class="avatar-option" onclick="selectAvatar('üåø')" title="Druid">üåø</button>
                    <button class="avatar-option" onclick="selectAvatar('üê∫')" title="Beast">üê∫</button>
                    <button class="avatar-option" onclick="selectAvatar('ü¶Ö')" title="Eagle">ü¶Ö</button>
                    <button class="avatar-option" onclick="selectAvatar('üêâ')" title="Dragon">üêâ</button>
                    <button class="avatar-option" onclick="selectAvatar('üíÄ')" title="Skull">üíÄ</button>
                    <button class="avatar-option" onclick="selectAvatar('üåô')" title="Moon">üåô</button>
                </div>
            </div>

            <!-- Upload Custom Image -->
            <div class="avatar-section">
                <h3 class="avatar-section-title">Upload Custom Image</h3>
                <div class="avatar-upload-area">
                    <input type="file" id="avatar-file-input" accept="image/jpeg,image/png,image/webp,image/gif" style="display:none;" onchange="handleAvatarUpload(event)">
                    <button class="avatar-upload-btn" onclick="document.getElementById('avatar-file-input').click()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Choose Image
                    </button>
                    <p class="avatar-upload-hint">JPG, PNG, WebP, GIF (max 2MB)</p>
                </div>
                <div id="avatar-preview-area" class="avatar-preview-area" style="display:none;">
                    <img id="avatar-preview-img" src="" alt="Preview">
                    <button class="avatar-use-btn" onclick="useUploadedAvatar()">Use This Image</button>
                </div>
            </div>

            <!-- Current Avatar Preview -->
            <div class="avatar-current">
                <span class="avatar-current-label">Current:</span>
                <div class="avatar-current-preview" id="avatar-current-preview">?</div>
                <button class="avatar-clear-btn" onclick="clearAvatar()" title="Reset to default">Clear</button>
            </div>
        </div>
    </div>

    <!-- PWA: Service Worker & Install -->
    <script>
        // Store the install prompt event
        let deferredPrompt = null;

        // Listen for the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('PWA: Install prompt ready');
        });

        // Install PWA function
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA: User accepted install');
                    }
                    deferredPrompt = null;
                });
            } else {
                // Show manual install instructions
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isAndroid = /Android/.test(navigator.userAgent);

                if (isIOS) {
                    alert('To install:\n1. Tap the Share button (square with arrow)\n2. Scroll down and tap "Add to Home Screen"\n3. Tap "Add"');
                } else if (isAndroid) {
                    alert('To install:\n1. Tap the menu (three dots)\n2. Tap "Add to Home Screen" or "Install App"\n3. Tap "Install"');
                } else {
                    alert('To install:\n1. Click the install icon in the address bar\n   (or use browser menu ‚Üí "Install App")');
                }
            }
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('PWA: Service Worker registered', registration.scope);
                    })
                    .catch(error => {
                        console.log('PWA: Service Worker registration failed', error);
                    });
            });
        }
    </script>

    <!-- Privacy Banner -->
    <div id="privacy-banner" class="privacy-banner">
        <div class="privacy-banner-content">
            <div class="privacy-banner-text">
                <div class="privacy-banner-title">Privacy & Analytics</div>
                <div class="privacy-banner-description">
                    We use privacy-friendly analytics to understand how Aedelore is used. No cookies, no personal data, fully anonymous.
                    <a class="privacy-banner-link" onclick="AedelorePrivacy.showPrivacyDetails()">Learn more</a>
                </div>
            </div>
            <div class="privacy-banner-actions">
                <button class="privacy-btn privacy-btn-secondary" onclick="AedelorePrivacy.declineAnalytics()">Decline</button>
                <button class="privacy-btn privacy-btn-primary" onclick="AedelorePrivacy.acceptAnalytics()">Accept</button>
            </div>
        </div>
    </div>

    <!-- Privacy Details Modal -->
    <div id="privacy-details-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Privacy Information</h2>
                <button class="modal-close" onclick="AedelorePrivacy.hidePrivacyDetails()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="privacy-status-row">
                    <span class="privacy-status-label">Anonymous Analytics</span>
                    <div class="privacy-status-value">
                        <span id="privacy-analytics-status" class="privacy-status-disabled">Disabled</span>
                        <button id="privacy-analytics-toggle" class="privacy-btn privacy-btn-primary" onclick="AedelorePrivacy.toggleAnalytics()">Enable</button>
                    </div>
                </div>

                <div class="privacy-details-section">
                    <h4>What We Collect</h4>
                    <ul>
                        <li>Page views and navigation patterns</li>
                        <li>Referrer (where you came from)</li>
                        <li>Browser type and screen size</li>
                        <li>Country (from anonymized IP)</li>
                    </ul>
                </div>

                <div class="privacy-details-section">
                    <h4>What We Do NOT Collect</h4>
                    <ul>
                        <li>No cookies or tracking pixels</li>
                        <li>No personal information</li>
                        <li>No IP addresses stored</li>
                        <li>No connection to your account</li>
                    </ul>
                </div>

                <div class="privacy-details-section">
                    <h4>Why We Collect This</h4>
                    <p>To understand how Aedelore is used and improve the tools for the community. All data is aggregated and anonymous.</p>
                </div>

                <div class="privacy-details-section">
                    <h4>Data Deletion</h4>
                    <p>Since analytics are completely anonymous, we cannot identify or delete individual user data. You can disable analytics at any time using the toggle above.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/privacy.js"></script>

    <!-- Mobile Tab Toggle (floating side menu) -->
    <div id="mobile-tab-toggle" class="mobile-tab-toggle" onclick="toggleMobileTabMenu()">
        <span class="mobile-tab-toggle-arrow">‚óÄ</span>
    </div>
    <div id="mobile-tab-panel" class="mobile-tab-panel">
        <div class="mobile-tab-panel-item active" onclick="switchTabMobile('page-dashboard')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
            <span>Overview</span>
        </div>
        <div class="mobile-tab-panel-item" onclick="switchTabMobile('page-info')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span>Character</span>
        </div>
        <div class="mobile-tab-panel-item" onclick="switchTabMobile('page-attributes')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
            <span>Stats</span>
        </div>
        <div class="mobile-tab-panel-item" onclick="switchTabMobile('page-combat')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="M13 19l6-6"/><path d="M16 16l4 4"/><path d="M19 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>
            <span>Combat</span>
        </div>
        <div class="mobile-tab-panel-item" onclick="switchTabMobile('page-spells')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/></svg>
            <span>Abilities</span>
        </div>
        <div class="mobile-tab-panel-item" onclick="switchTabMobile('page-gear')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
            <span>Gear</span>
        </div>
        <div class="mobile-tab-panel-item" onclick="switchTabMobile('page-tools')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"/><path d="M6 18h.01"/><path d="M10 14h.01"/><path d="M15 6h.01"/><path d="M18 9h.01"/></svg>
            <span>Tools</span>
        </div>
    </div>
    <div id="mobile-tab-overlay" class="mobile-tab-overlay" onclick="closeMobileTabMenu()"></div>

    <script>
        // Mobile tab menu functions
        let mobileTabMenuOpen = false;

        function toggleMobileTabMenu() {
            mobileTabMenuOpen = !mobileTabMenuOpen;
            const toggle = document.getElementById('mobile-tab-toggle');
            const panel = document.getElementById('mobile-tab-panel');
            const overlay = document.getElementById('mobile-tab-overlay');

            if (mobileTabMenuOpen) {
                toggle.classList.add('open');
                panel.classList.add('open');
                overlay.classList.add('open');
            } else {
                toggle.classList.remove('open');
                panel.classList.remove('open');
                overlay.classList.remove('open');
            }
        }

        function closeMobileTabMenu() {
            if (mobileTabMenuOpen) {
                toggleMobileTabMenu();
            }
        }

        function switchTabMobile(tabId) {
            switchTab(tabId);
            closeMobileTabMenu();
        }

        // Update active state in mobile panel
        const originalSwitchTab = switchTab;
        switchTab = function(tabId) {
            originalSwitchTab(tabId);
            // Update mobile panel active state
            document.querySelectorAll('.mobile-tab-panel-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('onclick')?.includes(tabId)) {
                    item.classList.add('active');
                }
            });
        };
    </script>
</body>
</html>
