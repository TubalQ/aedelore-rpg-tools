<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aedelore DM Session Tool</title>

    <meta name="description" content="Manage your Aedelore RPG campaigns and sessions with our DM Session Tool. Track players, scenes, decisions, NPCs, combat, and more.">
    <meta name="theme-color" content="#8b5cf6">
    <script>
        (function() {
            var colors = {'aedelore':'#8b5cf6','dark-glass':'#1a1a1f','midnight':'#0a1628','ember':'#1a0c08'};
            var theme = localStorage.getItem('aedelore_theme') || 'aedelore';
            var color = colors[theme] || '#8b5cf6';
            document.querySelector('meta[name="theme-color"]').setAttribute('content', color);
            if (theme !== 'aedelore') document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://aedelore.nu/dm-session">

    <link rel="icon" type="image/jpeg" href="https://aedelore.nu/uploads/images/system/2025-09/world-of-aedelore.jpg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* DM Session specific styles */

        /* AI Modal Tabs */
        .ai-tab {
            padding: var(--space-3) var(--space-4);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all var(--transition-fast);
        }
        .ai-tab:hover {
            color: var(--text-base);
        }
        .ai-tab.active {
            color: #8b5cf6;
            border-bottom-color: #8b5cf6;
        }
        .ai-tab-content {
            animation: fadeIn 0.2s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .ai-import-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            margin-bottom: var(--space-2);
        }
        .ai-import-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }
        .ai-import-item-type {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #8b5cf6;
            font-weight: 600;
        }
        .ai-import-item-name {
            font-weight: 600;
            color: var(--text-base);
        }
        .ai-import-item-details {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Help Modal Styles */
        .help-nav-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all var(--transition-fast);
        }
        .help-nav-btn:hover {
            border-color: #06b6d4;
            color: #06b6d4;
        }
        .help-nav-btn.active {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            border-color: transparent;
            color: white;
        }
        .help-section {
            animation: fadeIn 0.2s ease;
        }
        .help-block {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
        }
        .help-block h4 {
            color: #06b6d4;
            font-size: 1rem;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .help-block p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: var(--space-2);
        }
        .help-block p:last-child {
            margin-bottom: 0;
        }
        .help-block ul, .help-block ol {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            padding-left: var(--space-4);
            margin: 0;
        }
        .help-block li {
            margin-bottom: 6px;
        }
        .help-block li:last-child {
            margin-bottom: 0;
        }
        .help-block strong {
            color: var(--text-base);
        }

        @media (max-width: 600px) {
            .help-nav-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
            }
            .help-block {
                padding: var(--space-3);
            }
            .help-block h4 {
                font-size: 0.95rem;
            }
            .help-block p, .help-block ul, .help-block ol {
                font-size: 0.85rem;
            }
        }

        /* Header Dropdown Menus */
        .header-dropdown {
            position: relative;
            display: inline-block;
        }
        .header-dropdown-trigger {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-base);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .header-dropdown-trigger:hover {
            border-color: var(--primary-purple);
            background: var(--bg-highlight);
        }
        .header-dropdown-trigger.open {
            border-color: var(--primary-purple);
            background: var(--bg-highlight);
        }
        .header-dropdown-trigger svg.chevron {
            transition: transform 0.2s ease;
        }
        .header-dropdown-trigger.open svg.chevron {
            transform: rotate(180deg);
        }
        .header-dropdown-menu {
            position: absolute;
            top: calc(100% + 4px);
            right: 0;
            min-width: 160px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            overflow: hidden;
        }
        .header-dropdown-menu.open {
            display: block;
            animation: dropdownFadeIn 0.15s ease;
        }
        @keyframes dropdownFadeIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .header-dropdown-menu button {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 10px 14px;
            background: transparent;
            border: none;
            color: var(--text-base);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.15s ease;
            text-align: left;
        }
        .header-dropdown-menu button:hover {
            background: var(--bg-highlight);
        }
        .header-dropdown-menu button svg {
            flex-shrink: 0;
            opacity: 0.7;
        }
        .header-dropdown-menu hr {
            margin: 4px 0;
            border: none;
            border-top: 1px solid var(--border-default);
        }
        .header-dropdown-menu button.theme-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .theme-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .theme-check {
            margin-left: auto;
            color: var(--accent-green);
            font-weight: bold;
        }
        /* Special styling for AI dropdown trigger */
        .header-dropdown-trigger.ai-trigger {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border-color: transparent;
            color: white;
        }
        .header-dropdown-trigger.ai-trigger:hover {
            filter: brightness(1.1);
        }

        .selector-bar {
            display: flex;
            gap: var(--space-4);
            align-items: center;
            flex-wrap: wrap;
            padding: var(--space-4);
            background: var(--bg-elevated);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-4);
        }

        .selector-bar select {
            min-width: 200px;
        }

        .selector-bar .btn-new {
            padding: var(--space-2) var(--space-4);
            background: linear-gradient(135deg, var(--accent-green) 0%, #1db954 100%);
            color: #000;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .selector-bar .btn-new:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px var(--accent-green-glow);
        }

        .selector-group {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .btn-edit {
            padding: var(--space-1) var(--space-2);
            background: transparent;
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.75rem;
            transition: all var(--transition-fast);
        }

        .btn-edit:hover {
            border-color: var(--primary-purple);
            color: var(--primary-purple);
        }

        .quick-add-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: linear-gradient(135deg, var(--accent-green) 0%, #1db954 100%);
            color: #000;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-top: var(--space-3);
        }

        .quick-add-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px var(--accent-green-glow);
        }

        .dynamic-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            position: relative;
        }

        /* Global remove button style */
        .remove-btn {
            position: absolute;
            background: rgba(255, 87, 87, 0.1);
            border: 1px solid rgba(255, 87, 87, 0.3);
            color: var(--accent-red);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            z-index: 10;
        }

        .remove-btn:hover {
            background: rgba(255, 87, 87, 0.3);
        }

        .dynamic-item .remove-btn {
            top: var(--space-2);
            right: var(--space-2);
            width: 28px;
            height: 28px;
            font-size: 1.2rem;
        }

        .locked-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            background: rgba(255, 87, 87, 0.1);
            border: 1px solid rgba(255, 87, 87, 0.3);
            border-radius: var(--radius-md);
            color: var(--accent-red);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }

        .locked-indicator.unlocked {
            background: rgba(34, 217, 127, 0.1);
            border-color: rgba(34, 217, 127, 0.3);
            color: var(--accent-green);
        }

        .decision-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-purple);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
            position: relative;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-4);
        }

        .decision-option {
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            padding: var(--space-3);
        }

        .decision-option label {
            color: var(--accent-gold);
            font-weight: 600;
            display: block;
            margin-bottom: var(--space-2);
        }

        .npc-card {
            background: linear-gradient(180deg, var(--bg-surface) 0%, var(--bg-elevated) 100%);
            border: 1px solid var(--border-blue);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            position: relative;
        }

        .combat-encounter {
            background: var(--bg-surface);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
            position: relative;
        }

        .enemy-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr auto;
            gap: var(--space-2);
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .enemy-row input {
            width: 100%;
        }

        .read-aloud-box {
            background: linear-gradient(135deg, rgba(240, 192, 64, 0.1) 0%, rgba(240, 192, 64, 0.02) 100%);
            border: 1px solid var(--accent-gold);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
            position: relative;
        }

        .read-aloud-box textarea {
            font-style: italic;
            line-height: 1.8;
        }

        .empty-state {
            text-align: center;
            padding: var(--space-8);
            color: var(--text-secondary);
        }

        .empty-state h3 {
            color: var(--text-base);
            margin-bottom: var(--space-2);
        }

        /* Dashboard Styles - Modern Clean */
        .dashboard {
            padding: var(--space-6) 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
        }

        .dashboard-header h2 {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-base);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .dashboard-header h2 svg {
            color: var(--accent-purple);
        }

        .campaign-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-5);
        }

        .campaign-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            position: relative;
            transition: all var(--transition-base);
            overflow: hidden;
        }

        .campaign-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue), var(--accent-cyan));
        }

        .campaign-card:hover {
            border-color: var(--border-default);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transform: translateY(-3px);
        }

        .campaign-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .campaign-card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-base);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .campaign-card-title svg {
            color: var(--accent-gold);
        }

        .campaign-card-menu {
            position: relative;
        }

        .campaign-card-menu-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .campaign-card-menu-btn:hover {
            background: var(--bg-highlight);
            color: var(--text-base);
        }

        .campaign-card-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 100;
            min-width: 120px;
            display: none;
        }

        .campaign-card-dropdown.open {
            display: block;
        }

        .campaign-card-dropdown button {
            display: block;
            width: 100%;
            padding: var(--space-2) var(--space-3);
            background: transparent;
            border: none;
            color: var(--text-base);
            text-align: left;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .campaign-card-dropdown button:hover {
            background: var(--bg-highlight);
        }

        .campaign-card-dropdown button.danger {
            color: var(--accent-red);
        }

        .campaign-card-description {
            color: var(--text-subdued);
            font-size: 0.9rem;
            margin-bottom: var(--space-4);
            min-height: 2.7em;
            line-height: 1.5;
        }

        .campaign-card-stats {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
        }

        .campaign-card-stat {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .campaign-card-stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-cyan);
        }

        .campaign-card-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .campaign-card-actions {
            display: flex;
            gap: var(--space-2);
        }

        .campaign-card-btn {
            flex: 1;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .campaign-card-btn.primary {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border: none;
            color: white;
        }

        .campaign-card-btn.primary:hover {
            box-shadow: 0 4px 15px var(--accent-purple-glow);
            transform: translateY(-1px);
        }

        .campaign-card-btn.secondary {
            background: transparent;
            border: 1px solid var(--border-default);
            color: var(--text-base);
        }

        .campaign-card-btn.secondary:hover {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        /* New Campaign Card */
        .campaign-card.new-card {
            border-style: dashed;
            border-color: var(--border-default);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            cursor: pointer;
            background: transparent;
        }

        .campaign-card.new-card::before {
            display: none;
        }

        .campaign-card.new-card:hover {
            border-color: var(--accent-green);
            background: rgba(34, 217, 127, 0.05);
        }

        .campaign-card.new-card svg {
            width: 48px;
            height: 48px;
            color: var(--text-muted);
            margin-bottom: var(--space-3);
            transition: color var(--transition-fast);
        }

        .campaign-card.new-card:hover svg {
            color: var(--accent-green);
        }

        .campaign-card.new-card span {
            color: var(--text-muted);
            font-weight: 500;
            transition: color var(--transition-fast);
        }

        .campaign-card.new-card:hover span {
            color: var(--accent-green);
        }

        /* Back to Dashboard button */
        .back-to-dashboard {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: transparent;
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-subdued);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-bottom: var(--space-4);
        }

        .back-to-dashboard:hover {
            border-color: var(--accent-purple);
            color: var(--accent-purple);
        }

        .back-to-dashboard svg {
            width: 16px;
            height: 16px;
        }

        /* Sessions list in campaign card */
        .campaign-sessions-preview {
            margin-top: var(--space-3);
        }

        .campaign-sessions-preview-title {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-2);
        }

        .session-chip {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            background: var(--bg-highlight);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-subdued);
            margin-right: var(--space-1);
            margin-bottom: var(--space-1);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .session-chip:hover {
            background: var(--bg-press);
            color: var(--text-base);
        }

        .session-chip.locked {
            opacity: 0.6;
        }

        .session-chip svg {
            width: 12px;
            height: 12px;
        }

        @media (max-width: 600px) {
            .campaign-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-3);
            }
        }

        .grid-2-unequal {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: var(--space-4);
        }

        /* Session header with editable fields - Modern Clean */
        .session-header {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            position: relative;
            overflow: hidden;
        }

        .session-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue), var(--accent-cyan));
        }

        .session-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .session-title-group {
            flex: 1;
        }

        .session-title-group h2 {
            margin: 0;
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--text-base);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .session-title-group .campaign-name {
            color: var(--accent-purple);
            font-size: var(--font-size-sm);
            font-weight: 500;
            margin-bottom: var(--space-2);
            display: inline-block;
            padding: var(--space-1) var(--space-3);
            background: var(--accent-purple-10);
            border-radius: var(--radius-md);
        }

        .editable-title {
            background: transparent;
            border: none;
            border-bottom: 2px dashed transparent;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            padding: 0;
            font-family: inherit;
            width: 100%;
            max-width: 400px;
        }

        .editable-title:hover {
            border-bottom-color: var(--border-default);
        }

        .editable-title:focus {
            outline: none;
            border-bottom-color: var(--primary-purple);
            border-bottom-style: solid;
        }

        .session-meta {
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .session-meta .field-group {
            margin-bottom: 0;
            min-width: 150px;
        }

        .session-meta label {
            font-size: 0.7rem;
            margin-bottom: 2px;
        }

        .session-meta input {
            padding: var(--space-2);
            font-size: 0.9rem;
        }

        /* Subsection styling */
        .subsection {
            margin-top: var(--space-6);
            padding-top: var(--space-4);
            border-top: 1px solid var(--border-default);
        }

        .subsection:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .subsection-title {
            font-size: 1.1rem;
            color: var(--text-base);
            margin-bottom: var(--space-3);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .subsection-title svg {
            color: var(--primary-purple);
        }

        /* Reference section styles */
        .ref-accordion {
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-3);
            overflow: hidden;
        }

        .ref-accordion-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4);
            background: var(--bg-elevated);
            cursor: pointer;
            user-select: none;
            transition: background var(--transition-fast);
        }

        .ref-accordion-header:hover {
            background: var(--bg-surface);
        }

        .ref-accordion-header h3 {
            margin: 0;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .ref-accordion-header .toggle-icon {
            transition: transform var(--transition-fast);
        }

        .ref-accordion.open .toggle-icon {
            transform: rotate(180deg);
        }

        .ref-accordion-content {
            display: none;
            padding: var(--space-4);
            background: var(--bg-base);
            border-top: 1px solid var(--border-default);
            max-height: 500px;
            overflow-y: auto;
        }

        .ref-accordion.open .ref-accordion-content {
            display: block;
        }

        .ref-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .ref-table th {
            background: var(--bg-elevated);
            padding: var(--space-2) var(--space-3);
            text-align: left;
            font-weight: 600;
            color: var(--primary-purple);
            border-bottom: 2px solid var(--border-purple);
            position: sticky;
            top: 0;
        }

        .ref-table td {
            padding: var(--space-2) var(--space-3);
            border-bottom: 1px solid var(--border-default);
        }

        .ref-table tr:hover td {
            background: rgba(168, 85, 247, 0.05);
        }

        .ref-table .num {
            text-align: center;
        }

        .ref-subsection {
            margin-top: var(--space-4);
            padding-top: var(--space-3);
            border-top: 1px solid var(--border-default);
        }

        .ref-subsection:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .ref-subsection h4 {
            color: var(--accent-gold);
            margin-bottom: var(--space-2);
            font-size: 0.9rem;
        }

        .ref-rule-box {
            background: var(--bg-elevated);
            border-left: 3px solid var(--primary-purple);
            padding: var(--space-3);
            margin-bottom: var(--space-3);
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
        }

        .ref-rule-box h5 {
            color: var(--primary-purple);
            margin: 0 0 var(--space-2) 0;
            font-size: 0.85rem;
        }

        .ref-rule-box p, .ref-rule-box ul {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .ref-rule-box ul {
            padding-left: var(--space-4);
        }

        .ref-quick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-3);
        }

        .ref-quick-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: var(--space-3);
        }

        .ref-quick-card h5 {
            color: var(--accent-gold);
            margin: 0 0 var(--space-2) 0;
            font-size: 0.8rem;
        }

        .ref-quick-card p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Tablet styles */
        @media (max-width: 768px) {
            .decision-options {
                grid-template-columns: 1fr;
            }
            .enemy-row {
                grid-template-columns: 1fr 1fr;
            }
            .grid-2-unequal {
                grid-template-columns: 1fr;
            }
            .session-header-top {
                flex-direction: column;
            }
            .session-meta {
                width: 100%;
            }
            .ref-table {
                font-size: 0.8rem;
            }
            .ref-table th, .ref-table td {
                padding: var(--space-2);
            }

            /* Ref quick grid - 2 columns on tablet */
            .ref-quick-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Ref rule boxes - better readability */
            .ref-rule-box {
                padding: var(--space-2);
            }
            .ref-rule-box p, .ref-rule-box ul {
                font-size: 0.9rem;
            }

            /* Wrap tables for horizontal scroll */
            .ref-subsection {
                overflow-x: auto;
            }

            /* Tabs - scrollable on tablet */
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            .tabs::-webkit-scrollbar {
                display: none;
            }
            .tab {
                white-space: nowrap;
                padding: var(--space-2) var(--space-3);
                font-size: 0.85rem;
            }

            /* Player view - stack on tablet */
            #player-view-container {
                padding: var(--space-3);
            }

            /* Grid adjustments */
            .grid-2 {
                grid-template-columns: 1fr !important;
            }

            /* Modal adjustments */
            .modal-content {
                width: 95%;
                max-width: none;
                margin: var(--space-2);
                max-height: 90vh;
            }
        }

        /* Mobile styles */
        @media (max-width: 480px) {
            .container {
                padding: var(--space-2);
            }

            /* Header adjustments */
            .header {
                padding: var(--space-3);
            }
            .header h1 {
                font-size: 1.5rem;
            }
            .header-actions {
                flex-wrap: wrap;
                gap: var(--space-1);
            }
            .header-actions .btn {
                padding: var(--space-1) var(--space-2);
                font-size: 0.75rem;
            }

            /* Tabs - compact on mobile */
            .tabs {
                gap: var(--space-1);
                padding: var(--space-1);
            }
            .tab {
                padding: var(--space-2);
                font-size: 0.8rem;
            }
            .tab svg {
                width: 14px;
                height: 14px;
            }

            /* Section headers */
            h3 {
                font-size: 1rem;
            }
            h4 {
                font-size: 0.9rem;
            }

            /* Input fields */
            input, textarea, select {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Enemy rows - stack completely */
            .enemy-row {
                grid-template-columns: 1fr;
                gap: var(--space-1);
            }
            .enemy-row input {
                min-width: 0;
            }

            /* Combat encounters */
            .combat-encounter {
                padding: var(--space-2);
            }

            /* Play mode cards */
            .play-card {
                padding: var(--space-3);
            }
            .play-card h4 {
                font-size: 0.85rem;
            }

            /* Ref quick grid - single column on mobile */
            .ref-quick-grid {
                grid-template-columns: 1fr;
            }

            /* Ref quick cards - better mobile readability */
            .ref-quick-card {
                padding: var(--space-2);
            }
            .ref-quick-card h5 {
                font-size: 0.85rem;
            }
            .ref-quick-card p {
                font-size: 0.85rem;
            }

            /* Ref rule boxes - larger text on mobile */
            .ref-rule-box p, .ref-rule-box ul {
                font-size: 0.95rem;
                line-height: 1.5;
            }

            /* Ref tables - readable on mobile */
            .ref-table {
                font-size: 0.8rem;
            }
            .ref-table th, .ref-table td {
                padding: var(--space-1);
            }

            /* Buttons */
            .btn {
                padding: var(--space-2) var(--space-3);
                font-size: 0.85rem;
            }
            .quick-add-btn {
                padding: var(--space-1) var(--space-2);
                font-size: 0.75rem;
            }

            /* Dynamic items */
            .dynamic-item {
                padding: var(--space-2);
            }

            /* Session cards in player view */
            #player-sessions-list > div {
                padding: var(--space-2) !important;
            }

            /* Read aloud boxes */
            .read-aloud-box {
                padding: var(--space-2);
            }

            /* Modal - full screen on mobile */
            .modal-content {
                width: 100%;
                height: 100%;
                max-height: 100%;
                margin: 0;
                border-radius: 0;
            }
            .modal-header {
                padding: var(--space-3);
            }
            .modal-body {
                padding: var(--space-3);
            }

            /* Dashboard cards */
            .campaign-card {
                padding: var(--space-3);
            }

            /* Session header */
            .session-header {
                padding: var(--space-3);
            }
            .session-header h2 {
                font-size: 1.1rem;
            }
        }

        /* Touch-friendly styles for all mobile/tablet */
        @media (hover: none) and (pointer: coarse) {
            /* Larger touch targets */
            .btn, button {
                min-height: 44px;
                min-width: 44px;
            }

            /* Better spacing for touch */
            .play-item {
                padding: var(--space-3);
                margin-bottom: var(--space-2);
            }

            /* Checkbox sizing */
            input[type="checkbox"] {
                width: 20px;
                height: 20px;
            }

            /* Select dropdown */
            select {
                min-height: 44px;
            }

            /* Remove hover states that don't work well on touch */
            .tab:hover {
                background: transparent;
            }
            .tab.active {
                background: var(--bg-elevated);
            }
        }

        /* Mobile Menu Styles - uses styles from styles.css */
        /* Additional DM-specific overrides below */

        /* DM-specific mobile overrides */
        @media (max-width: 768px) {
            /* Header dropdowns in mobile menu */
            header .header-right .header-dropdown {
                width: 100%;
            }

            header .header-right .header-dropdown-trigger {
                width: 100%;
                justify-content: flex-start;
                padding: var(--space-4);
                background: var(--bg-elevated);
                border: 1px solid var(--border-default);
                border-radius: var(--radius-lg);
                font-size: var(--font-size-base);
            }

            header .header-right .header-dropdown-trigger .chevron {
                display: block;
                margin-left: auto;
            }

            header .header-right .header-dropdown-menu {
                position: static;
                width: 100%;
                margin-top: var(--space-2);
                box-shadow: none;
            }

            /* Session status indicator */
            header .header-right #session-status-group {
                width: 100%;
                text-align: center;
                padding: var(--space-3);
                background: var(--bg-elevated);
                border-radius: var(--radius-lg);
                border: 1px solid var(--border-default);
            }

            /* Logo subtitle on mobile */
            header.header-compact .logo-subtitle {
                font-size: 0.6rem;
            }
        }

        @media (max-width: 480px) {
            header.header-compact .logo-subtitle {
                display: none;
            }
        }

        /* Calculator NPC Pool Buttons */
        .npc-pool-btn {
            padding: var(--space-2) var(--space-3);
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all var(--transition-fast);
            min-width: 40px;
        }
        .npc-pool-btn:hover {
            border-color: var(--primary-purple);
            color: var(--primary-purple);
        }
        .npc-pool-btn.active {
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%);
            border-color: transparent;
            color: white;
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>

        <!-- Sidebar Backdrop (for tablet overlay mode) -->
        <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

        <!-- Desktop Sidebar for DM Tool (hidden until logged in) -->
        <aside class="desktop-sidebar dm-sidebar auth-hidden" id="dm-desktop-sidebar">
            <!-- Session Info -->
            <div class="sidebar-section">
                <div class="sidebar-session-info">
                    <div class="sidebar-session-label">Campaign</div>
                    <div class="sidebar-session-value" id="dm-sidebar-campaign">No campaign loaded</div>
                </div>
                <div class="sidebar-session-info">
                    <div class="sidebar-session-label">Session</div>
                    <div class="sidebar-session-value" id="dm-sidebar-session">‚Äî</div>
                </div>
                <div class="sidebar-session-info">
                    <div class="sidebar-session-label">Status</div>
                    <div class="sidebar-session-value" id="dm-sidebar-status">Draft</div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Quick Stats</div>
                <div class="sidebar-quick-stats">
                    <div class="sidebar-stat-card">
                        <div class="sidebar-stat-value" id="dm-sidebar-players">0</div>
                        <div class="sidebar-stat-label">Players</div>
                    </div>
                    <div class="sidebar-stat-card">
                        <div class="sidebar-stat-value" id="dm-sidebar-npcs">0</div>
                        <div class="sidebar-stat-label">NPCs</div>
                    </div>
                    <div class="sidebar-stat-card">
                        <div class="sidebar-stat-value" id="dm-sidebar-encounters">0</div>
                        <div class="sidebar-stat-label">Encounters</div>
                    </div>
                    <div class="sidebar-stat-card">
                        <div class="sidebar-stat-value" id="dm-sidebar-items">0</div>
                        <div class="sidebar-stat-label">Items</div>
                    </div>
                </div>
            </div>

            <!-- Turning Points -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Turning Points</div>
                <div class="sidebar-event-log" id="dm-sidebar-turning-points">
                    <div class="sidebar-event" style="color: var(--text-muted); font-style: italic;">
                        No turning points yet
                    </div>
                </div>
            </div>

            <!-- Recent Events -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Recent Events</div>
                <div class="sidebar-event-log" id="dm-sidebar-events">
                    <div class="sidebar-event" style="color: var(--text-muted); font-style: italic;">
                        No events logged yet
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Quick Actions</div>
                <div class="sidebar-actions">
                    <button class="sidebar-action-btn" onclick="quickAddEvent()">
                        <span class="sidebar-action-icon">üìù</span>
                        <span class="sidebar-action-label">Add Event</span>
                    </button>
                    <button class="sidebar-action-btn" onclick="quickAddTurningPoint()">
                        <span class="sidebar-action-icon">‚ö°</span>
                        <span class="sidebar-action-label">Turning Pt</span>
                    </button>
                    <button class="sidebar-action-btn" onclick="saveSession()">
                        <span class="sidebar-action-icon">üíæ</span>
                        <span class="sidebar-action-label">Save</span>
                    </button>
                    <button class="sidebar-action-btn" onclick="switchToTab('during-play')">
                        <span class="sidebar-action-icon">üé≠</span>
                        <span class="sidebar-action-label">During Play</span>
                    </button>
                </div>
            </div>
        </aside>

        <div class="main-content-area dm-tool">
            <div class="container">
        <header class="header-compact">
            <div class="header-left">
                <button onclick="history.back()" class="header-back-btn" title="Go back">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                </button>
                <a href="/" class="header-logo">
                    <span class="logo-text">Aedelore</span>
                    <span class="logo-subtitle">DM Tools</span>
                </a>
            </div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <button class="mobile-menu-close" id="mobile-menu-close" onclick="toggleMobileMenu()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
            <div class="header-right" id="mobile-actions">
                <!-- Status indicator (not a dropdown) -->
                <div id="session-status-group" style="display:none;">
                    <span id="session-status" class="locked-indicator unlocked">ACTIVE</span>
                </div>

                <!-- Server Dropdown -->
                <div class="header-dropdown" id="server-group">
                    <button class="header-dropdown-trigger" onclick="toggleHeaderDropdown('server-dropdown')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
                        Server
                        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="header-dropdown-menu" id="server-dropdown">
                        <button id="server-login-btn" onclick="showAuthModal('login'); closeAllHeaderDropdowns();"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> Login</button>
                        <button id="server-logout-btn" onclick="doLogout(); closeAllHeaderDropdowns();" style="display:none;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg> Logout</button>
                        <button id="my-data-btn" onclick="showMyDataModal(); closeAllHeaderDropdowns();" style="display:none;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> My Data</button>
                        <button id="change-password-btn" onclick="showPasswordModal(); closeAllHeaderDropdowns();" style="display:none;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg> Password</button>
                        <button id="trash-btn" onclick="showDMTrashModal(); closeAllHeaderDropdowns();" style="display:none;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg> Trash</button>
                        <hr id="save-divider" style="display:none;">
                        <button id="save-btn" onclick="saveSession(); closeAllHeaderDropdowns();" style="display:none;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save</button>
                    </div>
                </div>

                <!-- Session Dropdown -->
                <div class="header-dropdown" id="lock-group" style="display:none;">
                    <button class="header-dropdown-trigger" onclick="toggleHeaderDropdown('session-dropdown')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                        Session
                        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="header-dropdown-menu" id="session-dropdown">
                        <button id="lock-btn" onclick="lockCurrentSession(); closeAllHeaderDropdowns();"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> Lock Session</button>
                        <button id="unlock-btn" onclick="unlockCurrentSession(); closeAllHeaderDropdowns();" style="display:none;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg> Unlock Session</button>
                        <hr>
                        <button id="delete-session-btn" onclick="deleteSession(); closeAllHeaderDropdowns();" style="color: #ef4444;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg> Delete Session</button>
                    </div>
                </div>

                <!-- AI Dropdown -->
                <div class="header-dropdown">
                    <button class="header-dropdown-trigger ai-trigger" onclick="toggleHeaderDropdown('ai-dropdown')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/></svg>
                        AI
                        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="header-dropdown-menu" id="ai-dropdown">
                        <button onclick="showAIExportModal(); closeAllHeaderDropdowns();"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/></svg> AI Assistant</button>
                    </div>
                </div>

                <!-- File Dropdown -->
                <div class="header-dropdown">
                    <button class="header-dropdown-trigger" onclick="toggleHeaderDropdown('file-dropdown')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                        File
                        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="header-dropdown-menu" id="file-dropdown">
                        <button onclick="showExportModal(); closeAllHeaderDropdowns();"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Export</button>
                        <button onclick="window.print(); closeAllHeaderDropdowns();"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg> Print</button>
                        <hr>
                        <button onclick="showHelpModal(); closeAllHeaderDropdowns();"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg> Help</button>
                    </div>
                </div>

                <!-- Theme Dropdown -->
                <div class="header-dropdown">
                    <button class="header-dropdown-trigger" onclick="toggleHeaderDropdown('theme-dropdown')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                        Theme
                        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="header-dropdown-menu" id="theme-dropdown">
                        <button class="theme-option" onclick="setTheme('aedelore'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #a855f7, #3b9eff);"></span> Aedelore <span class="theme-check" id="theme-check-aedelore">‚úì</span></button>
                        <button class="theme-option" onclick="setTheme('dark-glass'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #0a0a0c, #d4a537);"></span> Dark Glass <span class="theme-check" id="theme-check-dark-glass"></span></button>
                        <button class="theme-option" onclick="setTheme('midnight'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #60a0ff, #c0d8ff);"></span> Midnight Blue <span class="theme-check" id="theme-check-midnight"></span></button>
                        <button class="theme-option" onclick="setTheme('ember'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #ff2a2a, #ff6a00, #ffcc00);"></span> Ember <span class="theme-check" id="theme-check-ember"></span></button>
                        <button class="theme-option" onclick="setTheme('forest'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #10b981, #22c55e);"></span> Forest <span class="theme-check" id="theme-check-forest"></span></button>
                        <button class="theme-option" onclick="setTheme('frost'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #7dd3fc, #38bdf8);"></span> Frost <span class="theme-check" id="theme-check-frost"></span></button>
                        <button class="theme-option" onclick="setTheme('void'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #e879f9, #818cf8);"></span> Void <span class="theme-check" id="theme-check-void"></span></button>
                        <button class="theme-option" onclick="setTheme('pure-darkness'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #d4af37, #000000);"></span> Pure Darkness <span class="theme-check" id="theme-check-pure-darkness"></span></button>
                        <button class="theme-option" onclick="setTheme('blood'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #dc2626, #7c3aed);"></span> Blood <span class="theme-check" id="theme-check-blood"></span></button>
                        <button class="theme-option" onclick="setTheme('necro'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #84cc16, #65a30d);"></span> Necro <span class="theme-check" id="theme-check-necro"></span></button>
                        <button class="theme-option" onclick="setTheme('royal'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #fbbf24, #9333ea);"></span> Royal <span class="theme-check" id="theme-check-royal"></span></button>
                        <button class="theme-option" onclick="setTheme('crimson'); closeAllHeaderDropdowns();"><span class="theme-dot" style="background: linear-gradient(135deg, #be123c, #dc2626);"></span> Crimson <span class="theme-check" id="theme-check-crimson"></span></button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Login Required Message -->
        <div id="login-required" class="empty-state">
            <h3>Login Required</h3>
            <p>Please login to access the DM Session Tool.</p>
            <button class="quick-add-btn" onclick="showAuthModal('login')" style="margin-top: var(--space-4);">Login</button>
        </div>

        <!-- Dashboard (shown when logged in but no session selected) -->
        <div id="dashboard" class="dashboard" style="display:none;">
            <div class="dashboard-header">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    Your Campaigns
                </h2>
            </div>
            <div class="campaign-grid" id="campaign-grid">
                <!-- Campaign cards will be rendered here by JavaScript -->
            </div>
        </div>

        <!-- Player Campaign View (shown when viewing as a player) -->
        <div id="player-view" style="display:none;">
            <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h2 style="display: flex; align-items: center; gap: 10px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-cyan)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                    <span id="player-view-title">Campaign</span>
                </h2>
                <button onclick="closePlayerView()" style="background: var(--bg-elevated);">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    Back
                </button>
            </div>

            <div style="color: var(--text-muted); margin-bottom: var(--space-4); font-size: 0.9rem;">
                DM: <span id="player-view-dm">-</span>
            </div>

            <!-- Party Members -->
            <div id="player-party-container" style="margin-bottom: var(--space-6);">
                <h3 style="color: var(--accent-green); margin-bottom: var(--space-3); display: flex; align-items: center; gap: 8px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Party Members
                </h3>
                <div id="player-party-list">
                    <!-- Party members will be rendered here -->
                </div>
            </div>

            <!-- Sessions List -->
            <div id="player-sessions-container">
                <h3 style="color: var(--text-primary); margin-bottom: var(--space-3); display: flex; align-items: center; gap: 8px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                    Sessions
                </h3>
                <div id="player-sessions-list">
                    <!-- Sessions will be rendered here -->
                </div>
            </div>

            <!-- Current Session Summary -->
            <div id="player-summary-container" style="margin-top: var(--space-6);">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3); display: flex; align-items: center; gap: 8px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                    Latest Session Summary
                </h3>
                <div id="player-summary-content" style="background: var(--bg-elevated); border-radius: 12px; padding: var(--space-4);">
                    <!-- Summary content will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Back to Dashboard button (shown when viewing a session) -->
        <button id="back-to-dashboard" class="back-to-dashboard" style="display:none;" onclick="showDashboard()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
            Back to Campaigns
        </button>

        <!-- Session Header (shown when session is loaded) -->
        <div id="session-header" class="session-header" style="display:none;">
            <div class="session-header-top">
                <div class="session-title-group">
                    <div class="campaign-name" id="header-campaign-name">Campaign Name</div>
                    <h2>
                        Session <input type="number" id="session_number" class="editable-title" style="width: 80px; font-size: inherit;" min="1" placeholder="#">
                    </h2>
                </div>
            </div>
            <div class="session-meta">
                <div class="field-group">
                    <label>Date</label>
                    <input type="date" id="session_date">
                </div>
                <div class="field-group">
                    <label>Location</label>
                    <input type="text" id="session_location" placeholder="Where does this session take place?">
                </div>
            </div>
        </div>

        <!-- Tab Navigation (5 tabs: Players, Planning, During Play, Reference, Summary) -->
        <div class="tab-container" id="tab-container" style="display:none;">
            <div class="tab" onclick="switchTab('page-players')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                Players
            </div>
            <div class="tab active" onclick="switchTab('page-planning')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                Planning
            </div>
            <div class="tab" onclick="switchTab('page-play')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                During Play
            </div>
            <div class="tab" onclick="switchTab('page-reference')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                Reference
            </div>
            <div class="tab" onclick="switchTab('page-calculator')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="10" y2="10"/><line x1="14" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="10" y2="14"/><line x1="14" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="16" y2="18"/></svg>
                Calculator
            </div>
            <div class="tab" onclick="switchTab('page-summary'); renderSessionSummary();">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                Summary
            </div>
            <div class="tab" onclick="switchTab('page-help');">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                Help
            </div>
        </div>

        <!-- Session Content -->
        <div id="session-content" style="display:none;">

            <!-- Page: Players -->
            <div id="page-players" class="tab-content">
                <div class="section">
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            Players in this Session
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">Track which players are participating in this session.</p>
                        <div id="players-list"></div>
                        <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
                            <button class="quick-add-btn" onclick="addPlayer()">+ Add Player</button>
                            <button class="quick-add-btn" id="import-players-btn" onclick="importPlayersFromPrevious()" style="background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%); display: none;">Import from Previous Session</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Planning (Build the adventure) -->
            <div id="page-planning" class="tab-content active">
                <div class="section">

                    <!-- Hook/Goal Section -->
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            Hook / Goal
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">What is the purpose of this session? Where should the adventure lead?</p>
                        <div class="field-group">
                            <textarea id="session_hook" rows="3" placeholder="The players should discover who poisoned the well and find their way to the abandoned fortress..." onchange="sessionData.hook = this.value"></textarea>
                        </div>
                    </div>

                    <!-- Prolog Section -->
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            Session Prologue
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">Read-aloud introduction for players. Recap what happened before and set the scene.</p>
                        <div class="field-group">
                            <textarea id="session_prolog" rows="5" placeholder="Last time, our heroes ventured into the dark forest and discovered the abandoned watchtower. Now, standing at the crossroads as dawn breaks..." onchange="sessionData.prolog = this.value"></textarea>
                        </div>
                    </div>

                    <!-- Quick Add Toolbar -->
                    <div class="subsection" style="background: var(--bg-elevated); border: 1px dashed var(--border-subtle); border-radius: var(--radius-lg); padding: var(--space-4);">
                        <!-- Add new content row -->
                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-3); align-items: center; margin-bottom: var(--space-3);">
                            <span style="font-size: 0.85rem; color: var(--text-secondary);">Add to:</span>
                            <select id="planning-default-day" style="padding: 6px 10px; font-size: 0.85rem; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base);">
                                <option value="">No day</option>
                                <option value="1">Day 1</option>
                                <option value="2">Day 2</option>
                                <option value="3">Day 3</option>
                                <option value="4">Day 4</option>
                                <option value="5">Day 5</option>
                            </select>
                            <select id="planning-default-time" style="padding: 6px 10px; font-size: 0.85rem; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base);">
                                <option value="">No time</option>
                                <option value="dawn">üåÖ Dawn</option>
                                <option value="morning">‚òÄÔ∏è Morning</option>
                                <option value="noon">üåû Noon</option>
                                <option value="afternoon">üå§Ô∏è Afternoon</option>
                                <option value="dusk">üåÜ Dusk</option>
                                <option value="evening">üåô Evening</option>
                                <option value="night">üåë Night</option>
                            </select>
                            <select id="planning-default-place" style="padding: 6px 10px; font-size: 0.85rem; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base); max-width: 150px;">
                                <option value="">No place</option>
                            </select>
                        </div>
                        <!-- Add buttons -->
                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-2); margin-bottom: var(--space-3);">
                            <button class="quick-add-btn" onclick="addPlaceWithDay()" style="background: var(--accent-cyan-20); color: var(--accent-cyan);">+ Place</button>
                            <button class="quick-add-btn" onclick="addEncounterWithDay()" style="background: var(--accent-red-20); color: var(--accent-red);">+ Encounter</button>
                            <button class="quick-add-btn" onclick="addReadAloudWithDay()" style="background: var(--accent-purple-20); color: var(--accent-purple);">+ Read-Aloud</button>
                            <button class="quick-add-btn" onclick="addNPCWithDay()" style="background: var(--primary-blue-20); color: var(--primary-blue);">+ NPC</button>
                            <button class="quick-add-btn" onclick="addItemWithDay()" style="background: var(--accent-gold-20); color: var(--accent-gold);">+ Item/Clue</button>
                        </div>
                        <!-- Filter row -->
                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-2); align-items: center; padding-top: var(--space-3); border-top: 1px solid var(--border-subtle);">
                            <span style="font-size: 0.85rem; color: var(--text-secondary);">Show:</span>
                            <select id="planning-day-filter" onchange="renderPlanningByDay()" style="padding: 6px 10px; font-size: 0.85rem; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base);">
                                <option value="all">All Days</option>
                            </select>
                            <div style="margin-left: auto;">
                                <button onclick="clearAllPlanning()" style="padding: 6px 12px; font-size: 0.8rem; background: var(--bg-surface); border: 1px solid var(--accent-red); border-radius: var(--radius-sm); color: var(--accent-red); cursor: pointer;">Clear All Planning</button>
                            </div>
                        </div>
                        <!-- NPC Name Generator (collapsible) -->
                        <details style="margin-top: var(--space-3);">
                            <summary style="cursor: pointer; font-size: 0.85rem; color: var(--text-secondary);">NPC Name Generator</summary>
                            <div style="display: flex; flex-wrap: wrap; gap: var(--space-2); align-items: center; margin-top: var(--space-2);">
                                <select id="npc-gen-race" style="padding: 6px 10px; font-size: 0.85rem; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base);">
                                    <option value="Human">Human</option>
                                    <option value="Dwarf">Dwarf</option>
                                    <option value="Halfling">Halfling</option>
                                    <option value="High Elf">High Elf</option>
                                    <option value="Moon Elf">Moon Elf</option>
                                    <option value="Orc">Orc</option>
                                    <option value="Troll">Troll</option>
                                </select>
                                <select id="npc-gen-gender" style="padding: 6px 10px; font-size: 0.85rem; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base);">
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                                <button onclick="generateAndAddNPCWithDay()" style="padding: 6px 14px; font-size: 0.85rem; background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%); color: white; border: none; border-radius: var(--radius-sm); cursor: pointer; font-weight: 500;">Generate NPC</button>
                                <span id="npc-gen-preview" style="flex: 1; font-size: 0.9rem; color: var(--accent-gold); font-style: italic; min-width: 150px;"></span>
                            </div>
                        </details>
                    </div>

                    <!-- Day-based Planning Timeline -->
                    <div id="planning-timeline-container"></div>

                    <!-- Hidden containers for legacy render functions -->
                    <div id="places-list" style="display: none;"></div>
                    <div id="encounters-list" style="display: none;"></div>
                    <div id="read-aloud-list" style="display: none;"></div>
                    <div id="npcs-list" style="display: none;"></div>
                    <div id="items-list" style="display: none;"></div>
                </div>
            </div>

            <!-- Page: During Play (Live session view) -->
            <div id="page-play" class="tab-content">
                <div class="section">

                    <!-- Goal reminder -->
                    <div class="hook-reminder" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(59, 158, 255, 0.1) 100%); border: 1px solid var(--border-purple); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-4);">
                        <h4 style="margin: 0 0 var(--space-2) 0; color: var(--accent-purple); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em;">Session Goal</h4>
                        <p id="play-hook-display" style="margin: 0; color: var(--text-base); font-style: italic;">No goal set</p>
                    </div>

                    <!-- Prolog display (read-only) -->
                    <div id="play-prolog-container" class="prolog-display" style="display: none; background: linear-gradient(135deg, rgba(59, 158, 255, 0.1) 0%, rgba(99, 102, 241, 0.15) 100%); border: 1px solid var(--border-default); border-left: 4px solid var(--primary-blue); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-4);">
                        <h4 style="margin: 0 0 var(--space-3) 0; color: var(--primary-blue); font-size: 0.9rem; display: flex; align-items: center; gap: var(--space-2);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            Session Prologue
                        </h4>
                        <p id="play-prolog-text" style="margin: 0; color: var(--text-base); font-style: italic; white-space: pre-wrap; line-height: 1.6;">No prologue set</p>
                    </div>

                    <!-- Day-based Timeline -->
                    <div class="subsection">
                        <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                            <h3 class="subsection-title" style="margin-bottom: 0;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                                Session Timeline
                            </h3>
                            <div style="display: flex; gap: var(--space-2); align-items: center;">
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">Show:</span>
                                <select id="play-day-filter" onchange="renderDayTimeline()" style="padding: 6px 10px; font-size: 0.85rem; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base);">
                                    <option value="all">All Days</option>
                                </select>
                            </div>
                        </div>
                        <div id="day-timeline-container"></div>
                    </div>

                    <!-- Turning Points -->
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                            Turning Points
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">Record key decisions and important moments as they happen.</p>
                        <div id="turning-points-list"></div>
                        <button class="quick-add-btn" onclick="addTurningPoint()">+ Add Turning Point</button>
                    </div>

                    <!-- Event Log -->
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            Event Log
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">Quick notes about what's happening in the session.</p>
                        <div id="event-log-list"></div>
                        <div style="display: flex; gap: var(--space-2); align-items: center;">
                            <input type="text" id="new-event-input" placeholder="What just happened?" style="flex: 1;" onkeydown="if(event.key === 'Enter') addEventLog()">
                            <button class="quick-add-btn" onclick="addEventLog()" style="margin-top: 0;">+ Add</button>
                        </div>
                    </div>

                    <!-- Session Notes -->
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            Session Notes
                        </h3>
                        <div class="field-group">
                            <label style="color: var(--text-subdued);">Session Summary</label>
                            <textarea id="notes_summary" rows="3" placeholder="Brief summary of what happened this session..." onchange="sessionData.sessionNotes.summary = this.value"></textarea>
                        </div>
                        <div class="grid grid-2" style="margin-top: var(--space-3);">
                            <div class="field-group">
                                <label style="color: var(--accent-green);">What went well</label>
                                <textarea id="notes_went_well" rows="2" placeholder="What worked great?" onchange="sessionData.sessionNotes.wentWell = this.value"></textarea>
                            </div>
                            <div class="field-group">
                                <label style="color: var(--accent-red);">What to improve</label>
                                <textarea id="notes_improve" rows="2" placeholder="What could be better?" onchange="sessionData.sessionNotes.improve = this.value"></textarea>
                            </div>
                        </div>
                        <div class="field-group" style="margin-top: var(--space-3);">
                            <label style="color: var(--primary-purple);">Follow up next session</label>
                            <textarea id="notes_followup" rows="3" placeholder="What needs to happen next?" onchange="sessionData.sessionNotes.followUp = this.value"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Reference (Rules, Weapons, Armor, Spells, DM Tools) -->
            <div id="page-reference" class="tab-content">
                <div class="section">

                    <!-- DM Cheat Sheet - Quick Reference -->
                    <div class="ref-accordion open" onclick="toggleAccordion(this)">
                        <div class="ref-accordion-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                                DM Cheat Sheet
                            </h3>
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="ref-accordion-content">
                            <div class="ref-quick-grid">
                                <div class="ref-quick-card">
                                    <h5>Dice Roll Results</h5>
                                    <p><strong>1-4:</strong> Failure<br><strong>5-6:</strong> Barely succeeds<br><strong>7-9:</strong> Full success<br><strong>10:</strong> Critical (reroll, add!)</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Attack Results</h5>
                                    <p><strong>0 success:</strong> Miss<br><strong>1 success:</strong> Glancing (50% dmg)<br><strong>2+ success:</strong> Full damage</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Initiative</h5>
                                    <p><strong>‚â§6 fighters:</strong> Roll 1D6<br><strong>>6 fighters:</strong> Roll 1D10<br>Higher = goes first<br>Tie = DM decides</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Difficulty (Successes)</h5>
                                    <p><strong>Trivial:</strong> 1 &nbsp; <strong>Easy:</strong> 2<br><strong>Normal:</strong> 3 &nbsp; <strong>Hard:</strong> 4<br><strong>Very Hard:</strong> 5<br><strong>Impossible:</strong> 6+</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Rest & Healing</h5>
                                    <p><strong>Short (1h):</strong> +1D6 HP, +1 Weak<br><strong>Long (8h):</strong> Full HP & Weak<br><strong>Medicine:</strong> 1 succ = +1D6 HP</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Arcana Regen</h5>
                                    <p><strong>In combat:</strong> +1/round<br><strong>Resting:</strong> +2/rest<br><strong>Mage max:</strong> 20<br><strong>Druid max:</strong> 16</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Weakened at 0</h5>
                                    <p>Roll 1D10 + Toughness:<br><strong>1-2:</strong> Death<br><strong>3-5:</strong> Faint<br><strong>6-10:</strong> Move only</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>HP at 0 (Dying)</h5>
                                    <p>Roll 1D10 + Toughness:<br><strong>1-2:</strong> Death<br><strong>3-4:</strong> Dying (needs help)<br><strong>5-6:</strong> Faint<br><strong>7+:</strong> Conscious</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Bleeding</h5>
                                    <p>Roll 1D6 per turn:<br><strong>1-2:</strong> Lose 3 HP<br><strong>3-4:</strong> Lose 2 HP<br><strong>5-6:</strong> Lose 1 HP</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Stop Bleeding</h5>
                                    <p><strong>Medicine:</strong> 1 succ/Bleed lvl<br><strong>Bandage:</strong> Stops Bleed 1<br><strong>Healing magic:</strong> Stops all</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Assistance</h5>
                                    <p>Give up your action:<br>Ally gets <strong>+1D10</strong><br>Must be narratively justified<br>Max 1 assist/round</p>
                                </div>
                                <div class="ref-quick-card">
                                    <h5>Potions</h5>
                                    <p><strong>Adrenaline:</strong> +2D10 next action<br><strong>Antidote:</strong> Cure poison<br><strong>Healing:</strong> +1D10 HP<br><strong>Arcane Elixir:</strong> +10 Arcana</p>
                                </div>
                                <div class="ref-quick-card" style="grid-column: span 2;">
                                    <h5>Worthiness</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px 16px; font-size: 0.8rem; color: var(--text-secondary);">
                                        <span><strong>+10:</strong> Esteemed</span><span><strong>+9:</strong> Trustworthy</span>
                                        <span><strong>+7/8:</strong> Respected</span><span><strong>+5/6:</strong> Ordinary</span>
                                        <span><strong>+3/4:</strong> Watched</span><span><strong>+1/2:</strong> Stranger</span>
                                        <span><strong>0:</strong> Unremarkable</span><span><strong>-1/2:</strong> Distrusted</span>
                                        <span><strong>-3/5:</strong> Bad Rep</span><span><strong>-6/8:</strong> Notorious</span>
                                        <span><strong>-9:</strong> Hunted</span><span><strong>-10:</strong> Public Enemy</span>
                                    </div>
                                </div>
                            </div>

                            <div class="ref-subsection">
                                <h4>Points to Dice</h4>
                                <table class="ref-table">
                                    <tr><th>Points</th><th>Dice</th><th>Points</th><th>Dice</th></tr>
                                    <tr><td>1-2</td><td class="num">1D10</td><td>7-8</td><td class="num">4D10</td></tr>
                                    <tr><td>3-4</td><td class="num">2D10</td><td>9-10</td><td class="num">5D10</td></tr>
                                    <tr><td>5-6</td><td class="num">3D10</td><td>11+</td><td class="num">6D10</td></tr>
                                </table>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: var(--space-2);"><strong>Max 8 dice</strong> per action unless class ability says otherwise.</p>
                            </div>

                            <div class="ref-subsection">
                                <h4>Defense Options (choose one when attacked)</h4>
                                <table class="ref-table">
                                    <tr><th>Defense</th><th>Dice Pool</th><th>2+ Success</th><th>1 Success</th><th>0 Success</th></tr>
                                    <tr><td><strong>Block</strong></td><td>STR + Shield Block</td><td>Shield HP (50%)</td><td>Shield absorbs ‚Üí Shield HP</td><td>Armor HP</td></tr>
                                    <tr><td><strong>Dodge</strong></td><td>AGI or Acrobatics</td><td>No damage</td><td>Half ‚Üí Armor HP</td><td>Full ‚Üí Armor HP</td></tr>
                                    <tr><td><strong>Parry</strong></td><td>Weapon Atk Bonus + STR</td><td>No damage</td><td>Half ‚Üí Armor HP</td><td>Full ‚Üí Armor HP</td></tr>
                                    <tr><td><strong>Take Hit</strong></td><td>Toughness + Armor Block</td><td>Minimal damage</td><td>Absorbs ‚Üí Armor HP</td><td>Full + Stun</td></tr>
                                </table>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: var(--space-2);"><strong>Equipment HP = 0?</strong> Destroyed. Remaining damage ‚Üí Character HP. <strong>DM rec:</strong> Equipment takes 50% of attack damage.</p>
                            </div>

                            <div class="ref-subsection">
                                <h4>Status Effects</h4>
                                <table class="ref-table">
                                    <tr><th>Status</th><th>Effect</th></tr>
                                    <tr><td><strong>Poisoned</strong></td><td>-1D10 all rolls, 1 dmg/round</td></tr>
                                    <tr><td><strong>Stunned</strong></td><td>Cannot act this round</td></tr>
                                    <tr><td><strong>Blinded</strong></td><td>-2D10 attacks & perception</td></tr>
                                    <tr><td><strong>Deafened</strong></td><td>Cannot hear, -1D10 perception</td></tr>
                                    <tr><td><strong>Frightened</strong></td><td>Cannot approach source, -1D10 attacks</td></tr>
                                    <tr><td><strong>Prone</strong></td><td>-1D10 attacks, enemies +1D10 melee</td></tr>
                                </table>
                            </div>

                            <div class="ref-subsection">
                                <h4>Combat Flow</h4>
                                <p style="margin-bottom: 10px;">
                                    <strong>1. Initiative:</strong> Everyone rolls (D6 or D10), highest goes first<br>
                                    <strong>2. Attacker's Turn:</strong> Roll Core Ability + Weapon Attack Bonus (convert to dice)<br>
                                    <strong>3. Defender Chooses:</strong> Block, Dodge, Parry, Take Hit, or Special Maneuver<br>
                                    <strong>4. Defense Roll:</strong> Count successes (2+ = full, 1 = partial, 0 = fail)<br>
                                    <strong>5. Damage:</strong> Apply to Shield HP ‚Üí Armor HP ‚Üí Character HP<br>
                                    <strong>6. Body Part:</strong> On armor damage, DM chooses: Hand, Leg, Chest, Shoulders, Head<br>
                                    <strong>7. Next Turn:</strong> Next in initiative order
                                </p>
                                <p style="font-size: 0.8rem; color: var(--accent-purple); margin-top: var(--space-2);"><strong>Special Maneuver:</strong> Player describes action, DM decides pool and difficulty.</p>
                            </div>

                            <div class="ref-subsection">
                                <h4>Defense Examples - Step by Step</h4>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>BLOCK Example (with Shield)</h5>
                                    <p style="margin-bottom: 8px;"><em>Enemy attacks for 12 damage. You have Str 4, Metal Shield (Block 5, HP 20).</em></p>
                                    <p>
                                        <strong>1.</strong> Build pool: Str 4 (2D10) + Shield Block 5 (3D10) = <strong>5D10</strong><br>
                                        <strong>2.</strong> Roll 5D10, count successes (8+ = success)<br>
                                        <strong>3.</strong> Results:<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>2+ successes:</strong> Full block - Shield HP takes 6 damage (50%)<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>1 success:</strong> Shield absorbs 5, Shield HP takes 7 damage<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>0 successes:</strong> Miss - Armor HP takes 12 damage (DM picks body part)
                                    </p>
                                </div>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>DODGE Example</h5>
                                    <p style="margin-bottom: 8px;"><em>Enemy attacks for 12 damage. You have Agility 5, Acrobatics 3.</em></p>
                                    <p>
                                        <strong>1.</strong> Build pool: Use higher of Agility (5) or Acrobatics (3) = <strong>3D10</strong><br>
                                        <strong>2.</strong> Roll 3D10, count successes (8+ = success)<br>
                                        <strong>3.</strong> Results:<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>2+ successes:</strong> Full dodge - no damage<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>1 success:</strong> Partial - Armor HP takes 6 damage (half)<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>0 successes:</strong> Fail - Armor HP takes 12 damage (DM picks body part)
                                    </p>
                                </div>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>PARRY Example</h5>
                                    <p style="margin-bottom: 8px;"><em>Enemy attacks for 12 damage. You have Swords 4, Str 5.</em></p>
                                    <p>
                                        <strong>1.</strong> Build pool: Swords 4 (2D10) + Str 5 (3D10) = <strong>5D10</strong><br>
                                        <strong>2.</strong> Roll 5D10, count successes (8+ = success)<br>
                                        <strong>3.</strong> Results:<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>2+ successes:</strong> Full parry - no damage<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>1 success:</strong> Partial - Armor HP takes 6 damage (half)<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>0 successes:</strong> Fail - Armor HP takes 12 damage (DM picks body part)
                                    </p>
                                </div>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>TAKE HIT Example (with Armor)</h5>
                                    <p style="margin-bottom: 8px;"><em>Enemy attacks for 12 damage. You have Toughness 3, Chainmail (Block 4, HP 30).</em></p>
                                    <p>
                                        <strong>1.</strong> Build pool: Toughness 3 (2D10) + Armor Block 4 (2D10) = <strong>4D10</strong><br>
                                        <strong>2.</strong> Roll 4D10, count successes (8+ = success)<br>
                                        <strong>3.</strong> Results:<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>2+ successes:</strong> Full control - minimal damage to Armor HP<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>1 success:</strong> Armor absorbs 4, Armor HP takes 8 damage<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>0 successes:</strong> Fail - Armor HP takes 12 damage + Stun/Knockback
                                    </p>
                                </div>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>Stun/Knockback Effects (on Take Hit fail)</h5>
                                    <p>
                                        <strong>Stun:</strong> Lose next action<br>
                                        <strong>Knockback:</strong> Pushed back 1-2 meters<br>
                                        <strong>Disarm:</strong> Drop weapon (hit on hand)<br>
                                        <strong>Prone:</strong> Fall to ground (hit on leg)<br>
                                        <strong>Dazed:</strong> -1D10 on next roll
                                    </p>
                                </div>

                                <div class="ref-rule-box">
                                    <h5>When to Use Each Defense</h5>
                                    <p>
                                        <strong>Block:</strong> Have a shield? Protects armor, but shield wears down.<br>
                                        <strong>Dodge:</strong> High Agility/Acrobatics? Best chance for zero damage.<br>
                                        <strong>Parry:</strong> High Weapon Skill + Strength? Good for fighters.<br>
                                        <strong>Take Hit:</strong> High Toughness + Armor Block? Reliable but risky on fail.<br>
                                        <strong>Special:</strong> Want to do something creative? Tell DM, they decide the roll.
                                    </p>
                                </div>
                            </div>

                            <div class="ref-subsection">
                                <h4>Attack - Step by Step</h4>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>MELEE ATTACK Example</h5>
                                    <p style="margin-bottom: 8px;"><em>You attack with Greatsword. You have Str 5. Greatsword: +3 atk, 2D6 dmg.</em></p>
                                    <p>
                                        <strong>Step 1 - Build ATTACK POOL:</strong><br>
                                        &nbsp;&nbsp;Str 5 (3D10) + Weapon Atk +3 (2D10) = <strong>5D10</strong><br><br>
                                        <strong>Step 2 - Roll ATTACK (to see if you hit):</strong><br>
                                        &nbsp;&nbsp;Roll 5D10: 3, 7, 9, 4, 8 = <strong>3 successes</strong><br><br>
                                        <strong>Step 3 - Check HIT result:</strong><br>
                                        &nbsp;&nbsp;‚Ä¢ 0 success = Miss (stop here, no damage)<br>
                                        &nbsp;&nbsp;‚Ä¢ 1 success = Glancing hit (roll damage, then halve it)<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>2+ success = Full hit!</strong> (roll full damage)<br><br>
                                        <strong>Step 4 - Roll WEAPON DAMAGE (separate roll!):</strong><br>
                                        &nbsp;&nbsp;Greatsword = 2D6 ‚Üí Roll: 4 + 5 = <strong>9 damage</strong>
                                    </p>
                                </div>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>GLANCING HIT Example</h5>
                                    <p style="margin-bottom: 8px;"><em>Same attack, but only 1 success on attack roll.</em></p>
                                    <p>
                                        <strong>Step 1-2:</strong> Attack pool 5D10 ‚Üí Roll: 3, 6, 4, 2, 5 = <strong>1 success</strong> (barely)<br><br>
                                        <strong>Step 3:</strong> 1 success = Glancing hit ‚Üí damage is <strong>halved</strong><br><br>
                                        <strong>Step 4:</strong> Roll weapon damage: 2D6 = 4 + 5 = 9<br>
                                        &nbsp;&nbsp;Halved: 9 √∑ 2 = <strong>4 damage</strong> (round down)
                                    </p>
                                </div>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>RANGED ATTACK Example</h5>
                                    <p style="margin-bottom: 8px;"><em>You shoot with Longbow. You have Dex 4. Longbow: +2 atk, 1D10 dmg.</em></p>
                                    <p>
                                        <strong>Step 1 - Build ATTACK POOL:</strong><br>
                                        &nbsp;&nbsp;Dex 4 (2D10) + Weapon Atk +2 (1D10) = <strong>3D10</strong><br><br>
                                        <strong>Step 2 - Roll ATTACK (to see if you hit):</strong><br>
                                        &nbsp;&nbsp;Roll 3D10: 8, 5, 10 = 2 successes + critical!<br>
                                        &nbsp;&nbsp;Critical 10: Reroll that die ‚Üí 6 = +1 barely success<br>
                                        &nbsp;&nbsp;Total: <strong>3 successes = Full hit!</strong><br><br>
                                        <strong>Step 3 - Check HIT result:</strong><br>
                                        &nbsp;&nbsp;‚Ä¢ 0 success = Miss (stop here, no damage)<br>
                                        &nbsp;&nbsp;‚Ä¢ 1 success = Glancing hit (roll damage, then halve it)<br>
                                        &nbsp;&nbsp;‚Ä¢ <strong>2+ success = Full hit!</strong> (roll full damage)<br><br>
                                        <strong>Step 4 - Roll WEAPON DAMAGE (separate roll!):</strong><br>
                                        &nbsp;&nbsp;Longbow = 1D10 ‚Üí Roll: 8 = <strong>8 damage</strong><br>
                                        &nbsp;&nbsp;<em>(DM may add bonus effect for the critical)</em>
                                    </p>
                                </div>

                                <div class="ref-rule-box">
                                    <h5>Which Ability for Which Weapon?</h5>
                                    <p>
                                        <strong>STRENGTH:</strong> Most melee (Longsword, Axe, Mace, Spear, Hammer), Heavy Crossbow<br>
                                        <strong>DEXTERITY:</strong> Dagger, Rapier, Scimitar, Shortsword, Whip, all Bows, Light Crossbow<br>
                                        <strong>STR or DEX:</strong> Katana (player's choice)
                                    </p>
                                </div>
                            </div>

                            <div class="ref-subsection">
                                <h4>Spellcasting - Step by Step</h4>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>MAGE SPELL Example</h5>
                                    <p style="margin-bottom: 8px;"><em>You cast Fireball. You have Arcana 4. Fireball costs 1 Arcana, deals 2D6.</em></p>
                                    <p>
                                        <strong>1.</strong> Check if you have enough Arcana: Need 1, have 10 ‚úì<br>
                                        <strong>2.</strong> Roll spell check: 1D10 per Arcana point = <strong>4D10</strong><br>
                                        <strong>3.</strong> Roll: 2, 7, 8, 4 = 2 successes (need at least 1)<br>
                                        <strong>4.</strong> Spell succeeds! Pay cost: 10 - 1 = <strong>9 Arcana left</strong><br>
                                        <strong>5.</strong> Roll damage: 2D6 = 4 + 5 = <strong>9 damage</strong>
                                    </p>
                                    <p style="margin-top: 8px; color: var(--accent-gold);"><strong>Critical (10):</strong> DM decides bonus - more damage, wider area, etc.</p>
                                </div>

                                <div class="ref-rule-box">
                                    <h5>DRUID SPELL Example</h5>
                                    <p style="margin-bottom: 8px;"><em>You cast Mending (heal). You have Nature 3. Costs 3 Arcana, heals 1D10.</em></p>
                                    <p>
                                        <strong>1.</strong> Check Arcana: Need 3, have 8 ‚úì<br>
                                        <strong>2.</strong> Roll spell check: 1D10 per Nature point = <strong>3D10</strong><br>
                                        <strong>3.</strong> Roll: 6, 9, 3 = 2 successes ‚úì<br>
                                        <strong>4.</strong> Pay cost: 8 - 3 = <strong>5 Arcana left</strong><br>
                                        <strong>5.</strong> Roll healing: 1D10 = 7 ‚Üí <strong>Target heals 7 HP</strong>
                                    </p>
                                </div>
                            </div>

                            <div class="ref-subsection">
                                <h4>Class Abilities - Step by Step</h4>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>MELEE ABILITY Example (Warrior's Last Stand)</h5>
                                    <p style="margin-bottom: 8px;"><em>Last Stand: Check Armor, Weak cost 2, Gain 2D10. You have Armor Block 4.</em></p>
                                    <p>
                                        <strong>1.</strong> Check if you have enough Weakened: Need 2, have 4 ‚úì<br>
                                        <strong>2.</strong> Roll ability check: Armor Block 4 = <strong>2D10</strong><br>
                                        <strong>3.</strong> Roll: 7, 9 = 2 successes ‚úì (need at least 1)<br>
                                        <strong>4.</strong> Pay Weakened cost: 4 - 2 = <strong>2 Weakened left</strong><br>
                                        <strong>5.</strong> Gain bonus: <strong>+2D10</strong> on your next combat action!
                                    </p>
                                </div>

                                <div class="ref-rule-box">
                                    <h5>THIEF ABILITY Example (Sneaking)</h5>
                                    <p style="margin-bottom: 8px;"><em>Sneaking: Check Stealth, Weak cost 2, Gain 3D10. You have Stealth 5.</em></p>
                                    <p>
                                        <strong>1.</strong> Check Weakened: Need 2, have 6 ‚úì<br>
                                        <strong>2.</strong> Roll ability check: Stealth 5 = <strong>3D10</strong><br>
                                        <strong>3.</strong> Roll: 8, 6, 10 = 3 successes ‚úì<br>
                                        <strong>4.</strong> Pay cost: 6 - 2 = <strong>4 Weakened left</strong><br>
                                        <strong>5.</strong> Gain: <strong>+3D10</strong> on your stealth action!
                                    </p>
                                </div>
                            </div>

                            <div class="ref-subsection">
                                <h4>Skill Checks - Step by Step</h4>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>SIMPLE CHECK Example</h5>
                                    <p style="margin-bottom: 8px;"><em>Climb a wall. DM says: "Athletics check, Normal difficulty (3 successes)."</em></p>
                                    <p>
                                        <strong>1.</strong> You have Strength 4, Athletics 3<br>
                                        <strong>2.</strong> Build pool: Str 4 (2D10) + Athletics 3 (2D10) = <strong>4D10</strong><br>
                                        <strong>3.</strong> Roll: 5, 8, 7, 9 = 3 successes<br>
                                        <strong>4.</strong> Need 3, got 3 = <strong>Success!</strong> You climb the wall.
                                    </p>
                                </div>

                                <div class="ref-rule-box" style="margin-bottom: 12px;">
                                    <h5>CONTESTED CHECK Example</h5>
                                    <p style="margin-bottom: 8px;"><em>Arm wrestling. Both roll Strength. Highest successes wins.</em></p>
                                    <p>
                                        <strong>You:</strong> Str 5 = 3D10 ‚Üí Roll: 7, 9, 4 = 2 successes<br>
                                        <strong>Opponent:</strong> Str 4 = 2D10 ‚Üí Roll: 8, 10 (reroll: 6) = 3 successes<br>
                                        <strong>Result:</strong> Opponent wins 3 vs 2!<br>
                                        <em>On tie: DM decides (usually defender wins)</em>
                                    </p>
                                </div>

                                <div class="ref-rule-box">
                                    <h5>CRITICAL ROLL (10) - How It Works</h5>
                                    <p>
                                        <strong>1.</strong> Roll a 10 ‚Üí Count as SUCCESS<br>
                                        <strong>2.</strong> Reroll that die<br>
                                        <strong>3.</strong> Add the new result (5-6 barely, 7-9 success, 10 crit again)<br>
                                        <strong>4.</strong> If 10 again ‚Üí keep rerolling!<br><br>
                                        <em>Example: Roll 10 ‚Üí reroll 10 ‚Üí reroll 8 = 3 successes from one die!</em>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rules -->
                    <div class="ref-accordion" onclick="toggleAccordion(this)">
                        <div class="ref-accordion-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                                Rules
                            </h3>
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="ref-accordion-content">
                            <div class="ref-rule-box">
                                <h5>Combat Flow</h5>
                                <p><strong>1. Initiative:</strong> Roll D6 (D10 if 6+ players)<br>
                                <strong>2. Attack:</strong> Roll Core Ability + weapon atk bonus (max 8 dice)<br>
                                <strong>3. Defense:</strong> Target chooses dodge/parry/block/take hit<br>
                                <strong>4. Damage:</strong> Roll 1D10 + weapon damage bonus</p>
                            </div>
                            <div class="ref-rule-box">
                                <h5>Spellcasting</h5>
                                <p>Roll 1D10 per point in Arcana/Nature. Need minimum 1 success. Pay Arcana cost. Critical success (10) amplifies effect at DM discretion.</p>
                            </div>
                            <div class="ref-rule-box">
                                <h5>Assistance</h5>
                                <p>Forfeit your turn to grant an ally <strong>+1D10</strong> for one related roll. Must be narratively justified. One assist per round per character.</p>
                            </div>
                            <div class="ref-rule-box">
                                <h5>Food & Water</h5>
                                <p>Roll 1D10 daily: <strong>6-10:</strong> maintain supplies, <strong>1-5:</strong> reduce to 1D6. If D6 rolls 3 or below = one day before hunger damage.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Melee Abilities -->
                    <div class="ref-accordion" onclick="toggleAccordion(this)">
                        <div class="ref-accordion-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="M13 19l6-6"/><path d="M16 16l4 4"/></svg>
                                Melee Abilities
                            </h3>
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="ref-accordion-content">
                            <div class="ref-subsection">
                                <h4>Thief</h4>
                                <table class="ref-table">
                                    <tr><th>Ability</th><th>Check</th><th>Weak</th><th>Gain</th><th>Condition</th></tr>
                                    <tr><td>Lockpicking</td><td>Sleight of Hand</td><td class="num">1</td><td>4D10</td><td>Not in battle</td></tr>
                                    <tr><td>Sneaking</td><td>Stealth</td><td class="num">2</td><td>3D10</td><td>Not in battle</td></tr>
                                    <tr><td>Awareness</td><td>Perception</td><td class="num">4</td><td>4D10</td><td>Not in battle</td></tr>
                                    <tr><td>Vanish</td><td>Stealth</td><td class="num">4</td><td>4D10</td><td>Not in battle</td></tr>
                                    <tr><td>Footloose</td><td>Dexterity</td><td class="num">5</td><td>3D10</td><td>Not in battle</td></tr>
                                    <tr><td>Fixed Mind</td><td>Deception</td><td class="num">2</td><td>4D10</td><td>Not in battle</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Warrior</h4>
                                <table class="ref-table">
                                    <tr><th>Ability</th><th>Check</th><th>Weak</th><th>Gain</th><th>Condition</th></tr>
                                    <tr><td>Last Stand</td><td>Armor</td><td class="num">2</td><td>2D10</td><td>‚Äî</td></tr>
                                    <tr><td>Hero Worthiness</td><td>‚Äî</td><td class="num">0</td><td>Passive</td><td>‚Äî</td></tr>
                                    <tr><td>Me First</td><td>Athletics</td><td class="num">3</td><td>+1 Init</td><td>1 round</td></tr>
                                    <tr><td>Ultimate Sacrifice</td><td>Strength</td><td class="num">3</td><td>2D10</td><td>You take 2 dmg</td></tr>
                                    <tr><td>Paladin's Sacrifice</td><td>Strength</td><td class="num">3</td><td>4D10</td><td>You faint after</td></tr>
                                    <tr><td>Crusader</td><td>Armor</td><td class="num">3</td><td>2D10</td><td>1 round</td></tr>
                                    <tr><td>Give In</td><td>Strength</td><td class="num">4</td><td>4D10</td><td>Lose control</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Hunter</h4>
                                <table class="ref-table">
                                    <tr><th>Ability</th><th>Check</th><th>Weak</th><th>Gain</th><th>Condition</th></tr>
                                    <tr><td>Steady Shot</td><td>Dexterity</td><td class="num">2</td><td>3D10</td><td>‚Äî</td></tr>
                                    <tr><td>Tame a Beast</td><td>Animal Handling</td><td class="num">5</td><td>5D10</td><td>Not in battle</td></tr>
                                    <tr><td>Unveil Path</td><td>Survival</td><td class="num">2</td><td>2D10</td><td>Not in battle</td></tr>
                                    <tr><td>Set Trap</td><td>Nature</td><td class="num">3</td><td>3D10</td><td>Not in battle</td></tr>
                                    <tr><td>Shadow Meld</td><td>Stealth</td><td class="num">4</td><td>4D10</td><td>Not in battle</td></tr>
                                    <tr><td>Spider Senses</td><td>Perception</td><td class="num">2</td><td>2D10</td><td>Not in battle</td></tr>
                                    <tr><td>Rain of Death</td><td>Dexterity</td><td class="num">3</td><td>4D10</td><td>‚Äî</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Outcast</h4>
                                <table class="ref-table">
                                    <tr><th>Ability</th><th>Check</th><th>Weak</th><th>Gain</th><th>Condition</th></tr>
                                    <tr><td>Shadow Step</td><td>Stealth</td><td class="num">3</td><td>3D10</td><td>Not in battle</td></tr>
                                    <tr><td>Wilderness Survival</td><td>Nature</td><td class="num">2</td><td>3D10</td><td>Not in battle</td></tr>
                                    <tr><td>Street Smarts</td><td>Investigation</td><td class="num">2</td><td>2D10</td><td>Not in battle</td></tr>
                                    <tr><td>Unseen Ally</td><td>Nature</td><td class="num">2</td><td>3D10</td><td>Not in battle</td></tr>
                                    <tr><td>Improvised Weaponry</td><td>Strength</td><td class="num">3</td><td>3D10</td><td>‚Äî</td></tr>
                                    <tr><td>Resilient Spirit</td><td>Toughness</td><td class="num">3</td><td>3D10</td><td>‚Äî</td></tr>
                                    <tr><td>Counterculture</td><td>Investigation</td><td class="num">2</td><td>2D10</td><td>‚Äî</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Weapons -->
                    <div class="ref-accordion" onclick="toggleAccordion(this)">
                        <div class="ref-accordion-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/></svg>
                                Weapons
                            </h3>
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="ref-accordion-content">
                            <div class="ref-subsection">
                                <h4>Simple Melee</h4>
                                <table class="ref-table">
                                    <tr><th>Weapon</th><th>Ability</th><th>Atk</th><th>Dmg</th><th>Range</th><th>Cost</th></tr>
                                    <tr><td>Club</td><td>Str</td><td class="num">+1</td><td>1d4</td><td class="num">1</td><td>1 sp</td></tr>
                                    <tr><td>Dagger</td><td>Dex</td><td class="num">+1</td><td>1d4</td><td class="num">1</td><td>2 gp</td></tr>
                                    <tr><td>Greatclub</td><td>Str</td><td class="num">+2</td><td>1d8</td><td class="num">2</td><td>2 sp</td></tr>
                                    <tr><td>Handaxe</td><td>Str</td><td class="num">+1</td><td>1d6</td><td class="num">1</td><td>5 gp</td></tr>
                                    <tr><td>Javelin</td><td>Str</td><td class="num">+1</td><td>1d6</td><td>3/10</td><td>5 sp</td></tr>
                                    <tr><td>Mace</td><td>Str</td><td class="num">+1</td><td>1d6</td><td class="num">1</td><td>5 gp</td></tr>
                                    <tr><td>Quarterstaff</td><td>Str</td><td class="num">+1</td><td>1d6</td><td class="num">3</td><td>2 sp</td></tr>
                                    <tr><td>Spear</td><td>Str</td><td class="num">+1</td><td>1d6</td><td class="num">3</td><td>1 gp</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Martial Melee</h4>
                                <table class="ref-table">
                                    <tr><th>Weapon</th><th>Ability</th><th>Atk</th><th>Dmg</th><th>Range</th><th>Cost</th></tr>
                                    <tr><td>Battleaxe</td><td>Str</td><td class="num">+2</td><td>1d8</td><td class="num">1</td><td>10 gp</td></tr>
                                    <tr><td>Greatsword</td><td>Str</td><td class="num">+3</td><td>2d6</td><td class="num">2</td><td>50 gp</td></tr>
                                    <tr><td>Greataxe</td><td>Str</td><td class="num">+3</td><td>1d12</td><td class="num">2</td><td>30 gp</td></tr>
                                    <tr><td>Longsword</td><td>Str</td><td class="num">+2</td><td>1d8</td><td class="num">2</td><td>15 gp</td></tr>
                                    <tr><td>Rapier</td><td>Dex</td><td class="num">+2</td><td>1d8</td><td class="num">2</td><td>25 gp</td></tr>
                                    <tr><td>Shortsword</td><td>Dex</td><td class="num">+2</td><td>1d6</td><td class="num">1</td><td>10 gp</td></tr>
                                    <tr><td>Halberd</td><td>Str</td><td class="num">+2</td><td>1d10</td><td>3 (R)</td><td>20 gp</td></tr>
                                    <tr><td>Maul</td><td>Str</td><td class="num">+3</td><td>2d6</td><td class="num">2</td><td>10 gp</td></tr>
                                    <tr><td>Warhammer</td><td>Str</td><td class="num">+2</td><td>1d8</td><td class="num">1</td><td>15 gp</td></tr>
                                    <tr><td>Katana</td><td>Str/Dex</td><td class="num">+2</td><td>1d10</td><td class="num">2</td><td>50 gp</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Ranged</h4>
                                <table class="ref-table">
                                    <tr><th>Weapon</th><th>Ability</th><th>Atk</th><th>Dmg</th><th>Range</th><th>Cost</th></tr>
                                    <tr><td>Shortbow</td><td>Dex</td><td class="num">+2</td><td>1d6</td><td>20/40</td><td>25 gp</td></tr>
                                    <tr><td>Longbow</td><td>Dex</td><td class="num">+2</td><td>1d8</td><td>40/80</td><td>50 gp</td></tr>
                                    <tr><td>Light Crossbow</td><td>Dex</td><td class="num">+2</td><td>1d8</td><td>20/40</td><td>25 gp</td></tr>
                                    <tr><td>Heavy Crossbow</td><td>Str</td><td class="num">+2</td><td>1d10</td><td>30/60</td><td>50 gp</td></tr>
                                    <tr><td>Hand Crossbow</td><td>Dex</td><td class="num">+2</td><td>1d6</td><td>10/30</td><td>75 gp</td></tr>
                                    <tr><td>Throwing Axe</td><td>Dex</td><td class="num">+2</td><td>1d6</td><td>5/15</td><td>8 gp</td></tr>
                                    <tr><td>Dart</td><td>Dex</td><td class="num">+1</td><td>1d4</td><td>5/15</td><td>5 cp</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Armor & Shields -->
                    <div class="ref-accordion" onclick="toggleAccordion(this)">
                        <div class="ref-accordion-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                                Armor & Shields
                            </h3>
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="ref-accordion-content">
                            <div class="ref-subsection">
                                <h4>Chest Armor</h4>
                                <table class="ref-table">
                                    <tr><th>Name</th><th>Type</th><th>HP</th><th>Block</th><th>Disadvantage</th><th>Cost</th></tr>
                                    <tr><td>Cloth</td><td>Light</td><td class="num">2</td><td>0+block</td><td>None</td><td>2 sp</td></tr>
                                    <tr><td>Leather</td><td>Light</td><td class="num">5</td><td>1+block</td><td>None</td><td>10 gp</td></tr>
                                    <tr><td>Studded Leather</td><td>Light</td><td class="num">6</td><td>2+block</td><td>None</td><td>25 gp</td></tr>
                                    <tr><td>Chain Shirt</td><td>Medium</td><td class="num">9</td><td>3+block</td><td>Stealth</td><td>50 gp</td></tr>
                                    <tr><td>Breastplate</td><td>Medium</td><td class="num">11</td><td>3+block</td><td>Stealth</td><td>150 gp</td></tr>
                                    <tr><td>Half Plate</td><td>Medium</td><td class="num">13</td><td>4+block</td><td>Stealth, -1D10 Acro</td><td>300 gp</td></tr>
                                    <tr><td>Chainmail</td><td>Heavy</td><td class="num">13</td><td>4+block</td><td>Stealth, -1D10 Acro/Athl</td><td>75 gp</td></tr>
                                    <tr><td>Splint</td><td>Heavy</td><td class="num">14</td><td>5+block</td><td>Stealth, -1D10 Acro/Athl</td><td>200 gp</td></tr>
                                    <tr><td>Plate</td><td>Heavy</td><td class="num">15</td><td>6+block</td><td>Stealth, -1D10 Acro/Athl</td><td>750 gp</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Head Armor</h4>
                                <table class="ref-table">
                                    <tr><th>Name</th><th>Type</th><th>HP</th><th>Block</th><th>Disadvantage</th><th>Cost</th></tr>
                                    <tr><td>Cloth Hood</td><td>Light</td><td class="num">1</td><td>0+block</td><td>None</td><td>2 sp</td></tr>
                                    <tr><td>Leather Cap</td><td>Light</td><td class="num">2</td><td>0+block</td><td>None</td><td>5 sp</td></tr>
                                    <tr><td>Chain Coif</td><td>Medium</td><td class="num">4</td><td>1+block</td><td>Stealth, -1D10 Perc</td><td>15 gp</td></tr>
                                    <tr><td>Light Helmet</td><td>Medium</td><td class="num">5</td><td>1+block</td><td>-1D10 Perc</td><td>25 gp</td></tr>
                                    <tr><td>Heavy Helmet</td><td>Heavy</td><td class="num">6</td><td>2+block</td><td>Stealth, -1D10 Perc</td><td>45 gp</td></tr>
                                    <tr><td>Great Helm</td><td>Heavy</td><td class="num">7</td><td>2+block</td><td>Stealth, -1D10 Perc/Inv</td><td>75 gp</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Shields</h4>
                                <table class="ref-table">
                                    <tr><th>Name</th><th>HP</th><th>Block</th><th>Def</th><th>Dmg</th><th>Cost</th></tr>
                                    <tr><td>Small Shield</td><td class="num">3</td><td class="num">1</td><td class="num">1</td><td>1d4</td><td>3 gp</td></tr>
                                    <tr><td>Shield (Wooden)</td><td class="num">10</td><td class="num">3</td><td class="num">2</td><td>1d4</td><td>8 gp</td></tr>
                                    <tr><td>Shield (Metal)</td><td class="num">15</td><td class="num">5</td><td class="num">3</td><td>1d6</td><td>35 gp</td></tr>
                                    <tr><td>Spiked Shield</td><td class="num">12</td><td class="num">4</td><td class="num">2</td><td>1d8</td><td>45 gp</td></tr>
                                    <tr><td>Tower Shield</td><td class="num">30</td><td class="num">10</td><td class="num">5</td><td>1d4</td><td>100 gp</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Mage Spells -->
                    <div class="ref-accordion" onclick="toggleAccordion(this)">
                        <div class="ref-accordion-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                                Mage Spells
                            </h3>
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="ref-accordion-content">
                            <div class="ref-subsection">
                                <h4>Offensive</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Damage</th><th>Notes</th></tr>
                                    <tr><td>Scorch</td><td>Fire</td><td class="num">1</td><td>2D10</td><td>‚Äî</td></tr>
                                    <tr><td>Fireball</td><td>Fire</td><td class="num">1</td><td>2D6</td><td>‚Äî</td></tr>
                                    <tr><td>Arcane Bolt</td><td>Arcane</td><td class="num">1</td><td>1D10</td><td>‚Äî</td></tr>
                                    <tr><td>Icebolt</td><td>Frost</td><td class="num">1</td><td>1D10</td><td>‚Äî</td></tr>
                                    <tr><td>Frostbite</td><td>Frost</td><td class="num">1</td><td>1D6</td><td>‚Äî</td></tr>
                                    <tr><td>Thunderclap</td><td>Lightning</td><td class="num">1</td><td>1D6</td><td>‚Äî</td></tr>
                                    <tr><td>Magic Missile</td><td>Arcane</td><td class="num">1</td><td>1D6</td><td>Never miss</td></tr>
                                    <tr><td>Acid Splash</td><td>Arcane</td><td class="num">1</td><td>1D6</td><td>1-2 targets</td></tr>
                                    <tr><td>Sword Burst</td><td>Arcane</td><td class="num">1</td><td>1D6</td><td>AoE around caster</td></tr>
                                    <tr><td>Icelance</td><td>Frost</td><td class="num">2</td><td>2D6</td><td>‚Äî</td></tr>
                                    <tr><td>Mage Blade</td><td>Arcane</td><td class="num">2</td><td>2D10</td><td>1 round</td></tr>
                                    <tr><td>Shadow Bolt</td><td>Shadow</td><td class="num">2</td><td>2D6</td><td>‚Äî</td></tr>
                                    <tr><td>Ice Knife</td><td>Frost</td><td class="num">2</td><td>2D10</td><td>Explodes on impact</td></tr>
                                    <tr><td>Cloud of Daggers</td><td>Arcane</td><td class="num">2</td><td>2D6</td><td>2 rounds</td></tr>
                                    <tr><td>Arms of Despair</td><td>Shadow</td><td class="num">2</td><td>2D6</td><td>AoE tentacles</td></tr>
                                    <tr><td>Ray of Frost</td><td>Frost</td><td class="num">3</td><td>3D6</td><td>‚Äî</td></tr>
                                    <tr><td>Arcane Blast</td><td>Arcane</td><td class="num">3</td><td>2D10</td><td>‚Äî</td></tr>
                                    <tr><td>Mind Blast</td><td>Psychic</td><td class="num">3</td><td>2D10</td><td>‚Äî</td></tr>
                                    <tr><td>Spray of Cards</td><td>Arcane</td><td class="num">3</td><td>2D10</td><td>Magical cutting cards</td></tr>
                                    <tr><td>Conjure Barrage</td><td>Arcane</td><td class="num">3</td><td>2D10</td><td>Rain of projectiles</td></tr>
                                    <tr><td>Thunder Step</td><td>Lightning</td><td class="num">3</td><td>2D10</td><td>Teleport + AoE</td></tr>
                                    <tr><td>Fireblast</td><td>Fire</td><td class="num">4</td><td>3D6</td><td>‚Äî</td></tr>
                                    <tr><td>Spirit Guardians</td><td>Arcane</td><td class="num">4</td><td>3D6</td><td>4 rounds</td></tr>
                                    <tr><td>Black Tentacles</td><td>Shadow</td><td class="num">4</td><td>3D6</td><td>2 rounds</td></tr>
                                    <tr><td>Chain Lightning</td><td>Lightning</td><td class="num">5</td><td>3D6</td><td>Multi-target</td></tr>
                                    <tr><td>Banishing Smite</td><td>Arcane</td><td class="num">5</td><td>3D6</td><td>Banishes target</td></tr>
                                    <tr><td>Conjure Volley</td><td>Arcane</td><td class="num">5</td><td>3D6</td><td>Massive AoE</td></tr>
                                    <tr><td>Steel Wind Strike</td><td>Arcane</td><td class="num">5</td><td>3D6</td><td>Multi-target + teleport</td></tr>
                                    <tr><td>Arcane Missiles</td><td>Arcane</td><td class="num">6</td><td>4D6</td><td>Multiple missiles</td></tr>
                                    <tr><td>Incendiary Cloud</td><td>Fire</td><td class="num">6</td><td>4D6</td><td>Moving fire, 4 rounds</td></tr>
                                    <tr><td>Disintegrate</td><td>Arcane</td><td class="num">7</td><td>4D10</td><td>‚Äî</td></tr>
                                    <tr><td>Blade of Disaster</td><td>Arcane</td><td class="num">7</td><td>4D10</td><td>4 rounds</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Black Magic / Summoning</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Damage</th><th>Duration</th></tr>
                                    <tr><td>Summon Imp</td><td>Black Magic</td><td class="num">3</td><td>1D10</td><td>1 round</td></tr>
                                    <tr><td>Summon Shadowspawn</td><td>Black Magic</td><td class="num">3</td><td>1D10</td><td>1 round</td></tr>
                                    <tr><td>Summon Lesser Demons</td><td>Black Magic</td><td class="num">3</td><td>1D10</td><td>1 round</td></tr>
                                    <tr><td>Summon Void</td><td>Black Magic</td><td class="num">4</td><td>2D6</td><td>1 round</td></tr>
                                    <tr><td>Summon Aberration</td><td>Black Magic</td><td class="num">4</td><td>2D6</td><td>1 round</td></tr>
                                    <tr><td>Hunger of the Fallen</td><td>Black Magic</td><td class="num">4</td><td>2D6</td><td>2 rounds</td></tr>
                                    <tr><td>Summon Greater Demon</td><td>Black Magic</td><td class="num">4</td><td>2D6</td><td>2 rounds</td></tr>
                                    <tr><td>Summon Infernal</td><td>Black Magic</td><td class="num">5</td><td>2D10</td><td>2 rounds</td></tr>
                                    <tr><td>Infernal Calling</td><td>Black Magic</td><td class="num">5</td><td>2D10</td><td>2 rounds</td></tr>
                                    <tr><td>Summon Fiend</td><td>Black Magic</td><td class="num">6</td><td>3D6</td><td>4 rounds</td></tr>
                                    <tr><td>Maze</td><td>Black Magic</td><td class="num">7</td><td>‚Äî</td><td>Special</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Conjuration</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Effect</th><th>Duration</th></tr>
                                    <tr><td>Mage Hand</td><td>Conjuration</td><td class="num">3</td><td>Magical hand</td><td>1 round</td></tr>
                                    <tr><td>Unseen Servant</td><td>Conjuration</td><td class="num">3</td><td>Invisible helper</td><td>10 rounds</td></tr>
                                    <tr><td>Find Familiar</td><td>Conjuration</td><td class="num">3</td><td>Magic companion</td><td>Permanent</td></tr>
                                    <tr><td>Flock of Familiars</td><td>Conjuration</td><td class="num">3</td><td>Multiple familiars</td><td>4 rounds</td></tr>
                                    <tr><td>Flaming Sphere</td><td>Conjuration</td><td class="num">3</td><td>Rolling fireball (2D6)</td><td>2 rounds</td></tr>
                                    <tr><td>Summon Construct</td><td>Conjuration</td><td class="num">4</td><td>Create construct</td><td>2 rounds</td></tr>
                                    <tr><td>Guardian of Faith</td><td>Conjuration</td><td class="num">4</td><td>Protective spirit</td><td>4 rounds</td></tr>
                                    <tr><td>Teleport</td><td>Conjuration</td><td class="num">5</td><td>Short distance</td><td>Instant</td></tr>
                                    <tr><td>Minor Elementals</td><td>Conjuration</td><td class="num">5</td><td>Small elementals</td><td>2 rounds</td></tr>
                                    <tr><td>Summon Elemental</td><td>Conjuration</td><td class="num">5</td><td>Elemental ally</td><td>2 rounds</td></tr>
                                    <tr><td>Conjure Elemental</td><td>Conjuration</td><td class="num">6</td><td>Powerful elemental</td><td>4 rounds</td></tr>
                                    <tr><td>Planar Ally</td><td>Conjuration</td><td class="num">7</td><td>Extraplanar ally</td><td>Special</td></tr>
                                    <tr><td>Gate</td><td>Conjuration</td><td class="num">8</td><td>Portal to other plane</td><td>4 rounds</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Transmutation / Movement</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Effect</th><th>Duration</th></tr>
                                    <tr><td>Water Breathing</td><td>Transmutation</td><td class="num">1</td><td>Breathe underwater</td><td>10 rounds</td></tr>
                                    <tr><td>Flickering Tongue</td><td>Transmutation</td><td class="num">2</td><td>Understand creature</td><td>1 round</td></tr>
                                    <tr><td>Levitate</td><td>Transmutation</td><td class="num">2</td><td>Float</td><td>4 rounds</td></tr>
                                    <tr><td>Polymorph</td><td>Transmutation</td><td class="num">3</td><td>Transform</td><td>2 rounds</td></tr>
                                    <tr><td>Control Flames</td><td>Transmutation</td><td class="num">3</td><td>Manipulate fire</td><td>1 round</td></tr>
                                    <tr><td>Misty Step</td><td>Transmutation</td><td class="num">3</td><td>Short teleport</td><td>Instant</td></tr>
                                    <tr><td>Vortex Warp</td><td>Transmutation</td><td class="num">3</td><td>Teleport other</td><td>Instant</td></tr>
                                    <tr><td>Invisibility</td><td>Transformation</td><td class="num">4</td><td>Make invisible</td><td>4 rounds</td></tr>
                                    <tr><td>Dimension Door</td><td>Transmutation</td><td class="num">4</td><td>Teleport 500 ft</td><td>Instant</td></tr>
                                    <tr><td>Far Step</td><td>Transmutation</td><td class="num">5</td><td>Teleport each round</td><td>4 rounds</td></tr>
                                    <tr><td>Teleportation Circle</td><td>Transmutation</td><td class="num">5</td><td>Create portal</td><td>1 round</td></tr>
                                    <tr><td>Arcane Gate</td><td>Transmutation</td><td class="num">6</td><td>Portal between points</td><td>4 rounds</td></tr>
                                    <tr><td>Scatter</td><td>Transmutation</td><td class="num">6</td><td>Teleport multiple</td><td>Instant</td></tr>
                                    <tr><td>Word of Recall</td><td>Transmutation</td><td class="num">6</td><td>Teleport to sanctuary</td><td>Instant</td></tr>
                                    <tr><td>Etherealness</td><td>Transmutation</td><td class="num">7</td><td>Enter ethereal plane</td><td>8 rounds</td></tr>
                                    <tr><td>Plane Shift</td><td>Transmutation</td><td class="num">7</td><td>Travel to other plane</td><td>Instant</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Utility & Control</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Effect</th><th>Duration</th></tr>
                                    <tr><td>Detect Magic</td><td>Divination</td><td class="num">1</td><td>Sense magical auras</td><td>2 rounds</td></tr>
                                    <tr><td>Light</td><td>Fire</td><td class="num">2</td><td>Light source</td><td>1 round</td></tr>
                                    <tr><td>Create Bonfire</td><td>Fire</td><td class="num">2</td><td>Magic fire (1D10)</td><td>1 round</td></tr>
                                    <tr><td>Prismatic Barrier</td><td>Protection</td><td class="num">2</td><td>Shield ally</td><td>1 round</td></tr>
                                    <tr><td>Ice Armor</td><td>Protection</td><td class="num">2</td><td>Self shield</td><td>4 rounds</td></tr>
                                    <tr><td>Sleep</td><td>Enchantment</td><td class="num">2</td><td>Put to sleep</td><td>3 rounds</td></tr>
                                    <tr><td>Arcane Lock</td><td>Abjuration</td><td class="num">2</td><td>Lock door</td><td>Permanent</td></tr>
                                    <tr><td>Charm Person</td><td>Enchantment</td><td class="num">3</td><td>Charm humanoid</td><td>2 rounds</td></tr>
                                    <tr><td>Mirror Image</td><td>Illusion</td><td class="num">3</td><td>Create duplicates</td><td>3 rounds</td></tr>
                                    <tr><td>Arcane Eye</td><td>Divination</td><td class="num">3</td><td>Remote vision</td><td>4 rounds</td></tr>
                                    <tr><td>Web</td><td>Utility</td><td class="num">3</td><td>Sticky webs</td><td>2 rounds</td></tr>
                                    <tr><td>Grease</td><td>Utility</td><td class="num">3</td><td>Slippery area</td><td>2 rounds</td></tr>
                                    <tr><td>Counterspell</td><td>Abjuration</td><td class="num">4</td><td>Counter spell</td><td>Instant</td></tr>
                                    <tr><td>Dispel Magic</td><td>Abjuration</td><td class="num">4</td><td>Remove magic</td><td>1 round</td></tr>
                                    <tr><td>Animate Dead</td><td>Necromancy</td><td class="num">6</td><td>Animate corpse</td><td>1 round</td></tr>
                                    <tr><td>Time Warp</td><td>Manipulation</td><td class="num">6</td><td>Slow/rewind time</td><td>1 round</td></tr>
                                    <tr><td>Demiplane</td><td>Utility</td><td class="num">7</td><td>Create pocket plane</td><td>4 rounds</td></tr>
                                    <tr><td>Mighty Fortress</td><td>Utility</td><td class="num">8</td><td>Create stone fortress</td><td>Permanent</td></tr>
                                    <tr><td>Wish</td><td>Utility</td><td class="num">8</td><td>Grant a wish</td><td>Instant</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Druid Spells -->
                    <div class="ref-accordion" onclick="toggleAccordion(this)">
                        <div class="ref-accordion-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c4-4 8-7.582 8-12a8 8 0 1 0-16 0c0 4.418 4 8 8 12z"/><circle cx="12" cy="10" r="3"/></svg>
                                Druid Spells
                            </h3>
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="ref-accordion-content">
                            <div class="ref-subsection">
                                <h4>Offensive</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Damage</th><th>Notes</th></tr>
                                    <tr><td>Sunfire</td><td>Fire</td><td class="num">1</td><td>1D10</td><td>Daytime only</td></tr>
                                    <tr><td>Moonfall</td><td>Arcana</td><td class="num">1</td><td>1D10</td><td>Nighttime only</td></tr>
                                    <tr><td>Poison Spray</td><td>Nature</td><td class="num">1</td><td>1D10</td><td>‚Äî</td></tr>
                                    <tr><td>Produce Flame</td><td>Nature</td><td class="num">1</td><td>1D10</td><td>‚Äî</td></tr>
                                    <tr><td>Infestation</td><td>Nature</td><td class="num">1</td><td>1D6</td><td>‚Äî</td></tr>
                                    <tr><td>Thorns</td><td>Nature</td><td class="num">2</td><td>1D10</td><td>‚Äî</td></tr>
                                    <tr><td>Vine Lash</td><td>Nature</td><td class="num">2</td><td>1D10</td><td>‚Äî</td></tr>
                                    <tr><td>Hail of Thorns</td><td>Nature</td><td class="num">2</td><td>2D6</td><td>Explodes on hit</td></tr>
                                    <tr><td>Ensnaring Strike</td><td>Nature</td><td class="num">2</td><td>1D10</td><td>Snares target, 1 round</td></tr>
                                    <tr><td>Earthshaping</td><td>Nature</td><td class="num">3</td><td>2D6</td><td>1 round</td></tr>
                                    <tr><td>Blight</td><td>Nature</td><td class="num">3</td><td>2D6</td><td>Drain life</td></tr>
                                    <tr><td>Moonbeam</td><td>Arcana</td><td class="num">3</td><td>2D6</td><td>2 rounds</td></tr>
                                    <tr><td>Insect Plague</td><td>Nature</td><td class="num">3</td><td>1D6</td><td>1 round</td></tr>
                                    <tr><td>Dust Devil</td><td>Nature</td><td class="num">3</td><td>2D6</td><td>2 rounds</td></tr>
                                    <tr><td>Whips</td><td>Nature</td><td class="num">4</td><td>2D10</td><td>1 round</td></tr>
                                    <tr><td>Storm</td><td>Nature</td><td class="num">4</td><td>2D6</td><td>‚Äî</td></tr>
                                    <tr><td>Thunderclap</td><td>Arcana</td><td class="num">4</td><td>3D6</td><td>1 round</td></tr>
                                    <tr><td>Starfall</td><td>Arcana</td><td class="num">4</td><td>2D10</td><td>Nighttime only</td></tr>
                                    <tr><td>Tidal Wave</td><td>Nature</td><td class="num">4</td><td>3D6</td><td>‚Äî</td></tr>
                                    <tr><td>Call Lightning</td><td>Arcana</td><td class="num">5</td><td>3D6</td><td>4 rounds</td></tr>
                                    <tr><td>Cloudkill</td><td>Nature</td><td class="num">5</td><td>3D6</td><td>Poison, 4 rounds</td></tr>
                                    <tr><td>Earthquake</td><td>Nature</td><td class="num">6</td><td>3D6</td><td>‚Äî</td></tr>
                                    <tr><td>Wall of Thorns</td><td>Nature</td><td class="num">6</td><td>4D6</td><td>4 rounds</td></tr>
                                    <tr><td>Tsunami</td><td>Nature</td><td class="num">6</td><td>4D6</td><td>‚Äî</td></tr>
                                    <tr><td>Warrior of Tohu</td><td>Arcana</td><td class="num">6</td><td>8 flat</td><td>Channel raw arcana</td></tr>
                                    <tr><td>Storm of Vengeance</td><td>Nature</td><td class="num">7</td><td>4D10</td><td>4 rounds</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Healing</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Heal</th><th>Notes</th></tr>
                                    <tr><td>Mending</td><td>Nature</td><td class="num">3</td><td>1D10</td><td>Single target</td></tr>
                                    <tr><td>Cure Poison</td><td>Nature</td><td class="num">3</td><td>‚Äî</td><td>Remove poison</td></tr>
                                    <tr><td>Tunes of Healing</td><td>Nature</td><td class="num">4</td><td>2D6</td><td>Single target</td></tr>
                                    <tr><td>Healing Circle</td><td>Nature</td><td class="num">5</td><td>2D10</td><td>Multiple targets</td></tr>
                                    <tr><td>Rebirth</td><td>Nature</td><td class="num">8</td><td>Revive</td><td>Not in battle</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Summoning</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Damage</th><th>Duration</th></tr>
                                    <tr><td>Summon Beast</td><td>Nature</td><td class="num">3</td><td>1D10</td><td>2 rounds</td></tr>
                                    <tr><td>Find Steed</td><td>Nature</td><td class="num">4</td><td>‚Äî</td><td>Permanent</td></tr>
                                    <tr><td>Summon Fey</td><td>Nature</td><td class="num">4</td><td>2D6</td><td>2 rounds</td></tr>
                                    <tr><td>Giant Insect</td><td>Nature</td><td class="num">4</td><td>‚Äî</td><td>4 rounds</td></tr>
                                    <tr><td>Find Greater Steed</td><td>Nature</td><td class="num">5</td><td>‚Äî</td><td>Permanent</td></tr>
                                    <tr><td>Conjure Woodland Beings</td><td>Nature</td><td class="num">5</td><td>2D10</td><td>2 rounds</td></tr>
                                    <tr><td>Conjure Animals</td><td>Nature</td><td class="num">5</td><td>2D10</td><td>2 rounds</td></tr>
                                    <tr><td>Summon Celestial</td><td>Nature</td><td class="num">5</td><td>2D10</td><td>4 rounds</td></tr>
                                    <tr><td>Summon Draconic Spirit</td><td>Nature</td><td class="num">5</td><td>2D10</td><td>4 rounds</td></tr>
                                    <tr><td>Conjure Fey</td><td>Nature</td><td class="num">6</td><td>3D6</td><td>4 rounds</td></tr>
                                    <tr><td>Conjure Celestial</td><td>Nature</td><td class="num">7</td><td>4D10</td><td>4 rounds</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Control</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Effect</th><th>Duration</th></tr>
                                    <tr><td>Entangle</td><td>Nature</td><td class="num">2</td><td>Roots hold</td><td>2 rounds</td></tr>
                                    <tr><td>Fog Cloud</td><td>Nature</td><td class="num">2</td><td>Thick fog</td><td>3 rounds</td></tr>
                                    <tr><td>Sleet Storm</td><td>Nature</td><td class="num">4</td><td>Hinders movement</td><td>2 rounds</td></tr>
                                    <tr><td>Stinking Cloud</td><td>Nature</td><td class="num">4</td><td>Nauseating gas</td><td>2 rounds</td></tr>
                                    <tr><td>Grasping Vine</td><td>Nature</td><td class="num">4</td><td>Vine pulls target</td><td>2 rounds</td></tr>
                                    <tr><td>Watery Sphere</td><td>Nature</td><td class="num">4</td><td>Trap in water</td><td>2 rounds</td></tr>
                                </table>
                            </div>
                            <div class="ref-subsection">
                                <h4>Support & Utility</h4>
                                <table class="ref-table">
                                    <tr><th>Spell</th><th>Type</th><th>Arc</th><th>Effect</th><th>Duration</th></tr>
                                    <tr><td>Purify Water</td><td>Nature</td><td class="num">1</td><td>Cleanse water</td><td>Permanent</td></tr>
                                    <tr><td>Barkskin</td><td>Nature</td><td class="num">2</td><td>Harden skin</td><td>4 rounds</td></tr>
                                    <tr><td>Air Bubble</td><td>Nature</td><td class="num">2</td><td>Breathe underwater</td><td>24 hours</td></tr>
                                    <tr><td>Speak with Plants</td><td>Nature</td><td class="num">2</td><td>Communicate</td><td>2 rounds</td></tr>
                                    <tr><td>Animal Handling</td><td>Nature</td><td class="num">3</td><td>Communicate</td><td>2 rounds</td></tr>
                                    <tr><td>Innervate</td><td>Arcana</td><td class="num">3</td><td>Give initiative</td><td>‚Äî</td></tr>
                                    <tr><td>Tree Stride</td><td>Nature</td><td class="num">3</td><td>Teleport trees</td><td>1 round</td></tr>
                                    <tr><td>Packleader</td><td>Nature</td><td class="num">3</td><td>Summon allies</td><td>Same region</td></tr>
                                    <tr><td>Plant Growth</td><td>Nature</td><td class="num">4</td><td>Grow plants</td><td>Permanent</td></tr>
                                    <tr><td>Prowler's Eyes</td><td>Nature</td><td class="num">4</td><td>Darkvision</td><td>1 round</td></tr>
                                    <tr><td>Wildshape</td><td>Nature</td><td class="num">4</td><td>Become animal</td><td>4 rounds</td></tr>
                                    <tr><td>Create Food and Water</td><td>Nature</td><td class="num">4</td><td>Conjure sustenance</td><td>Instant</td></tr>
                                    <tr><td>Tame a Beast</td><td>Nature</td><td class="num">6</td><td>Tame beast</td><td>2 rounds</td></tr>
                                    <tr><td>Transport via Plants</td><td>Nature</td><td class="num">6</td><td>Teleport via plants</td><td>Instant</td></tr>
                                    <tr><td>Heroes' Feast</td><td>Nature</td><td class="num">6</td><td>Magical feast</td><td>Permanent</td></tr>
                                    <tr><td>Temple of the Gods</td><td>Nature</td><td class="num">7</td><td>Create temple</td><td>24 hours</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Page: Calculator (DM Dice Calculator) -->
            <div id="page-calculator" class="tab-content">
                <div class="section">
                    <!-- Defense Calculator -->
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                            Defense Calculator
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">
                            Calculate defense rolls and outcomes.
                        </p>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3); margin-bottom: var(--space-3);">
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-bottom: var(--space-1);">Defense Type</label>
                                <select id="calc-defense-type" onchange="updateDefenseInfo()" style="width: 100%; padding: var(--space-2); background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-base);">
                                    <option value="block">Block (STR + Shield Block)</option>
                                    <option value="dodge">Dodge (DEX or Acrobatics)</option>
                                    <option value="parry">Parry (Weapon Atk Bonus + STR)</option>
                                    <option value="takeHit">Take Hit (Toughness + Armor Block)</option>
                                </select>
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-bottom: var(--space-1);">Pool Size (D10s)</label>
                                <input type="number" id="calc-defense-pool" value="5" min="1" max="20" onchange="updateDefenseOdds()" style="width: 100%; padding: var(--space-2); background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-base);">
                            </div>
                        </div>

                        <!-- Probability Display -->
                        <div id="calc-defense-odds" style="background: var(--bg-elevated); padding: var(--space-3); border-radius: var(--radius-sm); margin-bottom: var(--space-3); font-size: 0.85rem;">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2); text-align: center;">
                                <div><span style="color: var(--accent-red);">0 succ</span><br><span id="odds-0-succ">--</span></div>
                                <div><span style="color: var(--accent-gold);">1 succ</span><br><span id="odds-1-succ">--</span></div>
                                <div><span style="color: var(--accent-green);">2+ succ</span><br><span id="odds-2-succ">--</span></div>
                            </div>
                        </div>

                        <button onclick="rollDefense()" class="quick-add-btn" style="width: 100%; background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%); margin-bottom: var(--space-3);">
                            üé≤ Roll Defense
                        </button>

                        <!-- Defense Result -->
                        <div id="calc-defense-result" style="display: none; background: var(--bg-elevated); padding: var(--space-3); border-radius: var(--radius-sm); border-left: 3px solid var(--primary-purple);">
                            <div id="calc-defense-rolls" style="margin-bottom: var(--space-2); font-family: monospace;"></div>
                            <div id="calc-defense-outcome" style="font-weight: 600;"></div>
                            <div id="calc-defense-effect" style="color: var(--text-secondary); margin-top: var(--space-2); font-size: 0.9rem;"></div>
                        </div>
                    </div>

                    <!-- Damage Calculator -->
                    <div class="subsection" style="margin-top: var(--space-4);">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
                            Damage Calculator
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">
                            Calculate where damage goes based on defense result.
                        </p>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3); margin-bottom: var(--space-3);">
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-bottom: var(--space-1);">Incoming Damage</label>
                                <input type="number" id="calc-damage-incoming" value="10" min="1" style="width: 100%; padding: var(--space-2); background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-base);">
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-bottom: var(--space-1);">Defense Successes</label>
                                <select id="calc-damage-successes" style="width: 100%; padding: var(--space-2); background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-base);">
                                    <option value="0">0 Successes (Failed)</option>
                                    <option value="1">1 Success (Barely)</option>
                                    <option value="2">2+ Successes (Full Defense)</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3); margin-bottom: var(--space-3);">
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-bottom: var(--space-1);">Defense Type Used</label>
                                <select id="calc-damage-defense-type" style="width: 100%; padding: var(--space-2); background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-base);">
                                    <option value="block">Block</option>
                                    <option value="dodge">Dodge</option>
                                    <option value="parry">Parry</option>
                                    <option value="takeHit">Take Hit</option>
                                </select>
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-bottom: var(--space-1);">Shield/Armor HP</label>
                                <input type="number" id="calc-equipment-hp" value="20" min="0" style="width: 100%; padding: var(--space-2); background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-base);">
                            </div>
                        </div>

                        <button onclick="calculateDamage()" class="quick-add-btn" style="width: 100%; background: linear-gradient(135deg, var(--accent-red) 0%, #ff6b6b 100%); margin-bottom: var(--space-3);">
                            ‚öîÔ∏è Calculate Damage
                        </button>

                        <!-- Damage Result -->
                        <div id="calc-damage-result" style="display: none; background: var(--bg-elevated); padding: var(--space-3); border-radius: var(--radius-sm); border-left: 3px solid var(--accent-red);">
                            <div id="calc-damage-breakdown"></div>
                        </div>
                    </div>

                    <!-- NPC Quick Roll -->
                    <div class="subsection" style="margin-top: var(--space-4);">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            NPC Quick Roll
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">
                            Fast dice rolls for NPCs and enemies.
                        </p>

                        <div style="margin-bottom: var(--space-3);">
                            <label style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-bottom: var(--space-1);">Pool Size</label>
                            <div style="display: flex; gap: var(--space-2); flex-wrap: wrap; margin-bottom: var(--space-2);">
                                <button onclick="setNpcPool(3)" class="npc-pool-btn" data-pool="3">3</button>
                                <button onclick="setNpcPool(5)" class="npc-pool-btn active" data-pool="5">5</button>
                                <button onclick="setNpcPool(7)" class="npc-pool-btn" data-pool="7">7</button>
                                <button onclick="setNpcPool(10)" class="npc-pool-btn" data-pool="10">10</button>
                                <input type="number" id="calc-npc-pool" value="5" min="1" max="20" onchange="updateNpcOdds()" style="width: 60px; padding: var(--space-2); background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-base); text-align: center;">
                            </div>
                            <div id="calc-npc-odds" style="color: var(--text-secondary); font-size: 0.85rem;">
                                Odds: <span id="npc-odds-text">--</span>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2); margin-bottom: var(--space-3);">
                            <button onclick="rollNpc('attack')" class="quick-add-btn" style="background: linear-gradient(135deg, var(--accent-red) 0%, #ff6b6b 100%);">
                                üéØ Attack
                            </button>
                            <button onclick="rollNpc('defense')" class="quick-add-btn" style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-purple) 100%);">
                                üõ°Ô∏è Defense
                            </button>
                            <button onclick="rollNpc('skill')" class="quick-add-btn" style="background: linear-gradient(135deg, var(--accent-gold) 0%, #fbbf24 100%);">
                                üìã Skill
                            </button>
                        </div>

                        <!-- NPC Roll Result -->
                        <div id="calc-npc-result" style="display: none; background: var(--bg-elevated); padding: var(--space-3); border-radius: var(--radius-sm); border-left: 3px solid var(--accent-gold);">
                            <div id="calc-npc-rolls" style="margin-bottom: var(--space-2); font-family: monospace;"></div>
                            <div id="calc-npc-outcome" style="font-weight: 600;"></div>
                        </div>
                    </div>

                    <!-- Quick Reference -->
                    <div class="subsection" style="margin-top: var(--space-4);">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            Quick Reference
                        </h3>
                        <div style="background: var(--bg-elevated); padding: var(--space-3); border-radius: var(--radius-sm); font-size: 0.85rem;">
                            <div style="margin-bottom: var(--space-3);">
                                <strong style="color: var(--accent-gold);">D10 Success Levels:</strong>
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2); margin-top: var(--space-2); text-align: center;">
                                    <div style="color: var(--accent-red);">1-4<br>Failure</div>
                                    <div style="color: var(--accent-gold);">5-6<br>Barely</div>
                                    <div style="color: var(--accent-green);">7-9<br>Success</div>
                                    <div style="color: var(--primary-purple);">10<br>Critical!</div>
                                </div>
                            </div>
                            <div>
                                <strong style="color: var(--accent-gold);">Defense Outcomes:</strong>
                                <table style="width: 100%; margin-top: var(--space-2); border-collapse: collapse; font-size: 0.8rem;">
                                    <tr style="border-bottom: 1px solid var(--border-subtle);">
                                        <th style="text-align: left; padding: var(--space-1);">Defense</th>
                                        <th style="text-align: center; padding: var(--space-1); color: var(--accent-green);">2+</th>
                                        <th style="text-align: center; padding: var(--space-1); color: var(--accent-gold);">1</th>
                                        <th style="text-align: center; padding: var(--space-1); color: var(--accent-red);">0</th>
                                    </tr>
                                    <tr style="border-bottom: 1px solid var(--border-subtle);">
                                        <td style="padding: var(--space-1);">Block</td>
                                        <td style="text-align: center; padding: var(--space-1);">Shield 50%</td>
                                        <td style="text-align: center; padding: var(--space-1);">Shield HP</td>
                                        <td style="text-align: center; padding: var(--space-1);">Armor HP</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid var(--border-subtle);">
                                        <td style="padding: var(--space-1);">Dodge/Parry</td>
                                        <td style="text-align: center; padding: var(--space-1);">No dmg</td>
                                        <td style="text-align: center; padding: var(--space-1);">Half ‚Üí Armor</td>
                                        <td style="text-align: center; padding: var(--space-1);">Full ‚Üí Armor</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: var(--space-1);">Take Hit</td>
                                        <td style="text-align: center; padding: var(--space-1);">Minimal</td>
                                        <td style="text-align: center; padding: var(--space-1);">Armor absorbs</td>
                                        <td style="text-align: center; padding: var(--space-1);">Full + Stun</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Summary (Session recap) -->
            <div id="page-summary" class="tab-content">
                <div class="section">
                    <div class="subsection">
                        <h3 class="subsection-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            Session Summary
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">
                            Automatically generated from marked items (NPCs used, places visited, encounters completed, items found).
                        </p>
                        <div id="session-summary-content">
                            <p style="color: var(--text-muted); font-style: italic;">Loading summary...</p>
                        </div>
                        <div style="margin-top: var(--space-4); display: flex; gap: var(--space-3);">
                            <button class="quick-add-btn" onclick="copySummaryToClipboard()" style="background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%);">
                                Copy Summary
                            </button>
                            <button class="quick-add-btn" onclick="exportSummaryToAI()" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">
                                Send to AI for Notes
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Help (DM Planning Tool Guide) -->
            <div id="page-help" class="tab-content">
                <div class="section">
                    <div class="subsection">
                        <h3 class="subsection-title" style="color: var(--accent-gold);">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            DM Planning Tool Guide
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">
                            This guide explains how to use the DM Session tool to plan and run your adventures.
                        </p>

                        <!-- Quick Overview -->
                        <div class="help-block" style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: var(--space-4); margin-bottom: var(--space-4);">
                            <h4 style="color: var(--accent-cyan); margin: 0 0 var(--space-3) 0;">Quick Overview</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--space-3);">The DM Session tool has 6 tabs:</p>
                            <ul style="color: var(--text-secondary); margin: 0; padding-left: var(--space-4); line-height: 1.8;">
                                <li><strong style="color: var(--text-base);">Players</strong> - Add players and track who's in the session</li>
                                <li><strong style="color: var(--text-base);">Planning</strong> - Build your adventure (places, NPCs, encounters, items)</li>
                                <li><strong style="color: var(--text-base);">During Play</strong> - Run the session with quick access to your content</li>
                                <li><strong style="color: var(--text-base);">Reference</strong> - Look up rules, weapons, armor, spells + AI Assistant</li>
                                <li><strong style="color: var(--text-base);">Summary</strong> - Auto-generated recap of marked items</li>
                                <li><strong style="color: var(--text-base);">Help</strong> - This guide</li>
                            </ul>
                        </div>

                        <!-- Workflow -->
                        <div class="help-block" style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: var(--space-4); margin-bottom: var(--space-4);">
                            <h4 style="color: var(--accent-purple); margin: 0 0 var(--space-3) 0;">Recommended Workflow</h4>
                            <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                                <div style="display: flex; gap: var(--space-3); align-items: flex-start;">
                                    <span style="background: var(--accent-purple); color: #000; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">1</span>
                                    <div>
                                        <strong style="color: var(--text-base);">Before the Session</strong>
                                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 0.9rem;">Use the <strong>Planning</strong> tab to create your content. Set the Hook/Goal, write a Prologue, add places, NPCs, encounters, and items.</p>
                                    </div>
                                </div>
                                <div style="display: flex; gap: var(--space-3); align-items: flex-start;">
                                    <span style="background: var(--accent-purple); color: #000; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">2</span>
                                    <div>
                                        <strong style="color: var(--text-base);">During the Session</strong>
                                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 0.9rem;">Switch to <strong>During Play</strong>. Mark NPCs as used, places as visited, encounters as completed, items as found. Log events and turning points.</p>
                                    </div>
                                </div>
                                <div style="display: flex; gap: var(--space-3); align-items: flex-start;">
                                    <span style="background: var(--accent-purple); color: #000; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">3</span>
                                    <div>
                                        <strong style="color: var(--text-base);">After the Session</strong>
                                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 0.9rem;">Check <strong>Summary</strong> for auto-generated recap. Lock the session when done. Use AI to generate a prologue for next session.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Planning Tab Details -->
                        <div class="help-block" style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: var(--space-4); margin-bottom: var(--space-4);">
                            <h4 style="color: var(--accent-green); margin: 0 0 var(--space-3) 0;">Planning Tab - Building Your Adventure</h4>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Hook / Goal</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">What should the players accomplish this session? This is shown as a reminder in During Play.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Session Prologue</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Read-aloud text for session start. Recap what happened and set the scene. Use AI Assistant to generate one from a previous session.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Day & Time Organization</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">All content can be assigned to a Day (1-5) and Time (Dawn ‚Üí Night). This creates a structured timeline for your adventure.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--accent-cyan); margin: 0 0 var(--space-2) 0;">üìç Places</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Locations the party might visit. Add name and description. Other content (NPCs, encounters) can be linked to places.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--primary-blue); margin: 0 0 var(--space-2) 0;">üë§ NPCs</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Characters the party might meet. Include name, role, description, and disposition. Link to a place or leave unlinked.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--accent-red); margin: 0 0 var(--space-2) 0;">‚öîÔ∏è Encounters</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Combat or social encounters. Add participants with HP, armor, weapons. Include tactics and loot. Link to a place.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--accent-gold); margin: 0 0 var(--space-2) 0;">üíé Items / Clues</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Important items, clues, or loot. Add description for story items. Link to encounters or places.</p>
                            </div>

                            <div>
                                <h5 style="color: var(--accent-purple); margin: 0 0 var(--space-2) 0;">üìñ Read-Aloud</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Atmospheric text to read to players. Link to places, encounters, or NPCs for contextual display.</p>
                            </div>
                        </div>

                        <!-- During Play Details -->
                        <div class="help-block" style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: var(--space-4); margin-bottom: var(--space-4);">
                            <h4 style="color: var(--accent-red); margin: 0 0 var(--space-3) 0;">During Play Tab - Running the Session</h4>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Session Timeline</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Shows all your planned content organized by Day and Time. Click items to mark them as used/visited/completed/found.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">HP Tracking</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Use [-5] [-1] [+1] [+5] buttons to track participant HP in encounters. HP bar changes color: green (healthy), yellow (wounded), red with skull (dead).</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Giving Items to Players</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">When an item is marked as found, a "Given to" dropdown appears. Select a player to add the item to their character's Quest Items.</p>
                            </div>

                            <div style="margin-bottom: var(--space-4);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Event Log</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Quick notes about what's happening. These are used by AI to generate prologues and recaps.</p>
                            </div>

                            <div>
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Turning Points</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Key decisions or plot moments. Add description and consequence. Used in Summary and AI generation.</p>
                            </div>
                        </div>

                        <!-- AI Assistant -->
                        <div class="help-block" style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: var(--space-4); margin-bottom: var(--space-4);">
                            <h4 style="color: var(--primary-purple); margin: 0 0 var(--space-3) 0;">AI Assistant (Reference Tab)</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--space-3); font-size: 0.9rem;">The AI Assistant helps you create content. It knows the Aedelore world and can generate NPCs, encounters, locations, and more.</p>

                            <div style="margin-bottom: var(--space-3);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Quick Actions</h5>
                                <ul style="color: var(--text-secondary); margin: 0; padding-left: var(--space-4); font-size: 0.9rem; line-height: 1.6;">
                                    <li><strong>Random NPC</strong> - Generate an interesting NPC</li>
                                    <li><strong>Random Encounter</strong> - Create a balanced combat encounter</li>
                                    <li><strong>Describe Location</strong> - Atmospheric read-aloud text</li>
                                    <li><strong>Session Recap</strong> - Summary for players</li>
                                    <li><strong>Session Prologue</strong> - Opening text based on previous session</li>
                                </ul>
                            </div>

                            <div>
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Import from AI</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Copy AI-generated content and paste it in the Import tab. The tool will parse and add NPCs, encounters, items, etc. to your session.</p>
                            </div>
                        </div>

                        <!-- Player View -->
                        <div class="help-block" style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: var(--space-4); margin-bottom: var(--space-4);">
                            <h4 style="color: var(--accent-cyan); margin: 0 0 var(--space-3) 0;">Player View & Sharing</h4>

                            <div style="margin-bottom: var(--space-3);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Invite Players</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Share the campaign's invite code with players. They join via "Join Campaign" on the dashboard.</p>
                            </div>

                            <div style="margin-bottom: var(--space-3);">
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">What Players See</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Players see: session prologue, NPCs marked as used, places marked as visited, encounters marked completed, items marked found, and quest items given to them.</p>
                            </div>

                            <div>
                                <h5 style="color: var(--text-base); margin: 0 0 var(--space-2) 0;">Locking Sessions</h5>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Lock a session when it's complete. Locked sessions become permanent records in player view and can be used for AI prologue generation.</p>
                            </div>
                        </div>

                        <!-- Tips -->
                        <div class="help-block" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(59, 158, 255, 0.1) 100%); border: 1px solid var(--border-purple); border-radius: var(--radius-md); padding: var(--space-4);">
                            <h4 style="color: var(--accent-gold); margin: 0 0 var(--space-3) 0;">üí° Tips</h4>
                            <ul style="color: var(--text-secondary); margin: 0; padding-left: var(--space-4); line-height: 1.8;">
                                <li><strong>Link content to places</strong> - Creates a nested structure that's easy to navigate</li>
                                <li><strong>Use Day/Time</strong> - Helps pace the adventure and keeps things organized</li>
                                <li><strong>Log events as you play</strong> - Makes prologue generation much better</li>
                                <li><strong>Mark turning points</strong> - Captures important moments for recaps</li>
                                <li><strong>Generate prologue from previous session</strong> - Not current session!</li>
                                <li><strong>Lock sessions</strong> - Creates permanent history for players</li>
                                <li><strong>Use AI import</strong> - Let AI create content, then import it directly</li>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideAuthModal()">&times;</button>
            <h2 id="auth-modal-title">Login</h2>
            <div class="modal-form">
                <div class="field-group">
                    <label>Username</label>
                    <input type="text" id="auth-username" placeholder="Enter username">
                </div>
                <div class="field-group" id="auth-email-group" style="display: none;">
                    <label>Email</label>
                    <input type="email" id="auth-email" placeholder="Enter email">
                </div>
                <div class="field-group">
                    <label>Password</label>
                    <input type="password" id="auth-password" placeholder="Enter password">
                </div>
                <div class="field-group" id="auth-confirm-group" style="display: none;">
                    <label>Confirm Password</label>
                    <input type="password" id="auth-confirm-password" placeholder="Confirm password">
                </div>
                <p id="auth-error" class="error-text"></p>
                <button id="auth-submit-btn" class="modal-submit" onclick="doLogin()">Login</button>
                <p id="auth-toggle-text" class="toggle-text">No account? <a href="#" onclick="showAuthModal('register'); return false;">Register here</a></p>
                <p id="auth-forgot-text" class="toggle-text"><a href="#" onclick="showForgotPasswordModal(); return false;">Forgot password?</a></p>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideForgotPasswordModal()">&times;</button>
            <h2>Reset Password</h2>
            <div class="modal-form">
                <p style="color: var(--text-muted); margin-bottom: var(--space-4);">Enter your email address and we'll send you a link to reset your password.</p>
                <div class="field-group">
                    <label>Email</label>
                    <input type="email" id="forgot-email" placeholder="Enter your email">
                </div>
                <p id="forgot-error" class="error-text"></p>
                <p id="forgot-success" class="success-text" style="color: var(--accent-green);"></p>
                <button id="forgot-submit-btn" class="modal-submit" onclick="requestPasswordReset()">Send Reset Link</button>
                <p class="toggle-text"><a href="#" onclick="hideForgotPasswordModal(); showAuthModal('login'); return false;">Back to login</a></p>
            </div>
        </div>
    </div>

    <!-- My Data Modal -->
    <div id="mydata-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="hideMyDataModal()">&times;</button>
            <h2>My Data</h2>
            <div id="mydata-content" style="margin-top: var(--space-4);">
                <p style="color: var(--text-muted);">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Email Modal -->
    <div id="email-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 400px;">
            <button class="modal-close" onclick="hideEmailModal()">&times;</button>
            <h2 id="email-modal-title">Add Email</h2>
            <div class="modal-form">
                <p style="color: var(--text-muted); margin-bottom: var(--space-4);">Your email is used for password recovery.</p>
                <div class="field-group">
                    <label>Email</label>
                    <input type="email" id="new-email" placeholder="Enter email address">
                </div>
                <div class="field-group">
                    <label>Confirm Password</label>
                    <input type="password" id="email-confirm-password" placeholder="Enter your password">
                </div>
                <p id="email-error" class="error-text"></p>
                <button class="modal-submit" onclick="saveEmail()">Save Email</button>
            </div>
        </div>
    </div>

    <!-- Trash Modal -->
    <div id="dm-trash-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 650px; width: 95%;">
            <button class="modal-close" onclick="hideDMTrashModal()">&times;</button>
            <h2>Trash</h2>
            <p style="color: var(--text-muted); margin-bottom: 16px;">Deleted items can be restored or permanently deleted.</p>

            <div class="trash-section">
                <h3 class="trash-section-title">Deleted Campaigns</h3>
                <div id="trash-campaigns-list" class="trash-list">
                    <p class="trash-empty">No deleted campaigns</p>
                </div>
            </div>

            <div class="trash-section">
                <h3 class="trash-section-title">Deleted Sessions</h3>
                <div id="trash-sessions-list" class="trash-list">
                    <p class="trash-empty">No deleted sessions</p>
                </div>
            </div>
        </div>
    </div>

    <!-- New Campaign Modal -->
    <div id="campaign-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideCampaignModal()">&times;</button>
            <h2 id="campaign-modal-title">New Campaign</h2>
            <div class="modal-form">
                <div class="field-group">
                    <label>Campaign Name</label>
                    <input type="text" id="campaign-name" placeholder="e.g., Tuesday Night Group">
                </div>
                <div class="field-group">
                    <label>Description (optional)</label>
                    <textarea id="campaign-description" rows="3" placeholder="Brief description of this campaign..."></textarea>
                </div>
                <p id="campaign-error" class="error-text"></p>
                <button id="campaign-submit-btn" class="modal-submit" onclick="saveCampaign()">Create Campaign</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirm-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 350px;">
            <h2 id="confirm-title">Confirm</h2>
            <p id="confirm-message" style="margin: var(--space-4) 0; color: var(--text-secondary);"></p>
            <div style="display: flex; gap: var(--space-3); justify-content: flex-end;">
                <button onclick="hideConfirmModal()" style="background: var(--bg-elevated);">Cancel</button>
                <button id="confirm-btn" class="modal-submit" style="width: auto;">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Give XP Modal -->
    <div id="give-xp-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 350px;">
            <button class="modal-close" onclick="hideGiveXPModal()">&times;</button>
            <h2 style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5rem;">‚ú®</span>
                Give XP
            </h2>
            <p id="give-xp-character-name" style="color: var(--text-secondary); margin-bottom: var(--space-3);"></p>
            <div class="modal-form">
                <div class="field-group">
                    <label for="xp-amount">XP to give</label>
                    <input type="number" id="xp-amount" min="1" value="10" style="font-size: 1.2rem; text-align: center;">
                </div>
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: var(--space-3);">
                    10 XP = 1 attribute point
                </p>
                <div style="display: flex; gap: var(--space-2); flex-wrap: wrap; margin-bottom: var(--space-4);">
                    <button type="button" class="btn-small" onclick="document.getElementById('xp-amount').value = 5">+5</button>
                    <button type="button" class="btn-small" onclick="document.getElementById('xp-amount').value = 10">+10</button>
                    <button type="button" class="btn-small" onclick="document.getElementById('xp-amount').value = 20">+20</button>
                    <button type="button" class="btn-small" onclick="document.getElementById('xp-amount').value = 50">+50</button>
                </div>
                <button class="modal-submit" onclick="confirmGiveXP()" style="background: linear-gradient(135deg, var(--accent-gold) 0%, #f59e0b 100%); color: #000;">
                    Give XP
                </button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 400px;">
            <button class="modal-close" onclick="hideExportModal()">&times;</button>
            <h2>Export to Markdown</h2>
            <div class="modal-form">
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">Choose what to export:</p>
                <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                    <button class="modal-submit" onclick="exportSessionMarkdown()" style="background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                        Export Current Session
                    </button>
                    <button class="modal-submit" onclick="exportCampaignMarkdown()" style="background: linear-gradient(135deg, var(--accent-gold) 0%, #f59e0b 100%); color: #000;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                        Export Entire Campaign
                    </button>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.8rem; margin-top: var(--space-4);">
                    Exports as .md file compatible with Obsidian, Notion, and other markdown editors.
                </p>
            </div>
        </div>
    </div>

    <!-- Join Campaign Modal -->
    <div id="join-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 380px;">
            <button class="modal-close" onclick="hideJoinModal()">&times;</button>
            <h2 style="display: flex; align-items: center; gap: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                Join Campaign
            </h2>
            <div class="modal-form">
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">
                    Enter the share code from your DM to join their campaign and view session summaries.
                </p>
                <div class="field-group">
                    <label>Share Code</label>
                    <input type="text" id="join-code-input" placeholder="e.g., A1B2C3D4" style="font-family: monospace; font-size: 1.2rem; letter-spacing: 2px; text-align: center; text-transform: uppercase;">
                </div>
                <p id="join-error" class="error-text"></p>
                <button class="modal-submit" onclick="joinCampaign()" style="width: 100%;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    Join
                </button>
            </div>
        </div>
    </div>

    <!-- Share Campaign Modal -->
    <div id="share-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 450px;">
            <button class="modal-close" onclick="hideShareModal()">&times;</button>
            <h2 style="display: flex; align-items: center; gap: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                Share Campaign
            </h2>
            <div class="modal-form">
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">
                    Share this campaign with your players. They can join using the code below to see session summaries.
                </p>

                <!-- Share Code Display -->
                <div id="share-code-section" style="display: none;">
                    <div class="field-group">
                        <label>Share Code</label>
                        <div style="display: flex; gap: var(--space-2);">
                            <input type="text" id="share-code-display" readonly style="font-family: monospace; font-size: 1.2rem; letter-spacing: 2px; text-align: center; font-weight: bold;">
                            <button onclick="copyShareCode()" style="white-space: nowrap; background: var(--primary-purple);">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                Copy
                            </button>
                        </div>
                    </div>
                    <p style="color: var(--text-muted); font-size: 0.8rem; margin-top: var(--space-2);">
                        Players enter this code to join your campaign and view summaries.
                    </p>
                </div>

                <!-- Generate Code Button (shown when no code exists) -->
                <div id="share-generate-section" style="display: none;">
                    <button class="modal-submit" onclick="generateShareCode()" style="width: 100%;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                        Generate Share Code
                    </button>
                </div>

                <!-- Players List -->
                <div id="share-players-section" style="display: none; margin-top: var(--space-4);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-2);">
                        <label style="margin: 0;">Players</label>
                        <span id="share-player-count" style="color: var(--text-muted); font-size: 0.8rem;"></span>
                    </div>
                    <div id="share-players-list" style="max-height: 150px; overflow-y: auto; background: var(--bg-elevated); border-radius: 8px; padding: var(--space-2);">
                        <p style="color: var(--text-muted); text-align: center; padding: var(--space-2);">No players yet</p>
                    </div>
                </div>

                <!-- Revoke Button -->
                <div id="share-revoke-section" style="display: none; margin-top: var(--space-4); padding-top: var(--space-4); border-top: 1px solid var(--border-subtle);">
                    <button onclick="revokeShareCode()" style="width: 100%; background: transparent; border: 1px solid var(--accent-red); color: var(--accent-red);">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
                        Revoke Access
                    </button>
                    <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: var(--space-2); text-align: center;">
                        This will remove all players and generate a new code.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Encounter Detail Modal -->
    <div id="encounter-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 500px; max-height: 80vh; overflow-y: auto;">
            <button class="modal-close" onclick="hideEncounterModal()">&times;</button>
            <h2 id="encounter-modal-title" style="display: flex; align-items: center; gap: 10px; color: var(--accent-red);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                Encounter
            </h2>
            <div id="encounter-modal-content">
                <!-- Content will be rendered by JavaScript -->
            </div>
        </div>
    </div>

    <!-- AI Assistant Modal -->
    <div id="ai-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close" onclick="hideAIModal()">&times;</button>
            <h2 style="display: flex; align-items: center; gap: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/></svg>
                AI Assistant
            </h2>

            <!-- Tab Navigation -->
            <div style="display: flex; gap: 0; margin-bottom: var(--space-3); border-bottom: 1px solid var(--border-default);">
                <button id="ai-tab-export" class="ai-tab active" onclick="switchAITab('export')">Export to AI</button>
                <button id="ai-tab-import" class="ai-tab" onclick="switchAITab('import')">Import from AI</button>
            </div>

            <!-- AI Compatibility Note -->
            <p style="color: var(--text-muted); font-size: 0.75rem; margin: 0 0 var(--space-4) 0; padding: 8px 12px; background: var(--bg-elevated); border-radius: var(--radius-sm); border-left: 3px solid var(--accent-primary);">
                Works best with <strong>Claude</strong> and <strong>ChatGPT</strong> (logged in). Other AI services may not be able to fetch the wiki links.
            </p>

            <!-- Export Tab -->
            <div id="ai-export-tab" class="ai-tab-content">
                <div class="modal-form">
                    <!-- Quick Actions -->
                    <div style="margin-bottom: var(--space-4);">
                        <label style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; display: block;">Quick Actions</label>
                        <div id="quick-action-buttons" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button data-quick-action="random-npc" onclick="quickAIAction('random-npc', this)" style="padding: 6px 12px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 20px; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px;">
                                üë§ Random NPC
                            </button>
                            <button data-quick-action="random-encounter" onclick="quickAIAction('random-encounter', this)" style="padding: 6px 12px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 20px; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px;">
                                ‚öîÔ∏è Random Encounter
                            </button>
                            <button data-quick-action="describe-location" onclick="quickAIAction('describe-location', this)" style="padding: 6px 12px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 20px; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px;">
                                üè∞ Describe Location
                            </button>
                            <button data-quick-action="session-recap" onclick="quickAIAction('session-recap', this)" style="padding: 6px 12px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 20px; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px;">
                                üìú Session Recap
                            </button>
                            <button onclick="showPrologueSessionModal()" style="padding: 6px 12px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 20px; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px;">
                                üìñ Session Prologue
                            </button>
                            <button data-quick-action="new-session" onclick="quickAIAction('new-session', this)" style="padding: 6px 12px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 20px; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px;">
                                ‚ú® Generate Full Session
                            </button>
                        </div>
                    </div>

                    <!-- Session Planning Settings -->
                    <div style="display: flex; gap: var(--space-3); margin-bottom: var(--space-4); flex-wrap: wrap;">
                        <div class="field-group" style="flex: 1; min-width: 150px; margin-bottom: 0;">
                            <label style="font-size: 0.85rem;">Session Type</label>
                            <select id="ai-session-type">
                                <option value="mixed">‚öñÔ∏è Mixed (recommended)</option>
                                <option value="combat">‚öîÔ∏è Combat-focused</option>
                                <option value="roleplay">üé≠ Roleplay-focused</option>
                            </select>
                        </div>
                        <div class="field-group" style="flex: 1; min-width: 150px; margin-bottom: 0;">
                            <label style="font-size: 0.85rem;">Session Length</label>
                            <select id="ai-session-length">
                                <option value="1">1 hour</option>
                                <option value="2">2 hours</option>
                                <option value="3" selected>3 hours</option>
                                <option value="4">4 hours</option>
                                <option value="5">5+ hours</option>
                            </select>
                        </div>
                    </div>

                    <div class="field-group">
                        <label>What do you need help with?</label>
                        <select id="ai-task-type" onchange="updateAITaskDescription()">
                            <option value="plan-session">Plan next session</option>
                            <option value="create-npcs">Create NPCs</option>
                            <option value="create-encounters">Create encounters</option>
                            <option value="write-readaloud">Write read-aloud text</option>
                            <option value="organize-timeline">Organize timeline (day/time)</option>
                            <option value="rewrite">Rewrite session content</option>
                            <option value="summarize">Summarize campaign</option>
                            <option value="custom">Custom question</option>
                        </select>
                    </div>

                    <p id="ai-task-description" style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: var(--space-3);">
                        AI will suggest hooks, NPCs, encounters, and read-aloud text for your next session.
                    </p>

                    <div class="field-group">
                        <label>Additional context or specific request (optional)</label>
                        <textarea id="ai-custom-prompt" rows="3" placeholder="E.g., 'Focus on the mystery of the missing merchant' or 'I need a combat encounter in a forest'"></textarea>
                    </div>

                    <div style="margin-bottom: var(--space-4);">
                        <div style="display: flex; gap: var(--space-3); flex-wrap: wrap; align-items: center; margin-bottom: var(--space-2);">
                            <label style="display: flex; align-items: center; gap: var(--space-2); cursor: pointer;">
                                <input type="checkbox" id="ai-include-previous" checked onchange="toggleAISessionSelect()">
                                <span style="font-size: 0.9rem;">Include previous session summaries</span>
                            </label>
                            <select id="ai-session-select" style="padding: 6px 10px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-base); font-size: 0.85rem;">
                                <option value="all">All previous sessions</option>
                            </select>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.75rem; margin: 0;">Current session data (NPCs, places, encounters, etc.) is always included so AI understands what exists.</p>
                    </div>

                    <button class="modal-submit" onclick="generateAIExport()" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">
                        Generate Export
                    </button>

                    <!-- Generated Output -->
                    <div id="ai-export-output" style="display: none; margin-top: var(--space-4);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-2);">
                            <label style="font-weight: 600;">Generated prompt (copy this to your AI)</label>
                            <button onclick="copyAIExport()" style="padding: 6px 12px; background: var(--accent-green); color: #000; border: none; border-radius: var(--radius-sm); cursor: pointer; font-size: 0.85rem; font-weight: 600;">
                                Copy to Clipboard
                            </button>
                        </div>
                        <textarea id="ai-export-text" rows="12" readonly style="font-family: monospace; font-size: 0.8rem; background: var(--bg-base);"></textarea>
                        <p style="color: var(--text-secondary); font-size: 0.8rem; margin-top: var(--space-2);">
                            Paste this into ChatGPT, Claude, or another AI assistant. When you're happy with the suggestions,
                            ask the AI to export in import format and use the "Import from AI" tab.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Import Tab -->
            <div id="ai-import-tab" class="ai-tab-content" style="display: none;">
                <div class="modal-form">
                    <p style="color: var(--text-secondary); margin-bottom: var(--space-3);">
                        When the AI has given you suggestions you like, ask it: <br>
                        <strong style="color: var(--accent-gold);">"Export this in import format"</strong>
                    </p>

                    <div class="field-group">
                        <label>Paste the AI's response here</label>
                        <textarea id="ai-import-text" rows="10" placeholder="Paste the AI response containing ---IMPORT_START--- and ---IMPORT_END--- markers..."></textarea>
                    </div>

                    <button class="modal-submit" onclick="parseAIImport()" style="background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%);">
                        Parse Response
                    </button>

                    <!-- Import Preview -->
                    <div id="ai-import-preview" style="display: none; margin-top: var(--space-4);">
                        <h3 style="margin-bottom: var(--space-3); color: var(--accent-gold);">Found items to import:</h3>
                        <div id="ai-import-items"></div>
                        <div style="display: flex; gap: var(--space-3); margin-top: var(--space-4);">
                            <button class="modal-submit" onclick="importAllAIItems()" style="background: linear-gradient(135deg, var(--accent-green) 0%, #1db954 100%); color: #000;">
                                Import All
                            </button>
                            <button onclick="hideAIModal()" style="padding: var(--space-2) var(--space-4); background: transparent; border: 1px solid var(--border-default); border-radius: var(--radius-md); color: var(--text-secondary); cursor: pointer;">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="password-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 400px;">
            <button class="modal-close" onclick="hidePasswordModal()">&times;</button>
            <h2>Change Password</h2>
            <div class="modal-form">
                <div class="field-group">
                    <label>Current Password</label>
                    <input type="password" id="current-password" placeholder="Enter current password">
                </div>
                <div class="field-group">
                    <label>New Password</label>
                    <input type="password" id="new-password" placeholder="Enter new password (min 8 chars, letters + numbers)">
                </div>
                <div class="field-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirm-password" placeholder="Confirm new password">
                </div>
                <p id="password-error" class="error-text"></p>
                <button class="modal-submit" onclick="changePassword()">Change Password</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close" onclick="hideHelpModal()">&times;</button>
            <h2 style="display: flex; align-items: center; gap: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                DM Session Tool - Help Guide
            </h2>

            <!-- Help Navigation -->
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: var(--space-4); padding-bottom: var(--space-3); border-bottom: 1px solid var(--border-default);">
                <button class="help-nav-btn active" onclick="showHelpSection('getting-started')">Getting Started</button>
                <button class="help-nav-btn" onclick="showHelpSection('planning')">Planning</button>
                <button class="help-nav-btn" onclick="showHelpSection('during-play')">During Play</button>
                <button class="help-nav-btn" onclick="showHelpSection('reference')">Reference</button>
                <button class="help-nav-btn" onclick="showHelpSection('sharing')">Sharing</button>
                <button class="help-nav-btn" onclick="showHelpSection('ai-assistant')">AI Assistant</button>
                <button class="help-nav-btn" onclick="showHelpSection('export')">Export</button>
            </div>

            <!-- Getting Started Section -->
            <div id="help-getting-started" class="help-section">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3);">Getting Started</h3>

                <div class="help-block">
                    <h4>1. Login / Create Account</h4>
                    <p>Click <strong>Login</strong> in the header to log in or create a new account. Your campaigns and sessions are saved to the server and accessible from any device.</p>
                </div>

                <div class="help-block">
                    <h4>2. Create a Campaign</h4>
                    <p>On the dashboard, click <strong>"+ New Campaign"</strong> to create your first campaign. Give it a name and optional description.</p>
                    <ul>
                        <li>A campaign is a container for all your sessions</li>
                        <li>Each campaign can have multiple sessions</li>
                        <li>You can share campaigns with your players</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>3. Create a Session</h4>
                    <p>Click <strong>"+ Session"</strong> on a campaign card or use the <strong>Continue</strong> button to open your last active session.</p>
                    <ul>
                        <li>Sessions have a number, date, and location</li>
                        <li>Import players from previous sessions with one click</li>
                        <li>Sessions auto-save every 30 seconds</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>4. Understanding Session Status</h4>
                    <p>Sessions can be <strong style="color: var(--accent-green);">ACTIVE</strong> (editable) or <strong style="color: var(--accent-red);">LOCKED</strong> (read-only).</p>
                    <ul>
                        <li><strong>Active:</strong> You can edit and modify the session</li>
                        <li><strong>Locked:</strong> Session is finished and archived (players can see summary)</li>
                        <li>Use the Lock/Unlock buttons in the header to change status</li>
                    </ul>
                </div>
            </div>

            <!-- Planning Section -->
            <div id="help-planning" class="help-section" style="display: none;">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3);">Planning Tab</h3>
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">The Planning tab is where you prepare your adventure before the session.</p>

                <div class="help-block">
                    <h4>Hook / Session Goal</h4>
                    <p>Define the main purpose of the session. What should the players accomplish? This stays visible throughout the session as a reminder.</p>
                </div>

                <div class="help-block">
                    <h4>Players</h4>
                    <p>Add each player with their character info. Click <strong>"Import from Previous"</strong> to copy players from the last session.</p>
                    <ul>
                        <li>Player name, Character name, Race, Class, Religion</li>
                        <li>Notes field for player-specific reminders</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>NPCs (Non-Player Characters)</h4>
                    <p>Create NPCs the players might meet. Use the <strong>"Random Name"</strong> button to generate names.</p>
                    <ul>
                        <li><strong>Role:</strong> Quest Giver, Merchant, Enemy, Ally, etc.</li>
                        <li><strong>Disposition:</strong> Friendly, Neutral, Hostile, Unknown</li>
                        <li><strong>Planned Location:</strong> Where you expect them to appear</li>
                        <li>NPCs appear as quick-access cards in During Play</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Places / Locations</h4>
                    <p>Describe locations the players might visit. Add descriptions, atmosphere, and what can be found there.</p>
                </div>

                <div class="help-block">
                    <h4>Encounters</h4>
                    <p>Plan combat or challenge encounters. Click an encounter to edit enemies with full stat blocks:</p>
                    <ul>
                        <li>Enemy name, HP, Armor, Weapon</li>
                        <li>Attack bonus, Damage, Initiative</li>
                        <li>Tactics and planned loot</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Items / Clues</h4>
                    <p>List items, treasure, or clues the players might find. Track where you plan to place them.</p>
                </div>

                <div class="help-block">
                    <h4>Read-Aloud Text</h4>
                    <p>Pre-written descriptions to read to your players. Great for atmospheric scene-setting or important revelations.</p>
                </div>
            </div>

            <!-- During Play Section -->
            <div id="help-during-play" class="help-section" style="display: none;">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3);">During Play Tab</h3>
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">Use this tab while running the session. It shows quick-access cards and tracking tools.</p>

                <div class="help-block">
                    <h4>Quick Access Cards</h4>
                    <p>All your planned content appears as easy-to-click cards:</p>
                    <ul>
                        <li><strong>NPCs:</strong> Click to see full details. Mark as "Used" when introduced.</li>
                        <li><strong>Places:</strong> Click to see description. Mark as "Visited" when players arrive.</li>
                        <li><strong>Encounters:</strong> Status changes from Planned ‚Üí In Progress ‚Üí Completed.</li>
                        <li><strong>Items:</strong> Mark as "Found" and note who received them.</li>
                        <li><strong>Read-Aloud:</strong> Click to see text. Mark as "Read" when used.</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Event Log</h4>
                    <p>Add timestamped notes as things happen. Click <strong>"+ Add Event"</strong> to log important moments. Events are sorted chronologically.</p>
                </div>

                <div class="help-block">
                    <h4>Turning Points</h4>
                    <p>Record key decisions or moments that shaped the story. Include:</p>
                    <ul>
                        <li><strong>Description:</strong> What happened or what decision was made</li>
                        <li><strong>Consequence:</strong> What resulted from this moment</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Session Notes</h4>
                    <p>Post-session reflection fields:</p>
                    <ul>
                        <li><strong>Summary:</strong> Brief recap of what happened</li>
                        <li><strong>What went well:</strong> Memorable moments, good pacing</li>
                        <li><strong>What to improve:</strong> Notes for next time</li>
                        <li><strong>Follow-up:</strong> Threads to continue later</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Sync with Planning</h4>
                    <p>Changes in During Play automatically update Planning. Marking an NPC as "used" or changing their location syncs both tabs.</p>
                </div>
            </div>

            <!-- Reference Section -->
            <div id="help-reference" class="help-section" style="display: none;">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3);">Reference Tab</h3>
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">Quick lookup for game rules, weapons, armor, and spells from the Aedelore system.</p>

                <div class="help-block">
                    <h4>Expandable Sections</h4>
                    <p>Click any section header to expand/collapse:</p>
                    <ul>
                        <li><strong>Quick Rules:</strong> Core mechanics, dice, success levels</li>
                        <li><strong>Combat:</strong> Attack flow, defense options, damage</li>
                        <li><strong>Weapons:</strong> All weapon stats (damage, range, abilities)</li>
                        <li><strong>Armor:</strong> Armor pieces by body part (HP, Block, Disadvantages)</li>
                        <li><strong>Mage Spells:</strong> Arcana costs, damage, spell types</li>
                        <li><strong>Druid Spells:</strong> Nature magic, summoning, control</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Spell Types</h4>
                    <p>Spells are categorized by type (Fire, Arcane, Frost, etc.) to help with flavor and roleplay.</p>
                </div>
            </div>

            <!-- Sharing Section -->
            <div id="help-sharing" class="help-section" style="display: none;">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3);">Sharing with Players</h3>
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">Let your players see session summaries and campaign info.</p>

                <div class="help-block">
                    <h4>Generate Share Code (DM)</h4>
                    <ol>
                        <li>Open a campaign</li>
                        <li>Click the <strong>three-dot menu</strong> on the campaign card</li>
                        <li>Select <strong>"Share"</strong></li>
                        <li>A unique 8-character code is generated (e.g., A1B2C3D4)</li>
                        <li>Share this code with your players</li>
                    </ol>
                </div>

                <div class="help-block">
                    <h4>Join Campaign (Player)</h4>
                    <ol>
                        <li>Log in to the DM Session Tool</li>
                        <li>On the dashboard, find <strong>"Joined Campaigns"</strong></li>
                        <li>Click <strong>"Join Campaign"</strong></li>
                        <li>Enter the share code from your DM</li>
                        <li>You now have read-only access to the campaign</li>
                    </ol>
                </div>

                <div class="help-block">
                    <h4>What Players Can See</h4>
                    <ul>
                        <li><strong>Campaign info:</strong> Name, description, DM name</li>
                        <li><strong>Session list:</strong> All sessions (locked = completed)</li>
                        <li><strong>Live summary:</strong> Current session summary (updates every 10 seconds)</li>
                        <li>Summary includes: NPCs met, places visited, items found, turning points</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>What Players Cannot See</h4>
                    <ul>
                        <li>Full session details (your planning notes)</li>
                        <li>Unused NPCs, unvisited places, unfound items</li>
                        <li>Encounter stats and tactics</li>
                        <li>Your DM notes</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Manage Players (DM)</h4>
                    <p>In the Share modal, you can see who has joined and remove players if needed. <strong>"Revoke Access"</strong> removes all players and deletes the share code.</p>
                </div>

                <div class="help-block">
                    <h4>Link Character to Campaign</h4>
                    <p>Players can also link their character sheet to your campaign:</p>
                    <ol>
                        <li>Go to the Character Sheet tool</li>
                        <li>Save your character to the cloud</li>
                        <li>In the Character tab, click <strong>"Link to Campaign"</strong></li>
                        <li>Enter the same share code</li>
                        <li>Your character is now linked, and you can see party members</li>
                    </ol>
                </div>
            </div>

            <!-- AI Assistant Section -->
            <div id="help-ai-assistant" class="help-section" style="display: none;">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3);">AI Assistant</h3>
                <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">Use external AI (ChatGPT, Claude, etc.) to help plan sessions.</p>

                <div class="help-block">
                    <h4>Export to AI</h4>
                    <ol>
                        <li>Click <strong>"AI Assistant"</strong> in the header</li>
                        <li>Select a task type:
                            <ul>
                                <li><strong>Plan session:</strong> Get hooks, NPCs, encounters</li>
                                <li><strong>Create NPCs:</strong> Generate characters</li>
                                <li><strong>Create encounters:</strong> Design combat</li>
                                <li><strong>Write read-aloud:</strong> Atmospheric descriptions</li>
                                <li><strong>Summarize:</strong> Campaign recap</li>
                                <li><strong>Custom:</strong> Your own question</li>
                            </ul>
                        </li>
                        <li>Add optional context or specific requests</li>
                        <li>Click <strong>"Generate Export"</strong></li>
                        <li>Copy the generated prompt to your AI</li>
                    </ol>
                </div>

                <div class="help-block">
                    <h4>What's Included in Export</h4>
                    <ul>
                        <li>Links to Aedelore wiki for world info</li>
                        <li>Campaign name and description</li>
                        <li>Previous session summaries (if enabled)</li>
                        <li>Current session data (players, NPCs, places, etc.)</li>
                        <li>Instructions for the AI to format responses</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Import from AI</h4>
                    <ol>
                        <li>After the AI gives suggestions you like, tell it:<br>
                            <strong style="color: var(--accent-gold);">"Export this in import format"</strong></li>
                        <li>The AI will output marked JSON between ---IMPORT_START--- and ---IMPORT_END---</li>
                        <li>Copy the entire response</li>
                        <li>Go to the <strong>"Import from AI"</strong> tab</li>
                        <li>Paste and click <strong>"Parse Response"</strong></li>
                        <li>Preview what will be imported</li>
                        <li>Click <strong>"Import All"</strong> to add to your session</li>
                    </ol>
                </div>

                <div class="help-block">
                    <h4>Tips for Best Results</h4>
                    <ul>
                        <li>Be specific in your additional context</li>
                        <li>Include previous sessions for continuity</li>
                        <li>Ask follow-up questions before importing</li>
                        <li>Review and edit imported content</li>
                    </ul>
                </div>
            </div>

            <!-- Export Section -->
            <div id="help-export" class="help-section" style="display: none;">
                <h3 style="color: var(--accent-gold); margin-bottom: var(--space-3);">Export & Print</h3>

                <div class="help-block">
                    <h4>Export to Markdown</h4>
                    <p>Click <strong>"Export"</strong> in the header to save your data as markdown files:</p>
                    <ul>
                        <li><strong>Export Current Session:</strong> Single session as .md file</li>
                        <li><strong>Export Entire Campaign:</strong> All sessions in one file</li>
                        <li>Compatible with Obsidian, Notion, and other markdown tools</li>
                    </ul>
                </div>

                <div class="help-block">
                    <h4>Print</h4>
                    <p>Click <strong>"Print"</strong> to print the current view. The page is styled for print with clean formatting.</p>
                </div>

                <div class="help-block">
                    <h4>Auto-Save</h4>
                    <p>Sessions auto-save every 30 seconds when you're logged in. You can also click <strong>"Save"</strong> manually at any time.</p>
                </div>

                <div class="help-block">
                    <h4>My Data</h4>
                    <p>Click <strong>"My Data"</strong> to see your profile:</p>
                    <ul>
                        <li>Total campaigns and sessions</li>
                        <li>List of all your campaigns</li>
                        <li>List of all your characters (from Character Sheet)</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: var(--space-6); padding-top: var(--space-4); border-top: 1px solid var(--border-default); text-align: center; color: var(--text-secondary); font-size: 0.85rem;">
                <p>Need more help? Visit the <a href="https://wiki.aedelore.nu" target="_blank" style="color: var(--accent-gold);">Aedelore Wiki</a> for game rules and lore.</p>
            </div>
        </div>
    </div>
        </div><!-- /.main-content-area -->
    </div><!-- /.app-wrapper -->

    <script src="data/npc-names.js"></script>
    <script src="js/dm-session.js"></script>

    <!-- Privacy Banner -->
    <div id="privacy-banner" class="privacy-banner">
        <div class="privacy-banner-content">
            <div class="privacy-banner-text">
                <div class="privacy-banner-title">Privacy & Analytics</div>
                <div class="privacy-banner-description">
                    We use privacy-friendly analytics to understand how Aedelore is used. No cookies, no personal data, fully anonymous.
                    <a class="privacy-banner-link" onclick="AedelorePrivacy.showPrivacyDetails()">Learn more</a>
                </div>
            </div>
            <div class="privacy-banner-actions">
                <button class="privacy-btn privacy-btn-secondary" onclick="AedelorePrivacy.declineAnalytics()">Decline</button>
                <button class="privacy-btn privacy-btn-primary" onclick="AedelorePrivacy.acceptAnalytics()">Accept</button>
            </div>
        </div>
    </div>

    <!-- Player Build Modal -->
    <div id="player-build-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="hidePlayerBuildModal()">&times;</button>
            <h2 id="player-build-title">Character Build</h2>
            <div id="player-build-content" style="margin-top: var(--space-4);">
                <p style="color: var(--text-secondary);">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Prolog Session Selector Modal -->
    <div id="prologue-session-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Generate Session Prologue</h2>
                <button class="modal-close" onclick="closePrologueSessionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); margin-bottom: var(--space-3);">Select which session to base the prologue on. The AI will use that session's events and turning points to write a recap.</p>
                <div class="field-group">
                    <label>Base prologue on session:</label>
                    <select id="prologue-session-select" style="width: 100%;">
                        <option value="current">Current session</option>
                    </select>
                </div>
                <div style="display: flex; gap: var(--space-2); margin-top: var(--space-4); justify-content: flex-end;">
                    <button onclick="closePrologueSessionModal()" style="padding: 8px 16px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-secondary); cursor: pointer;">Cancel</button>
                    <button onclick="generatePrologueFromSelectedSession()" style="padding: 8px 16px; background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-blue) 100%); border: none; border-radius: var(--radius-sm); color: white; cursor: pointer; font-weight: 500;">Generate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Details Modal -->
    <div id="privacy-details-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Privacy Information</h2>
                <button class="modal-close" onclick="AedelorePrivacy.hidePrivacyDetails()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="privacy-status-row">
                    <span class="privacy-status-label">Anonymous Analytics</span>
                    <div class="privacy-status-value">
                        <span id="privacy-analytics-status" class="privacy-status-disabled">Disabled</span>
                        <button id="privacy-analytics-toggle" class="privacy-btn privacy-btn-primary" onclick="AedelorePrivacy.toggleAnalytics()">Enable</button>
                    </div>
                </div>

                <div class="privacy-details-section">
                    <h4>What We Collect</h4>
                    <ul>
                        <li>Page views and navigation patterns</li>
                        <li>Referrer (where you came from)</li>
                        <li>Browser type and screen size</li>
                        <li>Country (from anonymized IP)</li>
                    </ul>
                </div>

                <div class="privacy-details-section">
                    <h4>What We Do NOT Collect</h4>
                    <ul>
                        <li>No cookies or tracking pixels</li>
                        <li>No personal information</li>
                        <li>No IP addresses stored</li>
                        <li>No connection to your account</li>
                    </ul>
                </div>

                <div class="privacy-details-section">
                    <h4>Why We Collect This</h4>
                    <p>To understand how Aedelore is used and improve the tools for the community. All data is aggregated and anonymous.</p>
                </div>

                <div class="privacy-details-section">
                    <h4>Data Deletion</h4>
                    <p>Since analytics are completely anonymous, we cannot identify or delete individual user data. You can disable analytics at any time using the toggle above.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/privacy.js"></script>
</body>
</html>
